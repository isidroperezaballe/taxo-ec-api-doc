; ========================================
; SUPERVISOR CONFIGURATION FOR TAXO MAILBOX WORKERS
; ========================================
;
; Ubicación: /etc/supervisor/conf.d/taxo-mailbox-worker.conf
;
; Instalación:
;   1. sudo apt-get install supervisor
;   2. sudo cp public/docs/SUPERVISOR_CONFIG_EXAMPLE.conf /etc/supervisor/conf.d/taxo-mailbox-worker.conf
;   3. Editar rutas en el archivo copiado (user, command, stdout_logfile)
;   4. sudo supervisorctl reread
;   5. sudo supervisorctl update
;   6. sudo supervisorctl start taxo-mailbox-worker:*
;
; Comandos útiles:
;   sudo supervisorctl status                    # Ver estado
;   sudo supervisorctl restart taxo-mailbox-worker:*  # Reiniciar
;   sudo supervisorctl stop taxo-mailbox-worker:*     # Detener
;   tail -f /path/to/storage/logs/worker-mailbox.log  # Ver logs
;

[program:taxo-mailbox-worker]
process_name=%(program_name)s_%(process_num)02d
command=php /home/isidro/code/taxo-ec/artisan queue:work database --queue=mailbox-sync --tries=3 --timeout=120 --max-jobs=1000 --max-time=3600
autostart=true
autorestart=true
stopasgroup=true
killasgroup=true
user=isidro
numprocs=10
redirect_stderr=true
stdout_logfile=/home/isidro/code/taxo-ec/storage/logs/worker-mailbox.log
stopwaitsecs=3600
startsecs=0

; Explicación de parámetros:
; - numprocs=10         → 10 workers en paralelo (ajusta según CPU/RAM disponible)
; - max-jobs=1000       → Reiniciar worker cada 1000 jobs procesados (previene memory leaks)
; - max-time=3600       → Reiniciar worker cada 1 hora (1 hora = 3600 segundos)
; - tries=3             → Reintentar hasta 3 veces si un job falla
; - timeout=120         → Timeout de 120 segundos por job individual
; - queue=mailbox-sync  → Cola específica para sincronización de buzón tributario
; - autostart=true      → Iniciar automáticamente al bootear el servidor
; - autorestart=true    → Reiniciar automáticamente si el proceso se cae
; - stopwaitsecs=3600   → Esperar hasta 1 hora antes de forzar stop (para jobs largos)
; - user=isidro         → Usuario del sistema que ejecutará los workers (CAMBIAR según tu usuario)

