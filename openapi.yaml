openapi: 3.0.3
info:
  title: 'Taxo Impuestos API - Documentación'
  description: 'API RESTful para gestión de contribuyentes, categorías, documentos emitidos, documentos recibidos y reportes tributarios.'
  version: 1.0.0
servers:
  -
    url: 'https://ec-demo.taxo.co'
tags:
  -
    name: Taxpayers
    description: "\nAPI endpoints for managing taxpayers and their related data."
  -
    name: 'Emitted Documents'
    description: "\nAPI endpoints for managing emitted documents (sales documents to customers).\n\n## Document Types\n\nEmitted documents include:\n- **Invoices (Facturas de Venta)**: Sales invoices issued to customers\n- **Credit Notes**: Applied to invoices\n- **Withholdings**: Tax withholding documents received from customers\n\n## Filtering & Categorization\n\n### Date Filtering\n- **Default**: Current month if no dates provided\n- **start_date**: Filter from this date (YYYY-MM-DD)\n- **end_date**: Filter until this date (YYYY-MM-DD)\n\n### Category Filtering\n\nThe system supports both document-level and item-level categorization.\n\n**Category filters:**\n\n- `category_id[]`: Filter by specific category ID(s) - array parameter (can pass multiple)\n  \n  **Searches in:** `invoice_items.tax_payer_category_id` (line item categories)\n  \n  **Note:** To obtain the available category IDs for a taxpayer, use the categories endpoint:\n  `GET /api/v1/taxpayers/{taxNumber}/categories?type=sales`\n  \n  Each taxpayer has their own custom categories for sales. You must retrieve the category IDs \n  from this endpoint before filtering by `category_id[]`.\n\n### Regime Filtering\n- `regime`: Filter by tax regime - single value parameter\n  - `general`: General tax regime\n  - `rimpe_entrepreneur`: RIMPE Entrepreneur regime\n  - `rimpe_popular_business`: RIMPE Popular Business regime\n\n### Deductibility Filtering\n- `deductible_type`: Filter by tax deductibility - single value parameter\n  - `deductible`: Tax-deductible (Con derecho a crédito tributario)\n  - `non_deductible`: Non-deductible (Sin derecho a crédito tributario)\n\n### Status Filtering\n- `status`: Filter by document status - single value parameter\n  - `AUTORIZADO`: Authorized/valid documents\n  - `ANULADO`: Voided documents\n\n### Origin Filtering\n- `origin`: Filter by document origin/source system - single value parameter\n  - `datil`: Documents issued through Datil integration\n  - `tws`: Documents processed by Taxo Web Services\n  - `xml-import`: Documents manually imported from XML files\n  - `physical-upload`: Physical documents uploaded/entered manually by user\n\n**Note:** Most filters accept a single value.\nOnly `category_id` accepts multiple values using array notation `category_id[]=123&category_id[]=456`.\n\n## Pagination\n\n- `page`: Page number (default: 1)\n- `per_page`: Items per page, 1-100 (default: 20)"
  -
    name: 'IVA Reports'
    description: "\nAPI endpoints for managing IVA (Value Added Tax) reports.\n\n## Report Lifecycle & State Machine\n\nEach IVA report follows a state machine with controlled transitions. Understanding the states and allowed transitions is critical for proper API usage.\n\n### Report States\n\n| State | Code | Description | Can Edit? |\n|-------|------|-------------|-----------|\n| Draft | `draft` | Initial state, automatically created | ✅ Yes |\n| Edited | `edited` | Has manual modifications | ✅ Yes |\n| Saved | `saved` | Ready for review/approval | ❌ No |\n| Sent | `sent` | Sent to taxpayer for approval | ❌ No |\n| Approved | `approved` | Approved, ready for SRI submission | ❌ No |\n| Rejected | `rejected` | Rejected, requires corrections | ❌ No |\n| SRI Sended | `sri_sended` | Being sent to SRI | ❌ No |\n| SRI Completed | `sri_sended_completed` | SRI processing completed | ❌ No |\n| Declared | `declared` | Successfully declared in SRI | ❌ No |\n| Error | `error` | Error during SRI submission | ❌ No |\n\n### State Transitions Matrix\n\n| From State | Allowed Transitions | Endpoints |\n|------------|---------------------|-----------|\n| `draft` | → `edited`, `saved` | `/save` |\n| `edited` | → `draft`, `saved` | `/recalculate`, `/save` |\n| `saved` | → `draft`, `sent`, `approved`, `rejected`, `sri_sended` | `/recalculate`, `/send`, `/approve`, `/reject`, `/send-sri-draft` |\n| `sent` | → `draft`, `approved`, `rejected` | `/recalculate`, `/approve`, `/reject` |\n| `approved` | → `draft`, `sri_sended`, `declared` | `/recalculate`, `/send-sri-draft`, `/mark-declared` |\n| `rejected` | → `draft` | `/recalculate` |\n| `sri_sended` | → `sri_sended_completed`, `error` | (automatic) |\n| `sri_sended_completed` | → `draft`, `approved`, `rejected`, `declared` | `/recalculate`, `/approve`, `/reject`, `/mark-declared` |\n| `error` | → `draft`, `sri_sended` | `/recalculate`, `/send-sri-draft` |\n| `declared` | → `draft` | `/recalculate` |\n\n### Common Workflows\n\n#### Workflow 1: Direct Approval (no taxpayer review)\n```\n1. POST   /iva-reports                    → Creates report (draft)\n2. GET    /iva-reports/{period}           → Review calculated values\n3. PATCH  /iva-reports/save               → Lock for review (saved)\n4. PATCH  /iva-reports/approve            → Approve report (approved)\n5. POST   /iva-reports/send-sri-draft     → Submit to SRI (sri_sended → sri_sended_completed)\n6. PATCH  /iva-reports/mark-declared      → Mark as declared (declared)\n```\n\n#### Workflow 2: With Taxpayer Approval\n```\n1. POST   /iva-reports                    → Creates report (draft)\n2. PATCH  /iva-reports/save               → Lock for review (saved)\n3. POST   /iva-reports/send               → Email to taxpayer (sent)\n4. [Taxpayer reviews and approves via link]\n5. POST   /iva-reports/send-sri-draft     → Submit to SRI (approved → sri_sended)\n6. PATCH  /iva-reports/mark-declared      → Mark as declared (declared)\n```\n\n#### Workflow 3: SRI Draft First, Then Approval\n```\n1. POST   /iva-reports                    → Creates report (draft)\n2. PATCH  /iva-reports/save               → Lock for review (saved)\n3. POST   /iva-reports/send-sri-draft     → Submit draft to SRI (sri_sended → sri_sended_completed)\n4. POST   /iva-reports/send               → Email to taxpayer (sent)\n5. [Taxpayer approves via link]\n6. PATCH  /iva-reports/mark-declared      → Mark as declared (declared)\n```\n\n#### Workflow 4: Rejection & Correction\n```\n1. POST   /iva-reports                    → Creates report (draft)\n2. PATCH  /iva-reports/save               → Lock for review (saved)\n3. POST   /iva-reports/send               → Email to taxpayer (sent)\n4. PATCH  /iva-reports/reject             → Reject with comments (rejected)\n5. POST   /iva-reports/recalculate        → Reset to draft (draft)\n6. [Add missing documents, correct errors]\n7. PATCH  /iva-reports/save               → Save again (saved)\n8. PATCH  /iva-reports/approve            → Approve (approved)\n```\n\n### Endpoints That Don't Require Transitions\n\nThese endpoints can be called at any time regardless of state:\n\n- **`GET /iva-reports`** - List all reports\n- **`GET /iva-reports/{period}`** - View specific report details\n- **`POST /iva-reports`** - Create new report (always starts in `draft`)\n- **`POST /iva-reports/recalculate`** - Reset report to `draft` (allowed from most states)\n\n### Important Notes\n\n1. **Report Identification**: Reports are uniquely identified by `taxpayer_id`, `period`, and `team_id`\n2. **Period Format**: Use `YYYY-MM` format (e.g., `2024-03`). The system auto-calculates the exact date based on taxpayer's periodicity\n3. **Automatic Calculations**: Reports are automatically calculated from issued/received documents when created\n4. **State Validation**: All state-changing endpoints validate transitions. Invalid transitions return `400 INVALID_TRANSITION`\n5. **Idempotency**: Some endpoints are idempotent (e.g., `/save` from `saved` state, `/send` from `sent` state)\n\n### Error Handling\n\n- **`400 INVALID_TRANSITION`**: Attempted invalid state transition\n- **`404 NOT_FOUND`**: Report or taxpayer not found\n- **`422 VALIDATION_ERROR`**: Invalid input parameters\n- **`503 EMAIL_SEND_FAILED`**: Email service unavailable (only `/send` endpoint)"
  -
    name: 'Received Documents'
    description: "\nAPI endpoints for managing received documents (purchase documents from suppliers).\n\n## Document Types\n\nReceived documents include:\n- **Invoices (Facturas de Compra)**: Standard purchase invoices from suppliers\n- **Credit Notes**: Applied to invoices\n- **Withholdings**: Tax withholding documents\n\n## Filtering & Categorization\n\n### Date Filtering\n- **Default**: Current month if no dates provided\n- **start_date**: Filter from this date (YYYY-MM-DD)\n- **end_date**: Filter until this date (YYYY-MM-DD)\n\n### Category Filtering\n\nThe system supports two types of categorization:\n\n1. **Document-level categorization (mono-category)**: All items in the document share the same category\n2. **Item-level categorization (multi-category)**: Each line item has its own category\n\n**How Category Filters Work:**\n\nBoth category filters search at the **item level** (bill_items table). If **any item** in a document \nmatches the filter criteria, the **entire document** is included in the results.\n\n**Example:**\n```\nDocument #001:\n  - Item 1: Category \"Office Supplies\" (id: 123)\n  - Item 2: Category \"Services\" (id: 456)\n  - Item 3: Category \"Office Supplies\" (id: 123)\n\nFilter: category_id[]=123\nResult: ✓ Document #001 is included (has items with category 123)\n```\n\n**Category filters:**\n\n- `category_id[]`: Filter by specific category ID(s) - array parameter (can pass multiple)\n  \n  **Searches in:** `bill_items.tax_payer_category_id` (line item categories)\n  \n  **Note:** To obtain the available category IDs for a taxpayer, use the categories endpoint:\n  `GET /api/v1/taxpayers/{taxNumber}/categories`\n  \n  Each taxpayer has their own custom categories. You must retrieve the category IDs \n  from this endpoint before filtering by `category_id[]`.\n  \n- `category_type`: Filter by expense type - single value parameter\n  \n  **Searches in:** `bills.category_types` (JSON field that summarizes item categories)\n  \n  **Available values:**\n  - `commercial_expenses`: Business-related expenses (Actividad Comercial)\n  - `personal_expenses`: Personal expenses (Gasto Personal)\n  - `non_deductible_expenses`: Non-deductible expenses (No Deducible)\n\n### Deductibility Filtering\n- `deductible_type`: Filter by tax deductibility - single value parameter\n  - `deductible`: Tax-deductible expenses (Con derecho a crédito tributario)\n  - `non_deductible`: Non-deductible expenses (Sin derecho a crédito tributario)\n\n### Status Filtering\n- `status`: Filter by document status - single value parameter\n  - `AUTORIZADO`: Authorized/valid documents\n  - `ANULADO`: Voided documents\n\n### Search & Other Filters\n- `search`: Search in provider name, RUC, email, phone, document number, or access key\n- `uncategorized`: Filter uncategorized documents (boolean: true/false)\n- `origin`: Filter by document origin/source system - single value parameter\n  - `tws`: Documents automatically processed by Taxo Web Services from SRI\n  - `xml-import`: Documents manually imported from XML files\n  - `physical-upload`: Physical documents uploaded/entered manually by user\n\n**Note:** Most filters accept a single value.\nOnly `category_id` accepts multiple values using array notation `category_id[]=123&category_id[]=456`.\n\n## Sorting\n\nDefault sort: `-date_only,-bill_number` (newest first, then by number descending)\n\nAvailable sort fields (prefix with `-` for descending):\n- `date_only`: Document date\n- `bill_number`: Document number\n- `contact_name`: Provider name\n- `sub_total`: Subtotal amount\n- `total`: Total amount\n\n**Example:** `sort=-total,date_only` (highest total first, then oldest date)\n\n\n## Important Notes\n\n1. **Consistent Results**: This API uses the same services and repositories as the UI, ensuring identical results\n2. **Performance**: The endpoint uses optimized queries with lazy loading for related data\n3. **Pagination**: Results are paginated (default 20 items per page, max 100)\n4. **Timezone**: All dates are in UTC. Document dates (`billed_at`) show local Ecuador time"
components:
  securitySchemes:
    default:
      type: apiKey
      name: x-api-key
      in: header
      description: 'Puedes obtener tu API key y Organization ID desde tu dashboard de TWS. <br><br>Debes incluir también el header <code>x-organization-id</code> con tu Organization ID.'
security:
  -
    default: []
paths:
  /api/v1/taxpayers:
    get:
      summary: 'List taxpayers'
      operationId: listTaxpayers
      description: "Retrieves a paginated list of all taxpayers belonging to the authenticated organization.\nYou can filter and sort the results using query parameters."
      parameters:
        -
          in: query
          name: page
          description: 'Page number for pagination. El campo value debe ser al menos 1.'
          example: 1
          required: false
          schema:
            type: integer
            description: 'Page number for pagination. El campo value debe ser al menos 1.'
            example: 1
            nullable: true
        -
          in: query
          name: per_page
          description: 'Number of items per page (max 100). El campo value debe ser al menos 1. El campo value no debe ser mayor que 100.'
          example: 20
          required: false
          schema:
            type: integer
            description: 'Number of items per page (max 100). El campo value debe ser al menos 1. El campo value no debe ser mayor que 100.'
            example: 20
            nullable: true
        -
          in: query
          name: sort
          description: 'Sort field and direction. Prefix with "-" for descending order.'
          example: '-created_at'
          required: false
          schema:
            type: string
            description: 'Sort field and direction. Prefix with "-" for descending order.'
            example: '-created_at'
            enum:
              - business_name
              - '-business_name'
              - tax_number
              - '-tax_number'
              - next_declaration
              - '-next_declaration'
              - created_at
              - '-created_at'
            nullable: true
        -
          in: query
          name: search
          description: 'Search term to filter by business name or tax number. El campo value no debe ser mayor que 255 caracteres.'
          example: 'Empresa S.A.'
          required: false
          schema:
            type: string
            description: 'Search term to filter by business name or tax number. El campo value no debe ser mayor que 255 caracteres.'
            example: 'Empresa S.A.'
            nullable: true
        -
          in: query
          name: status
          description: 'Filter by status (0=inactive, 1=active).'
          example: 1
          required: false
          schema:
            type: integer
            description: 'Filter by status (0=inactive, 1=active).'
            example: 1
            enum:
              - '0'
              - '1'
            nullable: true
        -
          in: query
          name: iva_period
          description: 'Filter by IVA period (MENSUAL, SEMESTRAL).'
          example: MENSUAL
          required: false
          schema:
            type: string
            description: 'Filter by IVA period (MENSUAL, SEMESTRAL).'
            example: MENSUAL
            enum:
              - MENSUAL
              - SEMESTRAL
            nullable: true
        -
          in: query
          name: tax_regime_cat
          description: 'Filter by tax regime category.'
          example: GENERAL
          required: false
          schema:
            type: string
            description: 'Filter by tax regime category.'
            example: GENERAL
            enum:
              - RISE
              - GENERAL
              - ESPECIAL
            nullable: true
        -
          in: query
          name: declaration_day
          description: 'Filter by declaration day (1-28). El campo value debe ser al menos 1. El campo value no debe ser mayor que 28.'
          example: 10
          required: false
          schema:
            type: integer
            description: 'Filter by declaration day (1-28). El campo value debe ser al menos 1. El campo value no debe ser mayor que 28.'
            example: 10
            nullable: true
        -
          in: header
          name: x-api-key
          description: ''
          example: YOUR_API_KEY_HERE
          schema:
            type: string
        -
          in: header
          name: x-organization-id
          description: ''
          example: '{YOUR_ORGANIZATION_ID}'
          schema:
            type: string
      responses:
        200:
          description: Success
          content:
            application/json:
              schema:
                type: object
                example:
                  status: success
                  message: 'Taxpayers retrieved successfully'
                  data:
                    taxpayers:
                      -
                        id: 144
                        ulid: 01HZXXX...
                        tax_number: '1726051285001'
                        business_name: 'EMPRESA DEMO S.A.'
                        trade_name: DEMO
                        tax_payer_status: ACTIVE
                        tax_regime: general
                        tax_regime_cat: general
                        iva_period: monthly
                        declaration_day: 12
                        required_to_keep_accounts: SI
                        withholding_agent: SI
                        special_contributor: 'NO'
                        economic_activity: 'Actividades de consultoría de gestión empresarial'
                        start_activities_date: '2020-01-15T00:00:00.000000Z'
                        created_at: '2024-01-15T10:30:00.000000Z'
                        updated_at: '2024-01-15T10:30:00.000000Z'
                  meta:
                    pagination:
                      total: 5
                      count: 5
                      per_page: 20
                      current_page: 1
                      total_pages: 1
                    filters:
                      status: ACTIVE
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: 'Taxpayers retrieved successfully'
                  data:
                    type: object
                    properties:
                      taxpayers:
                        type: array
                        example:
                          -
                            id: 144
                            ulid: 01HZXXX...
                            tax_number: '1726051285001'
                            business_name: 'EMPRESA DEMO S.A.'
                            trade_name: DEMO
                            tax_payer_status: ACTIVE
                            tax_regime: general
                            tax_regime_cat: general
                            iva_period: monthly
                            declaration_day: 12
                            required_to_keep_accounts: SI
                            withholding_agent: SI
                            special_contributor: 'NO'
                            economic_activity: 'Actividades de consultoría de gestión empresarial'
                            start_activities_date: '2020-01-15T00:00:00.000000Z'
                            created_at: '2024-01-15T10:30:00.000000Z'
                            updated_at: '2024-01-15T10:30:00.000000Z'
                        items:
                          type: object
                          properties:
                            id:
                              type: integer
                              example: 144
                            ulid:
                              type: string
                              example: 01HZXXX...
                            tax_number:
                              type: string
                              example: '1726051285001'
                            business_name:
                              type: string
                              example: 'EMPRESA DEMO S.A.'
                            trade_name:
                              type: string
                              example: DEMO
                            tax_payer_status:
                              type: string
                              example: ACTIVE
                            tax_regime:
                              type: string
                              example: general
                            tax_regime_cat:
                              type: string
                              example: general
                            iva_period:
                              type: string
                              example: monthly
                            declaration_day:
                              type: integer
                              example: 12
                            required_to_keep_accounts:
                              type: string
                              example: SI
                            withholding_agent:
                              type: string
                              example: SI
                            special_contributor:
                              type: string
                              example: 'NO'
                            economic_activity:
                              type: string
                              example: 'Actividades de consultoría de gestión empresarial'
                            start_activities_date:
                              type: string
                              example: '2020-01-15T00:00:00.000000Z'
                            created_at:
                              type: string
                              example: '2024-01-15T10:30:00.000000Z'
                            updated_at:
                              type: string
                              example: '2024-01-15T10:30:00.000000Z'
                  meta:
                    type: object
                    properties:
                      pagination:
                        type: object
                        properties:
                          total:
                            type: integer
                            example: 5
                          count:
                            type: integer
                            example: 5
                          per_page:
                            type: integer
                            example: 20
                          current_page:
                            type: integer
                            example: 1
                          total_pages:
                            type: integer
                            example: 1
                      filters:
                        type: object
                        properties:
                          status:
                            type: string
                            example: ACTIVE
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Invalid API key or organization ID'
                  code: UNAUTHORIZED
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Invalid API key or organization ID'
                  code:
                    type: string
                    example: UNAUTHORIZED
        500:
          description: 'Server error'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'An error occurred while retrieving taxpayers'
                  code: SERVER_ERROR
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'An error occurred while retrieving taxpayers'
                  code:
                    type: string
                    example: SERVER_ERROR
      tags:
        - Taxpayers
    post:
      summary: 'Create a new taxpayer'
      operationId: createANewTaxpayer
      description: "Creates a new taxpayer in your organization after validating that the tax identifier exists\nin the TWS (Tax Web Services) registry. Accepts RUC (13 digits), Cédula (10 digits), or Passport.\n\nThis endpoint will:\n1. Validate the taxpayer doesn't already exist in your organization\n2. Query the TWS registry API to verify the identifier is valid and active\n3. Create the taxpayer with all available data from TWS\n4. Automatically create default categories for document classification\n5. Set up auto-categorization rules\n\n**Note:** This process may take 5-10 seconds as it queries external services."
      parameters:
        -
          in: header
          name: x-api-key
          description: ''
          example: YOUR_API_KEY_HERE
          schema:
            type: string
        -
          in: header
          name: x-organization-id
          description: ''
          example: '{YOUR_ORGANIZATION_ID}'
          schema:
            type: string
      responses:
        201:
          description: 'Taxpayer created successfully'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: success
                  message: 'Taxpayer created successfully'
                  data:
                    taxpayer:
                      id: 01JDXYZ123ABC456DEF789GHI
                      tax_number: '1726051285001'
                      business_name: 'AGUIRRE MEJIA AIDA ISABEL'
                      legal_name: 'AGUIRRE MEJIA AIDA ISABEL'
                      email: null
                      phone: null
                      status: 1
                      tax_payer_status: ACTIVO
                      economic_activity: 'VENTA AL POR MAYOR DE FRUTAS'
                      tax_regime: GENERAL
                      tax_regime_cat: general
                      iva_period: monthly
                      category: null
                      required_to_keep_accounts: 'NO'
                      withholding_agent: 'NO'
                      special_contributor: 'NO'
                      declaration_day: 12
                      next_declaration: null
                      start_activities_date: '2018-09-04'
                      last_sync_at: null
                      created_at: '2024-12-02 15:30:45'
                      updated_at: '2024-12-02 15:30:45'
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: 'Taxpayer created successfully'
                  data:
                    type: object
                    properties:
                      taxpayer:
                        type: object
                        properties:
                          id:
                            type: string
                            example: 01JDXYZ123ABC456DEF789GHI
                          tax_number:
                            type: string
                            example: '1726051285001'
                          business_name:
                            type: string
                            example: 'AGUIRRE MEJIA AIDA ISABEL'
                          legal_name:
                            type: string
                            example: 'AGUIRRE MEJIA AIDA ISABEL'
                          email:
                            type: string
                            example: null
                          phone:
                            type: string
                            example: null
                          status:
                            type: integer
                            example: 1
                          tax_payer_status:
                            type: string
                            example: ACTIVO
                          economic_activity:
                            type: string
                            example: 'VENTA AL POR MAYOR DE FRUTAS'
                          tax_regime:
                            type: string
                            example: GENERAL
                          tax_regime_cat:
                            type: string
                            example: general
                          iva_period:
                            type: string
                            example: monthly
                          category:
                            type: string
                            example: null
                          required_to_keep_accounts:
                            type: string
                            example: 'NO'
                          withholding_agent:
                            type: string
                            example: 'NO'
                          special_contributor:
                            type: string
                            example: 'NO'
                          declaration_day:
                            type: integer
                            example: 12
                          next_declaration:
                            type: string
                            example: null
                          start_activities_date:
                            type: string
                            example: '2018-09-04'
                          last_sync_at:
                            type: string
                            example: null
                          created_at:
                            type: string
                            example: '2024-12-02 15:30:45'
                          updated_at:
                            type: string
                            example: '2024-12-02 15:30:45'
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Invalid API key or organization ID'
                  code: UNAUTHORIZED
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Invalid API key or organization ID'
                  code:
                    type: string
                    example: UNAUTHORIZED
        404:
          description: 'Taxpayer not found in TWS'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Taxpayer not found in TWS. Please verify the taxpayer ID'
                  code: TAXPAYER_NOT_FOUND_IN_TWS
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Taxpayer not found in TWS. Please verify the taxpayer ID'
                  code:
                    type: string
                    example: TAXPAYER_NOT_FOUND_IN_TWS
        409:
          description: 'Taxpayer already exists'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Taxpayer already exists for this organization'
                  code: TAXPAYER_ALREADY_EXISTS
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Taxpayer already exists for this organization'
                  code:
                    type: string
                    example: TAXPAYER_ALREADY_EXISTS
        422:
          description: 'Validation error'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Validation failed'
                  code: VALIDATION_ERROR
                  errors:
                    taxpayerId:
                      - 'The taxpayer ID can only contain letters, numbers, and hyphens'
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Validation failed'
                  code:
                    type: string
                    example: VALIDATION_ERROR
                  errors:
                    type: object
                    properties:
                      taxpayerId:
                        type: array
                        example:
                          - 'The taxpayer ID can only contain letters, numbers, and hyphens'
                        items:
                          type: string
        500:
          description: 'Internal server error'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Failed to create taxpayer due to an internal error'
                  code: INTERNAL_SERVER_ERROR
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Failed to create taxpayer due to an internal error'
                  code:
                    type: string
                    example: INTERNAL_SERVER_ERROR
        503:
          description: 'TWS service unavailable'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Unable to verify taxpayer with TWS app'
                  code: TWS_SERVICE_UNAVAILABLE
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Unable to verify taxpayer with TWS app'
                  code:
                    type: string
                    example: TWS_SERVICE_UNAVAILABLE
        504:
          description: 'TWS service timeout'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'TWS service timeout. Please try again later'
                  code: TWS_SERVICE_TIMEOUT
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'TWS service timeout. Please try again later'
                  code:
                    type: string
                    example: TWS_SERVICE_TIMEOUT
      tags:
        - Taxpayers
  '/api/v1/taxpayers/{taxNumber}':
    get:
      summary: 'Get a specific taxpayer'
      operationId: getASpecificTaxpayer
      description: "Retrieves detailed information for a specific taxpayer identified by their RUC number.\nThe taxpayer must belong to the authenticated organization."
      parameters:
        -
          in: header
          name: x-api-key
          description: ''
          example: YOUR_API_KEY_HERE
          schema:
            type: string
        -
          in: header
          name: x-organization-id
          description: ''
          example: '{YOUR_ORGANIZATION_ID}'
          schema:
            type: string
      responses:
        200:
          description: Success
          content:
            application/json:
              schema:
                type: object
                example:
                  status: success
                  message: 'Taxpayer retrieved successfully'
                  data:
                    taxpayer:
                      id: 144
                      ulid: 01HZXXX...
                      tax_number: '1726051285001'
                      business_name: 'EMPRESA DEMO S.A.'
                      trade_name: DEMO
                      address: 'Av. Principal 123 y Secundaria'
                      phone: '0987654321'
                      email: contacto@demo.com
                      legal_representatives: 'Juan Pérez, María González'
                      economic_activity: 'Actividades de consultoría de gestión empresarial'
                      tax_payer_status: ACTIVE
                      tax_payer_type: 'PERSONA JURÍDICA'
                      tax_regime: general
                      tax_regime_cat: general
                      category: null
                      iva_period: monthly
                      declaration_day: 12
                      required_to_keep_accounts: SI
                      withholding_agent: SI
                      special_contributor: 'NO'
                      ghost_taxpayer: 'NO'
                      nonexistent_transactions: 'NO'
                      start_activities_date: '2020-01-15T00:00:00.000000Z'
                      cessation_date: null
                      restart_activities_date: null
                      information_update_date: '2024-01-15T00:00:00.000000Z'
                      created_at: '2024-01-15T10:30:00.000000Z'
                      updated_at: '2024-01-15T10:30:00.000000Z'
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: 'Taxpayer retrieved successfully'
                  data:
                    type: object
                    properties:
                      taxpayer:
                        type: object
                        properties:
                          id:
                            type: integer
                            example: 144
                          ulid:
                            type: string
                            example: 01HZXXX...
                          tax_number:
                            type: string
                            example: '1726051285001'
                          business_name:
                            type: string
                            example: 'EMPRESA DEMO S.A.'
                          trade_name:
                            type: string
                            example: DEMO
                          address:
                            type: string
                            example: 'Av. Principal 123 y Secundaria'
                          phone:
                            type: string
                            example: '0987654321'
                          email:
                            type: string
                            example: contacto@demo.com
                          legal_representatives:
                            type: string
                            example: 'Juan Pérez, María González'
                          economic_activity:
                            type: string
                            example: 'Actividades de consultoría de gestión empresarial'
                          tax_payer_status:
                            type: string
                            example: ACTIVE
                          tax_payer_type:
                            type: string
                            example: 'PERSONA JURÍDICA'
                          tax_regime:
                            type: string
                            example: general
                          tax_regime_cat:
                            type: string
                            example: general
                          category:
                            type: string
                            example: null
                          iva_period:
                            type: string
                            example: monthly
                          declaration_day:
                            type: integer
                            example: 12
                          required_to_keep_accounts:
                            type: string
                            example: SI
                          withholding_agent:
                            type: string
                            example: SI
                          special_contributor:
                            type: string
                            example: 'NO'
                          ghost_taxpayer:
                            type: string
                            example: 'NO'
                          nonexistent_transactions:
                            type: string
                            example: 'NO'
                          start_activities_date:
                            type: string
                            example: '2020-01-15T00:00:00.000000Z'
                          cessation_date:
                            type: string
                            example: null
                          restart_activities_date:
                            type: string
                            example: null
                          information_update_date:
                            type: string
                            example: '2024-01-15T00:00:00.000000Z'
                          created_at:
                            type: string
                            example: '2024-01-15T10:30:00.000000Z'
                          updated_at:
                            type: string
                            example: '2024-01-15T10:30:00.000000Z'
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Invalid API key or organization ID'
                  code: UNAUTHORIZED
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Invalid API key or organization ID'
                  code:
                    type: string
                    example: UNAUTHORIZED
        404:
          description: 'Taxpayer not found'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Taxpayer not found'
                  code: TAXPAYER_NOT_FOUND
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Taxpayer not found'
                  code:
                    type: string
                    example: TAXPAYER_NOT_FOUND
        500:
          description: 'Server error'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'An error occurred while retrieving the taxpayer'
                  code: SERVER_ERROR
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'An error occurred while retrieving the taxpayer'
                  code:
                    type: string
                    example: SERVER_ERROR
      tags:
        - Taxpayers
    parameters:
      -
        in: path
        name: taxNumber
        description: "The taxpayer's RUC number (13 digits)."
        example: '1726051285001'
        required: true
        schema:
          type: string
  '/api/v1/taxpayers/{taxNumber}/categories':
    get:
      summary: 'Get taxpayer categories'
      operationId: getTaxpayerCategories
      description: "Retrieves a paginated list of categories for a specific taxpayer.\nCategories are used to classify purchase and sales documents."
      parameters:
        -
          in: query
          name: page
          description: 'Page number for pagination. El campo value debe ser al menos 1.'
          example: 1
          required: false
          schema:
            type: integer
            description: 'Page number for pagination. El campo value debe ser al menos 1.'
            example: 1
            nullable: true
        -
          in: query
          name: per_page
          description: 'Number of items per page (max 100). El campo value debe ser al menos 1. El campo value no debe ser mayor que 100.'
          example: 20
          required: false
          schema:
            type: integer
            description: 'Number of items per page (max 100). El campo value debe ser al menos 1. El campo value no debe ser mayor que 100.'
            example: 20
            nullable: true
        -
          in: query
          name: document_type
          description: 'Filter by document type (purchases or sales).'
          example: sales
          required: false
          schema:
            type: string
            description: 'Filter by document type (purchases or sales).'
            example: sales
            enum:
              - purchases
              - sales
            nullable: true
        -
          in: query
          name: category_type
          description: 'Filter by category type (personal_expenses, commercial_expenses, non_deductible_expenses, sales).'
          example: commercial_expenses
          required: false
          schema:
            type: string
            description: 'Filter by category type (personal_expenses, commercial_expenses, non_deductible_expenses, sales).'
            example: commercial_expenses
            enum:
              - personal_expenses
              - commercial_expenses
              - non_deductible_expenses
              - sales
            nullable: true
        -
          in: query
          name: enabled
          description: 'Filter by enabled status (1 or 0).'
          example: 1
          required: false
          schema:
            type: string
            description: 'Filter by enabled status (1 or 0).'
            example: 1
            nullable: true
        -
          in: query
          name: editable
          description: 'Filter by editable status (1 or 0).'
          example: 1
          required: false
          schema:
            type: string
            description: 'Filter by editable status (1 or 0).'
            example: 1
            nullable: true
        -
          in: query
          name: search
          description: 'Search term to filter by name, code, or description. El campo value no debe ser mayor que 255 caracteres.'
          example: Alimentación
          required: false
          schema:
            type: string
            description: 'Search term to filter by name, code, or description. El campo value no debe ser mayor que 255 caracteres.'
            example: Alimentación
            nullable: true
        -
          in: query
          name: filter
          description: ''
          example: null
          required: false
          schema:
            type: object
            description: ''
            example: null
            properties: {  }
            nullable: true
        -
          in: query
          name: filter.document_type
          description: ''
          example: sales
          required: false
          schema:
            type: string
            description: ''
            example: sales
            enum:
              - purchases
              - sales
            nullable: true
        -
          in: query
          name: filter.category_type
          description: ''
          example: non_deductible_expenses
          required: false
          schema:
            type: string
            description: ''
            example: non_deductible_expenses
            enum:
              - personal_expenses
              - commercial_expenses
              - non_deductible_expenses
              - sales
            nullable: true
        -
          in: query
          name: filter.enabled
          description: ''
          example: null
          required: false
          schema:
            type: string
            description: ''
            example: null
            nullable: true
        -
          in: query
          name: filter.editable
          description: ''
          example: null
          required: false
          schema:
            type: string
            description: ''
            example: null
            nullable: true
        -
          in: query
          name: filter.search
          description: 'El campo value no debe ser mayor que 255 caracteres.'
          example: vmqeopfuudtdsufvyvddq
          required: false
          schema:
            type: string
            description: 'El campo value no debe ser mayor que 255 caracteres.'
            example: vmqeopfuudtdsufvyvddq
            nullable: true
        -
          in: header
          name: x-api-key
          description: ''
          example: YOUR_API_KEY_HERE
          schema:
            type: string
        -
          in: header
          name: x-organization-id
          description: ''
          example: '{YOUR_ORGANIZATION_ID}'
          schema:
            type: string
      responses:
        200:
          description: Success
          content:
            application/json:
              schema:
                type: object
                example:
                  status: success
                  message: 'Categories retrieved successfully'
                  data:
                    categories:
                      -
                        id: 9857
                        name: Alimentación
                        code: D-001
                        description: null
                        icon: 'M20 10a5.27...'
                        color: bg-teal-500
                        document_type: purchases
                        category_type: personal_expenses
                        editable: false
                        has_been_edited: false
                        enabled: true
                        created_at: '2024-01-15T10:30:00.000000Z'
                        updated_at: '2024-01-15T10:30:00.000000Z'
                        archived_at: null
                  meta:
                    pagination:
                      total: 30
                      count: 20
                      per_page: 20
                      current_page: 1
                      total_pages: 2
                    filters:
                      document_type: purchases
                      enabled: true
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: 'Categories retrieved successfully'
                  data:
                    type: object
                    properties:
                      categories:
                        type: array
                        example:
                          -
                            id: 9857
                            name: Alimentación
                            code: D-001
                            description: null
                            icon: 'M20 10a5.27...'
                            color: bg-teal-500
                            document_type: purchases
                            category_type: personal_expenses
                            editable: false
                            has_been_edited: false
                            enabled: true
                            created_at: '2024-01-15T10:30:00.000000Z'
                            updated_at: '2024-01-15T10:30:00.000000Z'
                            archived_at: null
                        items:
                          type: object
                          properties:
                            id:
                              type: integer
                              example: 9857
                            name:
                              type: string
                              example: Alimentación
                            code:
                              type: string
                              example: D-001
                            description:
                              type: string
                              example: null
                            icon:
                              type: string
                              example: 'M20 10a5.27...'
                            color:
                              type: string
                              example: bg-teal-500
                            document_type:
                              type: string
                              example: purchases
                            category_type:
                              type: string
                              example: personal_expenses
                            editable:
                              type: boolean
                              example: false
                            has_been_edited:
                              type: boolean
                              example: false
                            enabled:
                              type: boolean
                              example: true
                            created_at:
                              type: string
                              example: '2024-01-15T10:30:00.000000Z'
                            updated_at:
                              type: string
                              example: '2024-01-15T10:30:00.000000Z'
                            archived_at:
                              type: string
                              example: null
                  meta:
                    type: object
                    properties:
                      pagination:
                        type: object
                        properties:
                          total:
                            type: integer
                            example: 30
                          count:
                            type: integer
                            example: 20
                          per_page:
                            type: integer
                            example: 20
                          current_page:
                            type: integer
                            example: 1
                          total_pages:
                            type: integer
                            example: 2
                      filters:
                        type: object
                        properties:
                          document_type:
                            type: string
                            example: purchases
                          enabled:
                            type: boolean
                            example: true
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Invalid API key or organization ID'
                  code: UNAUTHORIZED
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Invalid API key or organization ID'
                  code:
                    type: string
                    example: UNAUTHORIZED
        404:
          description: 'Taxpayer not found'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Taxpayer not found or access denied'
                  code: TAXPAYER_NOT_FOUND
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Taxpayer not found or access denied'
                  code:
                    type: string
                    example: TAXPAYER_NOT_FOUND
        500:
          description: 'Server error'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Failed to retrieve categories. Please try again later.'
                  code: SERVER_ERROR
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Failed to retrieve categories. Please try again later.'
                  code:
                    type: string
                    example: SERVER_ERROR
      tags:
        - Taxpayers
    parameters:
      -
        in: path
        name: taxNumber
        description: "The taxpayer's RUC number (13 digits)."
        example: '1726051285001'
        required: true
        schema:
          type: string
  '/api/v1/taxpayers/{taxNumber}/emitted':
    get:
      summary: 'List emitted documents for a taxpayer'
      operationId: listEmittedDocumentsForATaxpayer
      description: "Retrieves a paginated list of emitted documents (sales invoices) for a specific taxpayer.\nThis endpoint returns the same data as the UI emitted documents listing.\n\n**IMPORTANT:** This is a GET request. All parameters must be sent as query string parameters in the URL.\nDo NOT send a request body.\n\n**Example URLs:**\n\nBasic query with date range:\n```\nGET /api/v1/taxpayers/1726051285001/emitted?start_date=2024-01-01&end_date=2024-01-31&page=1&per_page=20\n```\n\nWith filters for general regime deductible invoices:\n```\nGET /api/v1/taxpayers/1726051285001/emitted?regime=general&deductible_type=deductible&status=AUTORIZADO\n```\n\n**Important - HTTP Headers:**\n- **Required headers**: `x-api-key`, `x-organization-id`, `Accept: application/json`\n- **Do NOT send**: `Content-Type: application/json` (this is a GET request, parameters go in the URL)\n\n**Filter Format:** All filters use top-level query parameters.\n\n**Filtering Examples:**\n\nFilter by regime (general only):\n```\nGET /api/v1/taxpayers/1726051285001/emitted?regime=general\n```\n\nFilter by deductibility (only deductible):\n```\nGET /api/v1/taxpayers/1726051285001/emitted?deductible_type=deductible\n```\n\nFilter by specific categories (multiple IDs allowed):\n```\nGET /api/v1/taxpayers/1726051285001/emitted?category_id[]=123&category_id[]=456\n```\n*Note: First retrieve available categories from GET /api/v1/taxpayers/{taxNumber}/categories?type=sales*\n\nFilter by status (authorized documents only):\n```\nGET /api/v1/taxpayers/1726051285001/emitted?status=AUTORIZADO\n```\n\nFilter by origin (only Datil-issued documents):\n```\nGET /api/v1/taxpayers/1726051285001/emitted?origin=datil\n```\n\nMultiple filters combined (real use case):\n```\nGET /api/v1/taxpayers/1726051285001/emitted?start_date=2024-01-01&end_date=2024-01-31&regime=general&deductible_type=deductible&status=AUTORIZADO\n```"
      parameters:
        -
          in: query
          name: start_date
          description: 'Start date for filtering (YYYY-MM-DD). Defaults to first day of current month.'
          example: null
          required: false
          schema:
            type: string
            description: 'Start date for filtering (YYYY-MM-DD). Defaults to first day of current month.'
            example: null
        -
          in: query
          name: end_date
          description: 'End date for filtering (YYYY-MM-DD). Defaults to last day of current month.'
          example: null
          required: false
          schema:
            type: string
            description: 'End date for filtering (YYYY-MM-DD). Defaults to last day of current month.'
            example: null
        -
          in: query
          name: page
          description: 'Page number for pagination. Default: 1.'
          example: null
          required: false
          schema:
            type: integer
            description: 'Page number for pagination. Default: 1.'
            example: null
        -
          in: query
          name: per_page
          description: 'Items per page (1-100). Default: 20.'
          example: null
          required: false
          schema:
            type: integer
            description: 'Items per page (1-100). Default: 20.'
            example: null
        -
          in: query
          name: 'category_id[]'
          description: 'Filter by category ID(s). Can pass multiple values using array notation. To obtain available category IDs for the taxpayer, use GET /api/v1/taxpayers/{taxNumber}/categories?type=sales.'
          example: null
          required: false
          schema:
            type: integer
            description: 'Filter by category ID(s). Can pass multiple values using array notation. To obtain available category IDs for the taxpayer, use GET /api/v1/taxpayers/{taxNumber}/categories?type=sales.'
            example: null
        -
          in: query
          name: regime
          description: 'Filter by tax regime. Must be one of: general, rimpe_entrepreneur, rimpe_popular_business.'
          example: null
          required: false
          schema:
            type: string
            description: 'Filter by tax regime. Must be one of: general, rimpe_entrepreneur, rimpe_popular_business.'
            example: null
        -
          in: query
          name: deductible_type
          description: 'Filter by tax deductibility. Must be one of: deductible, non_deductible.'
          example: null
          required: false
          schema:
            type: string
            description: 'Filter by tax deductibility. Must be one of: deductible, non_deductible.'
            example: null
        -
          in: query
          name: status
          description: 'Filter by document status. Must be one of: AUTORIZADO, ANULADO.'
          example: null
          required: false
          schema:
            type: string
            description: 'Filter by document status. Must be one of: AUTORIZADO, ANULADO.'
            example: null
        -
          in: query
          name: origin
          description: 'Filter by document origin/source system. Must be one of: datil, physical-upload, tws, xml-import.'
          example: null
          required: false
          schema:
            type: string
            description: 'Filter by document origin/source system. Must be one of: datil, physical-upload, tws, xml-import.'
            example: null
        -
          in: header
          name: x-api-key
          description: ''
          example: YOUR_API_KEY_HERE
          schema:
            type: string
        -
          in: header
          name: x-organization-id
          description: ''
          example: '{YOUR_ORGANIZATION_ID}'
          schema:
            type: string
      responses:
        200:
          description: ''
          content:
            application/json:
              schema:
                oneOf:
                  -
                    description: 'Success - with invoices'
                    type: object
                    example:
                      status: success
                      message: 'Emitted documents retrieved successfully'
                      data:
                        invoices:
                          -
                            id: 54321
                            ulid: 01HZYYY789DEF012
                            invoice_number: 001-001-000005678
                            access_key: '0101202401172605128500110010010000056781234567813'
                            invoiced_at: '2024-01-20T10:15:00.000000Z'
                            authorization_date: '2024-01-20T10:16:30.000000Z'
                            date_only: '2024-01-20'
                            invoice_status: AUTORIZADO
                            is_physical: false
                            is_sale_note: false
                            is_locked: false
                            lock_reason: null
                            locked_by_accountant: false
                            origin: datil
                            document_type: electronic
                            recipient:
                              tax_number: '9876543210001'
                              business_name: 'CLIENTE DEMO CIA. LTDA.'
                              email: cliente@example.com
                              phone: '0987654321'
                              address: 'Av. Cliente 456'
                              forced_to_accounting: true
                            payment:
                              payment_method: '20'
                              payment_amount: 224.0
                            totals:
                              subtotal_vat_zero: 0.0
                              subtotal_vat_five: 0.0
                              subtotal_vat_twelve: 200.0
                              subtotal_vat_thirteen: 0.0
                              subtotal_vat_fourteen: 0.0
                              subtotal_vat_fifteen: 0.0
                              subtotal_vat_special: 0.0
                              subtotal_vat_exempt: 0.0
                              subtotal_vat_not_subject: 0.0
                              sub_total: 200.0
                              discount: 0.0
                              tip: 0.0
                              subsidy: 0.0
                              total: 224.0
                            taxes:
                              vat_five: 0.0
                              vat_twelve: 24.0
                              vat_thirteen: 0.0
                              vat_fourteen: 0.0
                              vat_fifteen: 0.0
                              vat_special: 0.0
                              ice: 0.0
                              irbpnr: 0.0
                              total_tax: 24.0
                            tax_payer_category_id: 78
                            regime: general
                            deductible_type: deductible
                            categories:
                              - 78
                            regimes:
                              - general
                            deductible_types:
                              - deductible
                            categorized_by:
                              - manual
                            is_multicategory: false
                            has_credit_notes: false
                            has_withholdings: false
                            url_pdf: 'https://example.com/invoice.pdf'
                            xml_raw_url: 'https://example.com/invoice.xml'
                            notes: null
                            voided_at: null
                            voided_origin: null
                            created_at: '2024-01-20T10:17:00.000000Z'
                            updated_at: '2024-01-20T10:17:00.000000Z'
                      meta:
                        pagination:
                          current_page: 1
                          per_page: 20
                          total: 32
                          total_pages: 2
                          from: 1
                          to: 20
                        filters_applied:
                          start_date: '2024-01-01'
                          end_date: '2024-01-31'
                          regime: general
                          deductible_type: deductible
                          status: AUTORIZADO
                    properties:
                      status:
                        type: string
                        example: success
                      message:
                        type: string
                        example: 'Emitted documents retrieved successfully'
                      data:
                        type: object
                        properties:
                          invoices:
                            type: array
                            example:
                              -
                                id: 54321
                                ulid: 01HZYYY789DEF012
                                invoice_number: 001-001-000005678
                                access_key: '0101202401172605128500110010010000056781234567813'
                                invoiced_at: '2024-01-20T10:15:00.000000Z'
                                authorization_date: '2024-01-20T10:16:30.000000Z'
                                date_only: '2024-01-20'
                                invoice_status: AUTORIZADO
                                is_physical: false
                                is_sale_note: false
                                is_locked: false
                                lock_reason: null
                                locked_by_accountant: false
                                origin: datil
                                document_type: electronic
                                recipient:
                                  tax_number: '9876543210001'
                                  business_name: 'CLIENTE DEMO CIA. LTDA.'
                                  email: cliente@example.com
                                  phone: '0987654321'
                                  address: 'Av. Cliente 456'
                                  forced_to_accounting: true
                                payment:
                                  payment_method: '20'
                                  payment_amount: 224
                                totals:
                                  subtotal_vat_zero: 0
                                  subtotal_vat_five: 0
                                  subtotal_vat_twelve: 200
                                  subtotal_vat_thirteen: 0
                                  subtotal_vat_fourteen: 0
                                  subtotal_vat_fifteen: 0
                                  subtotal_vat_special: 0
                                  subtotal_vat_exempt: 0
                                  subtotal_vat_not_subject: 0
                                  sub_total: 200
                                  discount: 0
                                  tip: 0
                                  subsidy: 0
                                  total: 224
                                taxes:
                                  vat_five: 0
                                  vat_twelve: 24
                                  vat_thirteen: 0
                                  vat_fourteen: 0
                                  vat_fifteen: 0
                                  vat_special: 0
                                  ice: 0
                                  irbpnr: 0
                                  total_tax: 24
                                tax_payer_category_id: 78
                                regime: general
                                deductible_type: deductible
                                categories:
                                  - 78
                                regimes:
                                  - general
                                deductible_types:
                                  - deductible
                                categorized_by:
                                  - manual
                                is_multicategory: false
                                has_credit_notes: false
                                has_withholdings: false
                                url_pdf: 'https://example.com/invoice.pdf'
                                xml_raw_url: 'https://example.com/invoice.xml'
                                notes: null
                                voided_at: null
                                voided_origin: null
                                created_at: '2024-01-20T10:17:00.000000Z'
                                updated_at: '2024-01-20T10:17:00.000000Z'
                            items:
                              type: object
                              properties:
                                id:
                                  type: integer
                                  example: 54321
                                ulid:
                                  type: string
                                  example: 01HZYYY789DEF012
                                invoice_number:
                                  type: string
                                  example: 001-001-000005678
                                access_key:
                                  type: string
                                  example: '0101202401172605128500110010010000056781234567813'
                                invoiced_at:
                                  type: string
                                  example: '2024-01-20T10:15:00.000000Z'
                                authorization_date:
                                  type: string
                                  example: '2024-01-20T10:16:30.000000Z'
                                date_only:
                                  type: string
                                  example: '2024-01-20'
                                invoice_status:
                                  type: string
                                  example: AUTORIZADO
                                is_physical:
                                  type: boolean
                                  example: false
                                is_sale_note:
                                  type: boolean
                                  example: false
                                is_locked:
                                  type: boolean
                                  example: false
                                lock_reason:
                                  type: string
                                  example: null
                                locked_by_accountant:
                                  type: boolean
                                  example: false
                                origin:
                                  type: string
                                  example: datil
                                document_type:
                                  type: string
                                  example: electronic
                                recipient:
                                  type: object
                                  properties:
                                    tax_number:
                                      type: string
                                      example: '9876543210001'
                                    business_name:
                                      type: string
                                      example: 'CLIENTE DEMO CIA. LTDA.'
                                    email:
                                      type: string
                                      example: cliente@example.com
                                    phone:
                                      type: string
                                      example: '0987654321'
                                    address:
                                      type: string
                                      example: 'Av. Cliente 456'
                                    forced_to_accounting:
                                      type: boolean
                                      example: true
                                payment:
                                  type: object
                                  properties:
                                    payment_method:
                                      type: string
                                      example: '20'
                                    payment_amount:
                                      type: number
                                      example: 224.0
                                totals:
                                  type: object
                                  properties:
                                    subtotal_vat_zero:
                                      type: number
                                      example: 0.0
                                    subtotal_vat_five:
                                      type: number
                                      example: 0.0
                                    subtotal_vat_twelve:
                                      type: number
                                      example: 200.0
                                    subtotal_vat_thirteen:
                                      type: number
                                      example: 0.0
                                    subtotal_vat_fourteen:
                                      type: number
                                      example: 0.0
                                    subtotal_vat_fifteen:
                                      type: number
                                      example: 0.0
                                    subtotal_vat_special:
                                      type: number
                                      example: 0.0
                                    subtotal_vat_exempt:
                                      type: number
                                      example: 0.0
                                    subtotal_vat_not_subject:
                                      type: number
                                      example: 0.0
                                    sub_total:
                                      type: number
                                      example: 200.0
                                    discount:
                                      type: number
                                      example: 0.0
                                    tip:
                                      type: number
                                      example: 0.0
                                    subsidy:
                                      type: number
                                      example: 0.0
                                    total:
                                      type: number
                                      example: 224.0
                                taxes:
                                  type: object
                                  properties:
                                    vat_five:
                                      type: number
                                      example: 0.0
                                    vat_twelve:
                                      type: number
                                      example: 24.0
                                    vat_thirteen:
                                      type: number
                                      example: 0.0
                                    vat_fourteen:
                                      type: number
                                      example: 0.0
                                    vat_fifteen:
                                      type: number
                                      example: 0.0
                                    vat_special:
                                      type: number
                                      example: 0.0
                                    ice:
                                      type: number
                                      example: 0.0
                                    irbpnr:
                                      type: number
                                      example: 0.0
                                    total_tax:
                                      type: number
                                      example: 24.0
                                tax_payer_category_id:
                                  type: integer
                                  example: 78
                                regime:
                                  type: string
                                  example: general
                                deductible_type:
                                  type: string
                                  example: deductible
                                categories:
                                  type: array
                                  example:
                                    - 78
                                  items:
                                    type: integer
                                regimes:
                                  type: array
                                  example:
                                    - general
                                  items:
                                    type: string
                                deductible_types:
                                  type: array
                                  example:
                                    - deductible
                                  items:
                                    type: string
                                categorized_by:
                                  type: array
                                  example:
                                    - manual
                                  items:
                                    type: string
                                is_multicategory:
                                  type: boolean
                                  example: false
                                has_credit_notes:
                                  type: boolean
                                  example: false
                                has_withholdings:
                                  type: boolean
                                  example: false
                                url_pdf:
                                  type: string
                                  example: 'https://example.com/invoice.pdf'
                                xml_raw_url:
                                  type: string
                                  example: 'https://example.com/invoice.xml'
                                notes:
                                  type: string
                                  example: null
                                voided_at:
                                  type: string
                                  example: null
                                voided_origin:
                                  type: string
                                  example: null
                                created_at:
                                  type: string
                                  example: '2024-01-20T10:17:00.000000Z'
                                updated_at:
                                  type: string
                                  example: '2024-01-20T10:17:00.000000Z'
                      meta:
                        type: object
                        properties:
                          pagination:
                            type: object
                            properties:
                              current_page:
                                type: integer
                                example: 1
                              per_page:
                                type: integer
                                example: 20
                              total:
                                type: integer
                                example: 32
                              total_pages:
                                type: integer
                                example: 2
                              from:
                                type: integer
                                example: 1
                              to:
                                type: integer
                                example: 20
                          filters_applied:
                            type: object
                            properties:
                              start_date:
                                type: string
                                example: '2024-01-01'
                              end_date:
                                type: string
                                example: '2024-01-31'
                              regime:
                                type: string
                                example: general
                              deductible_type:
                                type: string
                                example: deductible
                              status:
                                type: string
                                example: AUTORIZADO
                  -
                    description: 'Success - no invoices found'
                    type: object
                    example:
                      status: success
                      message: 'Emitted documents retrieved successfully'
                      data:
                        invoices: []
                      meta:
                        pagination:
                          current_page: 1
                          per_page: 20
                          total: 0
                          total_pages: 0
                          from: 0
                          to: 0
                        filters_applied:
                          start_date: '2024-12-01'
                          end_date: '2024-12-31'
                    properties:
                      status:
                        type: string
                        example: success
                      message:
                        type: string
                        example: 'Emitted documents retrieved successfully'
                      data:
                        type: object
                        properties:
                          invoices:
                            type: array
                            example: []
                      meta:
                        type: object
                        properties:
                          pagination:
                            type: object
                            properties:
                              current_page:
                                type: integer
                                example: 1
                              per_page:
                                type: integer
                                example: 20
                              total:
                                type: integer
                                example: 0
                              total_pages:
                                type: integer
                                example: 0
                              from:
                                type: integer
                                example: 0
                              to:
                                type: integer
                                example: 0
                          filters_applied:
                            type: object
                            properties:
                              start_date:
                                type: string
                                example: '2024-12-01'
                              end_date:
                                type: string
                                example: '2024-12-31'
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Invalid API key or organization ID'
                  code: UNAUTHORIZED
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Invalid API key or organization ID'
                  code:
                    type: string
                    example: UNAUTHORIZED
        404:
          description: 'Taxpayer not found'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Taxpayer not found'
                  code: NOT_FOUND
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Taxpayer not found'
                  code:
                    type: string
                    example: NOT_FOUND
        422:
          description: 'Invalid filter'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Validation failed'
                  code: VALIDATION_ERROR
                  errors:
                    start_date:
                      - 'The start date field must be a valid date in YYYY-MM-DD format'
                    per_page:
                      - 'The per page must not be greater than 100'
                    regime:
                      - 'Invalid regime. Must be one of: general, rimpe_entrepreneur, rimpe_popular_business'
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Validation failed'
                  code:
                    type: string
                    example: VALIDATION_ERROR
                  errors:
                    type: object
                    properties:
                      start_date:
                        type: array
                        example:
                          - 'The start date field must be a valid date in YYYY-MM-DD format'
                        items:
                          type: string
                      per_page:
                        type: array
                        example:
                          - 'The per page must not be greater than 100'
                        items:
                          type: string
                      regime:
                        type: array
                        example:
                          - 'Invalid regime. Must be one of: general, rimpe_entrepreneur, rimpe_popular_business'
                        items:
                          type: string
      tags:
        - 'Emitted Documents'
    parameters:
      -
        in: path
        name: taxNumber
        description: "The taxpayer's RUC number (13 digits)."
        example: '1726051285001'
        required: true
        schema:
          type: string
  '/api/v1/taxpayers/{taxNumber}/emitted/accumulated':
    get:
      summary: 'Get accumulated totals for emitted documents'
      operationId: getAccumulatedTotalsForEmittedDocuments
      description: "Retrieves aggregated totals and statistics for emitted documents (sales invoices) based on the applied filters.\nThis endpoint complements the emitted documents listing endpoint by providing calculated totals.\n\n**IMPORTANT:** This is a GET request. All parameters must be sent as query string parameters in the URL.\nDo NOT send a request body.\n\n**What This Endpoint Returns:**\n\n- **Subtotals by VAT rate**: Detailed breakdown of subtotals for each VAT rate (15%, 14%, 13%, 12%, 5%, 0%, exempt, not subject)\n- **VAT amounts**: Total VAT charged at each rate\n- **Discounts**: Discounts applied at each VAT rate\n- **Header totals**: Simplified totals (subtotal, taxes, total)\n- **Document counts**: Total documents, categorized, uncategorized, voided\n- **Applied filters**: Summary of which filters were used\n\n**⚠️ Understanding `total_sum` vs `total_header`:**\n\nThe response includes TWO total values that may differ slightly:\n\n- **`total_sum`**: Direct sum of the `total` field from each document.\n  - This is the **OFFICIAL** total authorized by SRI for each document.\n  - **Use this for**: Official reports, tax declarations, accounting records.\n  - Example: If 3 invoices have totals of 100.00, 200.00, and 300.00, then `total_sum` = 600.00\n\n- **`total_header`**: Calculated by summing adjusted subtotals + recalculated VAT per document.\n  - VAT is recalculated as: `round((subtotal - discount) * vat_rate, 2)` for each document.\n  - May differ from `total_sum` by a few cents due to rounding differences.\n  - **Use this for**: Internal consistency checks, discount distribution analysis.\n\n**Why the difference?**\nWhen documents are issued, the SRI-authorized VAT may differ slightly from a strict mathematical recalculation\ndue to rounding rules applied by different systems (Datil, manual entry, XML imports, etc.). The `total_sum`\nrespects the original authorized values, while `total_header` applies uniform recalculation logic.\n\n**Recommendation:** For official purposes, always use `total_sum` as it represents the actual authorized totals.\n\n**Use Cases:**\n\n- Display statistics cards in dashboard (like UI)\n- Generate financial reports\n- Validate VAT calculations for sales\n- Monitor categorization progress\n- Calculate revenue and tax collection\n\n**Example URLs:**\n\nGet totals for current month:\n```\nGET /api/v1/taxpayers/1726051285001/emitted/accumulated\n```\n\nGet totals for specific date range:\n```\nGET /api/v1/taxpayers/1726051285001/emitted/accumulated?start_date=2024-01-01&end_date=2024-01-31\n```\n\nGet totals for general regime and authorized status:\n```\nGET /api/v1/taxpayers/1726051285001/emitted/accumulated?regime=general&status=AUTORIZADO\n```\n\n**Filters:**\n\nThis endpoint accepts the **same filters** as the emitted invoices listing endpoint:\n- `start_date`, `end_date`: Date range (defaults to current month)\n- `category_id[]`: Specific category IDs (array)\n- `deductible_type`: Tax deductibility (deductible, non_deductible)\n- `regime`: Tax regime (general, rimpe_entrepreneur, rimpe_popular_business)\n- `status`: Document status (AUTORIZADO, ANULADO)\n- `origin`: Document origin (datil, physical-upload, tws, xml-import)\n\n**Note:** Pagination parameters (page, per_page) and sort are ignored as this endpoint returns a single aggregated result."
      parameters:
        -
          in: query
          name: start_date
          description: 'Start date for filtering (YYYY-MM-DD). Defaults to first day of current month.'
          example: null
          required: false
          schema:
            type: string
            description: 'Start date for filtering (YYYY-MM-DD). Defaults to first day of current month.'
            example: null
        -
          in: query
          name: end_date
          description: 'End date for filtering (YYYY-MM-DD). Defaults to last day of current month.'
          example: null
          required: false
          schema:
            type: string
            description: 'End date for filtering (YYYY-MM-DD). Defaults to last day of current month.'
            example: null
        -
          in: query
          name: 'category_id[]'
          description: 'Filter by category ID(s). Can pass multiple values using array notation. To obtain available category IDs for the taxpayer, use GET /api/v1/taxpayers/{taxNumber}/categories?type=sales.'
          example: null
          required: false
          schema:
            type: integer
            description: 'Filter by category ID(s). Can pass multiple values using array notation. To obtain available category IDs for the taxpayer, use GET /api/v1/taxpayers/{taxNumber}/categories?type=sales.'
            example: null
        -
          in: query
          name: deductible_type
          description: 'Filter by tax deductibility. Must be one of: deductible, non_deductible.'
          example: null
          required: false
          schema:
            type: string
            description: 'Filter by tax deductibility. Must be one of: deductible, non_deductible.'
            example: null
        -
          in: query
          name: regime
          description: 'Filter by tax regime. Must be one of: general, rimpe_entrepreneur, rimpe_popular_business.'
          example: null
          required: false
          schema:
            type: string
            description: 'Filter by tax regime. Must be one of: general, rimpe_entrepreneur, rimpe_popular_business.'
            example: null
        -
          in: query
          name: status
          description: 'Filter by document status. Must be one of: AUTORIZADO, ANULADO.'
          example: null
          required: false
          schema:
            type: string
            description: 'Filter by document status. Must be one of: AUTORIZADO, ANULADO.'
            example: null
        -
          in: query
          name: origin
          description: 'Filter by document origin/source system. Must be one of: datil, physical-upload, tws, xml-import.'
          example: null
          required: false
          schema:
            type: string
            description: 'Filter by document origin/source system. Must be one of: datil, physical-upload, tws, xml-import.'
            example: null
        -
          in: header
          name: x-api-key
          description: ''
          example: YOUR_API_KEY_HERE
          schema:
            type: string
        -
          in: header
          name: x-organization-id
          description: ''
          example: '{YOUR_ORGANIZATION_ID}'
          schema:
            type: string
      responses:
        200:
          description: ''
          content:
            application/json:
              schema:
                oneOf:
                  -
                    description: 'Success - Current month totals'
                    type: object
                    example:
                      status: success
                      message: 'Emitted documents accumulated totals retrieved successfully'
                      data:
                        totals:
                          subtotal_vat_fifteen_sum: 200.0
                          discount_vat_fifteen_sum: 0
                          vat_fifteen_sum: 30.0
                          subtotal_vat_fourteen_sum: 0
                          discount_vat_fourteen_sum: 0
                          vat_fourteen_sum: 0
                          subtotal_vat_thirteen_sum: 0
                          discount_vat_thirteen_sum: 0
                          vat_thirteen_sum: 0
                          subtotal_vat_twelve_sum: 150.0
                          discount_vat_twelve_sum: 0
                          vat_twelve_sum: 18.0
                          subtotal_vat_five_sum: 0
                          discount_vat_five_sum: 0
                          vat_five_sum: 0
                          subtotal_vat_special_sum: 0
                          discount_vat_special_sum: 0
                          vat_special_sum: 0
                          subtotal_vat_zero_sum: 100.0
                          discount_vat_zero_sum: 0
                          subtotal_vat_exempt_sum: 0
                          discount_vat_exempt_sum: 0
                          subtotal_vat_not_subject_sum: 0
                          discount_vat_not_subject_sum: 0
                          sub_total_sum: 450.0
                          tip_sum: 0
                          subsidy_sum: 0
                          discount_sum: 0
                          total_sum: 498.0
                          subtotal_header: 450.0
                          taxes_header: 48.0
                          subtotal_taxes_header: 498.0
                          total_header: 498.0
                          document_count: 15
                          categorized_document_count: 12
                          uncategorized_document_count: 3
                          voided_document_count: 2
                        totals_explanation:
                          total_sum: "Direct sum of 'total' field from documents (SRI-authorized values). Use for official reports."
                          total_header: 'Calculated from subtotals + recalculated VAT. May differ slightly from total_sum due to rounding.'
                      meta:
                        filters_applied:
                          start_date: '2024-12-01'
                          end_date: '2024-12-31'
                    properties:
                      status:
                        type: string
                        example: success
                      message:
                        type: string
                        example: 'Emitted documents accumulated totals retrieved successfully'
                      data:
                        type: object
                        properties:
                          totals:
                            type: object
                            properties:
                              subtotal_vat_fifteen_sum:
                                type: number
                                example: 200.0
                              discount_vat_fifteen_sum:
                                type: integer
                                example: 0
                              vat_fifteen_sum:
                                type: number
                                example: 30.0
                              subtotal_vat_fourteen_sum:
                                type: integer
                                example: 0
                              discount_vat_fourteen_sum:
                                type: integer
                                example: 0
                              vat_fourteen_sum:
                                type: integer
                                example: 0
                              subtotal_vat_thirteen_sum:
                                type: integer
                                example: 0
                              discount_vat_thirteen_sum:
                                type: integer
                                example: 0
                              vat_thirteen_sum:
                                type: integer
                                example: 0
                              subtotal_vat_twelve_sum:
                                type: number
                                example: 150.0
                              discount_vat_twelve_sum:
                                type: integer
                                example: 0
                              vat_twelve_sum:
                                type: number
                                example: 18.0
                              subtotal_vat_five_sum:
                                type: integer
                                example: 0
                              discount_vat_five_sum:
                                type: integer
                                example: 0
                              vat_five_sum:
                                type: integer
                                example: 0
                              subtotal_vat_special_sum:
                                type: integer
                                example: 0
                              discount_vat_special_sum:
                                type: integer
                                example: 0
                              vat_special_sum:
                                type: integer
                                example: 0
                              subtotal_vat_zero_sum:
                                type: number
                                example: 100.0
                              discount_vat_zero_sum:
                                type: integer
                                example: 0
                              subtotal_vat_exempt_sum:
                                type: integer
                                example: 0
                              discount_vat_exempt_sum:
                                type: integer
                                example: 0
                              subtotal_vat_not_subject_sum:
                                type: integer
                                example: 0
                              discount_vat_not_subject_sum:
                                type: integer
                                example: 0
                              sub_total_sum:
                                type: number
                                example: 450.0
                              tip_sum:
                                type: integer
                                example: 0
                              subsidy_sum:
                                type: integer
                                example: 0
                              discount_sum:
                                type: integer
                                example: 0
                              total_sum:
                                type: number
                                example: 498.0
                              subtotal_header:
                                type: number
                                example: 450.0
                              taxes_header:
                                type: number
                                example: 48.0
                              subtotal_taxes_header:
                                type: number
                                example: 498.0
                              total_header:
                                type: number
                                example: 498.0
                              document_count:
                                type: integer
                                example: 15
                              categorized_document_count:
                                type: integer
                                example: 12
                              uncategorized_document_count:
                                type: integer
                                example: 3
                              voided_document_count:
                                type: integer
                                example: 2
                          totals_explanation:
                            type: object
                            properties:
                              total_sum:
                                type: string
                                example: "Direct sum of 'total' field from documents (SRI-authorized values). Use for official reports."
                              total_header:
                                type: string
                                example: 'Calculated from subtotals + recalculated VAT. May differ slightly from total_sum due to rounding.'
                      meta:
                        type: object
                        properties:
                          filters_applied:
                            type: object
                            properties:
                              start_date:
                                type: string
                                example: '2024-12-01'
                              end_date:
                                type: string
                                example: '2024-12-31'
                  -
                    description: 'Success - Showing rounding difference'
                    type: object
                    example:
                      status: success
                      message: 'Emitted documents accumulated totals retrieved successfully'
                      data:
                        totals:
                          subtotal_vat_fifteen_sum: 25624.64
                          vat_fifteen_sum: 3844.31
                          subtotal_vat_zero_sum: 0
                          sub_total_sum: 25624.64
                          total_sum: 29468.92
                          subtotal_header: 25624.64
                          taxes_header: 3844.31
                          total_header: 29468.95
                          document_count: 1005
                          categorized_document_count: 1005
                          uncategorized_document_count: 0
                          voided_document_count: 0
                        totals_explanation:
                          total_sum: "Direct sum of 'total' field from documents (SRI-authorized values). Use for official reports."
                          total_header: 'Calculated from subtotals + recalculated VAT. May differ slightly from total_sum due to rounding.'
                          difference: 'In this example, total_header (29468.95) differs from total_sum (29468.92) by 0.03 due to VAT rounding in individual documents.'
                      meta:
                        filters_applied:
                          start_date: '2025-10-01'
                          end_date: '2025-10-31'
                          regime: general
                          status: AUTORIZADO
                    properties:
                      status:
                        type: string
                        example: success
                      message:
                        type: string
                        example: 'Emitted documents accumulated totals retrieved successfully'
                      data:
                        type: object
                        properties:
                          totals:
                            type: object
                            properties:
                              subtotal_vat_fifteen_sum:
                                type: number
                                example: 25624.64
                              vat_fifteen_sum:
                                type: number
                                example: 3844.31
                              subtotal_vat_zero_sum:
                                type: integer
                                example: 0
                              sub_total_sum:
                                type: number
                                example: 25624.64
                              total_sum:
                                type: number
                                example: 29468.92
                              subtotal_header:
                                type: number
                                example: 25624.64
                              taxes_header:
                                type: number
                                example: 3844.31
                              total_header:
                                type: number
                                example: 29468.95
                              document_count:
                                type: integer
                                example: 1005
                              categorized_document_count:
                                type: integer
                                example: 1005
                              uncategorized_document_count:
                                type: integer
                                example: 0
                              voided_document_count:
                                type: integer
                                example: 0
                          totals_explanation:
                            type: object
                            properties:
                              total_sum:
                                type: string
                                example: "Direct sum of 'total' field from documents (SRI-authorized values). Use for official reports."
                              total_header:
                                type: string
                                example: 'Calculated from subtotals + recalculated VAT. May differ slightly from total_sum due to rounding.'
                              difference:
                                type: string
                                example: 'In this example, total_header (29468.95) differs from total_sum (29468.92) by 0.03 due to VAT rounding in individual documents.'
                      meta:
                        type: object
                        properties:
                          filters_applied:
                            type: object
                            properties:
                              start_date:
                                type: string
                                example: '2025-10-01'
                              end_date:
                                type: string
                                example: '2025-10-31'
                              regime:
                                type: string
                                example: general
                              status:
                                type: string
                                example: AUTORIZADO
        401:
          description: 'Unauthorized - Invalid API Key'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Invalid API key'
                  code: INVALID_API_KEY
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Invalid API key'
                  code:
                    type: string
                    example: INVALID_API_KEY
        403:
          description: 'Forbidden - Taxpayer not accessible'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'You do not have access to this taxpayer'
                  code: TAXPAYER_ACCESS_DENIED
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'You do not have access to this taxpayer'
                  code:
                    type: string
                    example: TAXPAYER_ACCESS_DENIED
        404:
          description: 'Not Found - Taxpayer does not exist'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Taxpayer not found'
                  code: TAXPAYER_NOT_FOUND
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Taxpayer not found'
                  code:
                    type: string
                    example: TAXPAYER_NOT_FOUND
        422:
          description: 'Validation Error'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Validation failed'
                  code: VALIDATION_ERROR
                  errors:
                    start_date:
                      - 'The start date field must be a valid date in YYYY-MM-DD format.'
                    regime:
                      - 'Invalid regime. Must be one of: general, rimpe_entrepreneur, rimpe_popular_business.'
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Validation failed'
                  code:
                    type: string
                    example: VALIDATION_ERROR
                  errors:
                    type: object
                    properties:
                      start_date:
                        type: array
                        example:
                          - 'The start date field must be a valid date in YYYY-MM-DD format.'
                        items:
                          type: string
                      regime:
                        type: array
                        example:
                          - 'Invalid regime. Must be one of: general, rimpe_entrepreneur, rimpe_popular_business.'
                        items:
                          type: string
        500:
          description: 'Server Error'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'An error occurred while retrieving accumulated totals'
                  code: SERVER_ERROR
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'An error occurred while retrieving accumulated totals'
                  code:
                    type: string
                    example: SERVER_ERROR
      tags:
        - 'Emitted Documents'
    parameters:
      -
        in: path
        name: taxNumber
        description: "The taxpayer's RUC number (13 digits)."
        example: '1726051285001'
        required: true
        schema:
          type: string
  '/api/v1/taxpayers/{taxNumber}/emitted/count':
    get:
      summary: 'Get count of all emitted documents types'
      operationId: getCountOfAllEmittedDocumentsTypes
      description: "Retrieves document counts across all emitted document types (sales invoices, credit notes, withholdings, settlements)\nfor a specific taxpayer and time period.\n\nThis endpoint aggregates data from four tables:\n- **invoices**: Sales invoices (Facturas de Venta)\n- **sale_credit_notes**: Credit notes applied to sales (Notas de Crédito de Venta)\n- **sale_withholdings**: Withholdings issued to sellers (Retenciones Emitidas)\n- **sale_settlements**: Purchase settlements (Liquidaciones de Compra)\n\n**IMPORTANT:** This is a GET request. All parameters must be sent as query string parameters in the URL.\nDo NOT send a request body.\n\n**Default Behavior:**\n- If no date range is specified, returns counts for the current month\n- Only counts documents that belong to the authenticated taxpayer and team (organization)\n- Excludes deleted documents (soft deletes)\n\n**Use Cases:**\n- Dashboard statistics showing total documents emitted\n- Monthly/period document volume analysis\n- Document type distribution reports\n- Compliance verification (ensuring all document types are being processed)\n- Sales performance tracking\n- Invoice generation monitoring\n\n**Example URLs:**\n\nGet counts for current month:\n```\nGET /api/v1/taxpayers/1726051285001/emitted/count\n```\n\nGet counts for specific period:\n```\nGET /api/v1/taxpayers/1726051285001/emitted/count?start_date=2024-01-01&end_date=2024-01-31\n```\n\nGet counts for entire year:\n```\nGET /api/v1/taxpayers/1726051285001/emitted/count?start_date=2024-01-01&end_date=2024-12-31\n```"
      parameters:
        -
          in: query
          name: start_date
          description: 'Start date for counting (YYYY-MM-DD). Defaults to first day of current month.'
          example: null
          required: false
          schema:
            type: string
            description: 'Start date for counting (YYYY-MM-DD). Defaults to first day of current month.'
            example: null
        -
          in: query
          name: end_date
          description: 'End date for counting (YYYY-MM-DD). Defaults to last day of current month.'
          example: null
          required: false
          schema:
            type: string
            description: 'End date for counting (YYYY-MM-DD). Defaults to last day of current month.'
            example: null
        -
          in: header
          name: x-api-key
          description: ''
          example: YOUR_API_KEY_HERE
          schema:
            type: string
        -
          in: header
          name: x-organization-id
          description: ''
          example: '{YOUR_ORGANIZATION_ID}'
          schema:
            type: string
      responses:
        200:
          description: ''
          content:
            application/json:
              schema:
                oneOf:
                  -
                    description: 'Success - Current month'
                    type: object
                    example:
                      status: success
                      message: 'Emitted documents count retrieved successfully'
                      data:
                        counts:
                          invoices: 120
                          credit_notes: 5
                          withholdings: 18
                          settlements: 2
                          total: 145
                        period:
                          start_date: '2024-12-01'
                          end_date: '2024-12-31'
                    properties:
                      status:
                        type: string
                        example: success
                      message:
                        type: string
                        example: 'Emitted documents count retrieved successfully'
                      data:
                        type: object
                        properties:
                          counts:
                            type: object
                            properties:
                              invoices:
                                type: integer
                                example: 120
                              credit_notes:
                                type: integer
                                example: 5
                              withholdings:
                                type: integer
                                example: 18
                              settlements:
                                type: integer
                                example: 2
                              total:
                                type: integer
                                example: 145
                          period:
                            type: object
                            properties:
                              start_date:
                                type: string
                                example: '2024-12-01'
                              end_date:
                                type: string
                                example: '2024-12-31'
                  -
                    description: 'Success - Custom period'
                    type: object
                    example:
                      status: success
                      message: 'Emitted documents count retrieved successfully'
                      data:
                        counts:
                          invoices: 450
                          credit_notes: 15
                          withholdings: 65
                          settlements: 8
                          total: 538
                        period:
                          start_date: '2024-01-01'
                          end_date: '2024-03-31'
                    properties:
                      status:
                        type: string
                        example: success
                      message:
                        type: string
                        example: 'Emitted documents count retrieved successfully'
                      data:
                        type: object
                        properties:
                          counts:
                            type: object
                            properties:
                              invoices:
                                type: integer
                                example: 450
                              credit_notes:
                                type: integer
                                example: 15
                              withholdings:
                                type: integer
                                example: 65
                              settlements:
                                type: integer
                                example: 8
                              total:
                                type: integer
                                example: 538
                          period:
                            type: object
                            properties:
                              start_date:
                                type: string
                                example: '2024-01-01'
                              end_date:
                                type: string
                                example: '2024-03-31'
                  -
                    description: 'Success - No documents'
                    type: object
                    example:
                      status: success
                      message: 'Emitted documents count retrieved successfully'
                      data:
                        counts:
                          invoices: 0
                          credit_notes: 0
                          withholdings: 0
                          settlements: 0
                          total: 0
                        period:
                          start_date: '2024-12-01'
                          end_date: '2024-12-31'
                    properties:
                      status:
                        type: string
                        example: success
                      message:
                        type: string
                        example: 'Emitted documents count retrieved successfully'
                      data:
                        type: object
                        properties:
                          counts:
                            type: object
                            properties:
                              invoices:
                                type: integer
                                example: 0
                              credit_notes:
                                type: integer
                                example: 0
                              withholdings:
                                type: integer
                                example: 0
                              settlements:
                                type: integer
                                example: 0
                              total:
                                type: integer
                                example: 0
                          period:
                            type: object
                            properties:
                              start_date:
                                type: string
                                example: '2024-12-01'
                              end_date:
                                type: string
                                example: '2024-12-31'
        401:
          description: 'Unauthorized - Invalid API Key'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Invalid API key'
                  code: INVALID_API_KEY
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Invalid API key'
                  code:
                    type: string
                    example: INVALID_API_KEY
        403:
          description: 'Forbidden - Taxpayer not accessible'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'You do not have access to this taxpayer'
                  code: TAXPAYER_ACCESS_DENIED
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'You do not have access to this taxpayer'
                  code:
                    type: string
                    example: TAXPAYER_ACCESS_DENIED
        404:
          description: 'Not Found - Taxpayer does not exist'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Taxpayer not found'
                  code: TAXPAYER_NOT_FOUND
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Taxpayer not found'
                  code:
                    type: string
                    example: TAXPAYER_NOT_FOUND
        422:
          description: 'Validation Error'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Validation failed'
                  code: VALIDATION_ERROR
                  errors:
                    start_date:
                      - 'The start date field must be a valid date in YYYY-MM-DD format.'
                    end_date:
                      - 'The end date must be equal to or after the start date.'
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Validation failed'
                  code:
                    type: string
                    example: VALIDATION_ERROR
                  errors:
                    type: object
                    properties:
                      start_date:
                        type: array
                        example:
                          - 'The start date field must be a valid date in YYYY-MM-DD format.'
                        items:
                          type: string
                      end_date:
                        type: array
                        example:
                          - 'The end date must be equal to or after the start date.'
                        items:
                          type: string
        500:
          description: 'Server Error'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'An error occurred while retrieving document counts'
                  code: SERVER_ERROR
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'An error occurred while retrieving document counts'
                  code:
                    type: string
                    example: SERVER_ERROR
      tags:
        - 'Emitted Documents'
    parameters:
      -
        in: path
        name: taxNumber
        description: "The taxpayer's RUC number (13 digits)."
        example: '1726051285001'
        required: true
        schema:
          type: string
  '/api/v1/taxpayers/{taxNumber}/emitted/clients/{contactTaxNumber}/totals':
    get:
      summary: 'Get accumulated totals for a specific client (Customer)'
      operationId: getAccumulatedTotalsForASpecificClientCustomer
      description: "Retrieves aggregated totals and statistics for emitted documents to a specific client (customer).\nThis endpoint filters all invoices by the client's tax number and applies additional filters.\n\n**IMPORTANT:** This is a GET request. All parameters must be sent as query string parameters in the URL.\nDo NOT send a request body.\n\n**What This Endpoint Returns:**\n\n- **Subtotals by VAT rate**: Detailed breakdown of subtotals for each VAT rate (15%, 14%, 13%, 12%, 5%, 0%, exempt, not subject)\n- **VAT amounts**: Total VAT charged at each rate\n- **Discounts**: Discounts applied at each VAT rate\n- **Header totals**: Simplified totals (subtotal, taxes, total)\n- **Document counts**: Total documents, categorized, uncategorized, voided\n- **Applied filters**: Summary of which filters were used (including client filter)\n\n**⚠️ Understanding `total_sum` vs `total_header`:**\n\nThe response includes TWO total values that may differ slightly:\n\n- **`total_sum`**: Direct sum of the `total` field from each document (SRI-authorized values). **Use for official reports.**\n- **`total_header`**: Calculated from subtotals + recalculated VAT. May differ by a few cents due to rounding.\n\nSee the `/emitted/accumulated` endpoint documentation for detailed explanation of this difference.\n\n**Use Cases:**\n\n- Analyze sales to a specific client\n- Client performance and revenue reports\n- Validate client invoices and totals\n- Calculate client-specific discounts and benefits\n- Client comparison and ranking reports\n- Credit analysis and payment behavior\n\n**Example URLs:**\n\nGet totals for specific client (current month):\n```\nGET /api/v1/taxpayers/1726051285001/emitted/clients/0998765432001/totals\n```\n\nGet totals for specific client and date range:\n```\nGET /api/v1/taxpayers/1726051285001/emitted/clients/0998765432001/totals?start_date=2024-01-01&end_date=2024-12-31\n```\n\nGet general regime sales totals to specific client:\n```\nGET /api/v1/taxpayers/1726051285001/emitted/clients/0998765432001/totals?regime=general\n```\n\n**Filters:**\n\nThis endpoint accepts the **same filters** as `/emitted/accumulated`:\n- `start_date`, `end_date`: Date range (defaults to current month)\n- `category_id[]`: Specific category IDs (array)\n- `deductible_type`: Tax deductibility (deductible, non_deductible)\n- `regime`: Tax regime (general, rimpe_entrepreneur, rimpe_popular_business)\n- `origin`: Document origin (datil, physical-upload, tws, xml-import)\n\n**Note:** Status filter is not available for this endpoint. All calculations are performed on AUTHORIZED documents only.\n\n**Plus:** Automatically filters by `contact_tax_number` (client's RUC/CI) from URL parameter"
      parameters:
        -
          in: query
          name: start_date
          description: 'Start date for filtering (YYYY-MM-DD). Defaults to first day of current month.'
          example: null
          required: false
          schema:
            type: string
            description: 'Start date for filtering (YYYY-MM-DD). Defaults to first day of current month.'
            example: null
        -
          in: query
          name: end_date
          description: 'End date for filtering (YYYY-MM-DD). Defaults to last day of current month.'
          example: null
          required: false
          schema:
            type: string
            description: 'End date for filtering (YYYY-MM-DD). Defaults to last day of current month.'
            example: null
        -
          in: query
          name: 'category_id[]'
          description: 'Filter by category ID(s). Can pass multiple values. To obtain available category IDs, use GET /api/v1/taxpayers/{taxNumber}/categories?type=sales.'
          example: null
          required: false
          schema:
            type: integer
            description: 'Filter by category ID(s). Can pass multiple values. To obtain available category IDs, use GET /api/v1/taxpayers/{taxNumber}/categories?type=sales.'
            example: null
        -
          in: query
          name: deductible_type
          description: 'Filter by tax deductibility. Must be one of: deductible, non_deductible.'
          example: null
          required: false
          schema:
            type: string
            description: 'Filter by tax deductibility. Must be one of: deductible, non_deductible.'
            example: null
        -
          in: query
          name: regime
          description: 'Filter by tax regime. Must be one of: general, rimpe_entrepreneur, rimpe_popular_business.'
          example: null
          required: false
          schema:
            type: string
            description: 'Filter by tax regime. Must be one of: general, rimpe_entrepreneur, rimpe_popular_business.'
            example: null
        -
          in: query
          name: origin
          description: 'Filter by document origin/source system. Must be one of: datil, physical-upload, tws, xml-import.'
          example: null
          required: false
          schema:
            type: string
            description: 'Filter by document origin/source system. Must be one of: datil, physical-upload, tws, xml-import.'
            example: null
        -
          in: header
          name: x-api-key
          description: ''
          example: YOUR_API_KEY_HERE
          schema:
            type: string
        -
          in: header
          name: x-organization-id
          description: ''
          example: '{YOUR_ORGANIZATION_ID}'
          schema:
            type: string
      responses:
        200:
          description: ''
          content:
            application/json:
              schema:
                oneOf:
                  -
                    description: 'Success - Client totals'
                    type: object
                    example:
                      status: success
                      message: 'Client totals retrieved successfully'
                      data:
                        totals:
                          subtotal_vat_fifteen_sum: 5420.8
                          vat_fifteen_sum: 813.12
                          subtotal_vat_twelve_sum: 1200.0
                          vat_twelve_sum: 144.0
                          subtotal_vat_zero_sum: 500.0
                          sub_total_sum: 7120.8
                          total_sum: 8077.92
                          subtotal_header: 7120.8
                          taxes_header: 957.12
                          total_header: 8077.92
                          document_count: 25
                          categorized_document_count: 25
                          uncategorized_document_count: 0
                          voided_document_count: 1
                        totals_explanation:
                          total_sum: "Direct sum of 'total' field from documents (SRI-authorized values). Use for official reports."
                          total_header: 'Calculated from subtotals + recalculated VAT. May differ slightly from total_sum due to rounding.'
                      meta:
                        filters_applied:
                          start_date: '2024-01-01'
                          end_date: '2024-12-31'
                          client:
                            contact_tax_number: '0998765432001'
                    properties:
                      status:
                        type: string
                        example: success
                      message:
                        type: string
                        example: 'Client totals retrieved successfully'
                      data:
                        type: object
                        properties:
                          totals:
                            type: object
                            properties:
                              subtotal_vat_fifteen_sum:
                                type: number
                                example: 5420.8
                              vat_fifteen_sum:
                                type: number
                                example: 813.12
                              subtotal_vat_twelve_sum:
                                type: number
                                example: 1200.0
                              vat_twelve_sum:
                                type: number
                                example: 144.0
                              subtotal_vat_zero_sum:
                                type: number
                                example: 500.0
                              sub_total_sum:
                                type: number
                                example: 7120.8
                              total_sum:
                                type: number
                                example: 8077.92
                              subtotal_header:
                                type: number
                                example: 7120.8
                              taxes_header:
                                type: number
                                example: 957.12
                              total_header:
                                type: number
                                example: 8077.92
                              document_count:
                                type: integer
                                example: 25
                              categorized_document_count:
                                type: integer
                                example: 25
                              uncategorized_document_count:
                                type: integer
                                example: 0
                              voided_document_count:
                                type: integer
                                example: 1
                          totals_explanation:
                            type: object
                            properties:
                              total_sum:
                                type: string
                                example: "Direct sum of 'total' field from documents (SRI-authorized values). Use for official reports."
                              total_header:
                                type: string
                                example: 'Calculated from subtotals + recalculated VAT. May differ slightly from total_sum due to rounding.'
                      meta:
                        type: object
                        properties:
                          filters_applied:
                            type: object
                            properties:
                              start_date:
                                type: string
                                example: '2024-01-01'
                              end_date:
                                type: string
                                example: '2024-12-31'
                              client:
                                type: object
                                properties:
                                  contact_tax_number:
                                    type: string
                                    example: '0998765432001'
                  -
                    description: 'Success - No documents for client'
                    type: object
                    example:
                      status: success
                      message: 'Client totals retrieved successfully'
                      data:
                        totals:
                          subtotal_header: 0.0
                          taxes_header: 0.0
                          total_header: 0.0
                          total_sum: 0.0
                          document_count: 0
                          categorized_document_count: 0
                          uncategorized_document_count: 0
                          voided_document_count: 0
                        totals_explanation:
                          total_sum: "Direct sum of 'total' field from documents (SRI-authorized values). Use for official reports."
                          total_header: 'Calculated from subtotals + recalculated VAT. May differ slightly from total_sum due to rounding.'
                      meta:
                        filters_applied:
                          start_date: '2024-12-01'
                          end_date: '2024-12-31'
                          client:
                            contact_tax_number: '0998765432001'
                    properties:
                      status:
                        type: string
                        example: success
                      message:
                        type: string
                        example: 'Client totals retrieved successfully'
                      data:
                        type: object
                        properties:
                          totals:
                            type: object
                            properties:
                              subtotal_header:
                                type: number
                                example: 0.0
                              taxes_header:
                                type: number
                                example: 0.0
                              total_header:
                                type: number
                                example: 0.0
                              total_sum:
                                type: number
                                example: 0.0
                              document_count:
                                type: integer
                                example: 0
                              categorized_document_count:
                                type: integer
                                example: 0
                              uncategorized_document_count:
                                type: integer
                                example: 0
                              voided_document_count:
                                type: integer
                                example: 0
                          totals_explanation:
                            type: object
                            properties:
                              total_sum:
                                type: string
                                example: "Direct sum of 'total' field from documents (SRI-authorized values). Use for official reports."
                              total_header:
                                type: string
                                example: 'Calculated from subtotals + recalculated VAT. May differ slightly from total_sum due to rounding.'
                      meta:
                        type: object
                        properties:
                          filters_applied:
                            type: object
                            properties:
                              start_date:
                                type: string
                                example: '2024-12-01'
                              end_date:
                                type: string
                                example: '2024-12-31'
                              client:
                                type: object
                                properties:
                                  contact_tax_number:
                                    type: string
                                    example: '0998765432001'
        401:
          description: 'Unauthorized - Invalid API Key'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Invalid API key'
                  code: INVALID_API_KEY
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Invalid API key'
                  code:
                    type: string
                    example: INVALID_API_KEY
        403:
          description: 'Forbidden - Taxpayer not accessible'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'You do not have access to this taxpayer'
                  code: TAXPAYER_ACCESS_DENIED
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'You do not have access to this taxpayer'
                  code:
                    type: string
                    example: TAXPAYER_ACCESS_DENIED
        404:
          description: 'Not Found - Taxpayer does not exist'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Taxpayer not found'
                  code: TAXPAYER_NOT_FOUND
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Taxpayer not found'
                  code:
                    type: string
                    example: TAXPAYER_NOT_FOUND
        422:
          description: 'Validation Error'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Validation failed'
                  code: VALIDATION_ERROR
                  errors:
                    start_date:
                      - 'The start date field must be a valid date in YYYY-MM-DD format.'
                    regime:
                      - 'Invalid regime. Must be one of: general, rimpe_entrepreneur, rimpe_popular_business.'
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Validation failed'
                  code:
                    type: string
                    example: VALIDATION_ERROR
                  errors:
                    type: object
                    properties:
                      start_date:
                        type: array
                        example:
                          - 'The start date field must be a valid date in YYYY-MM-DD format.'
                        items:
                          type: string
                      regime:
                        type: array
                        example:
                          - 'Invalid regime. Must be one of: general, rimpe_entrepreneur, rimpe_popular_business.'
                        items:
                          type: string
        500:
          description: 'Server Error'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'An error occurred while retrieving client totals'
                  code: SERVER_ERROR
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'An error occurred while retrieving client totals'
                  code:
                    type: string
                    example: SERVER_ERROR
      tags:
        - 'Emitted Documents'
    parameters:
      -
        in: path
        name: taxNumber
        description: "The taxpayer's RUC number (13 digits)."
        example: '1726051285001'
        required: true
        schema:
          type: string
      -
        in: path
        name: contactTaxNumber
        description: "The client's tax number (RUC/CI)."
        example: '0998765432001'
        required: true
        schema:
          type: string
  '/api/v1/taxpayers/{taxNumber}/emitted/{documentUlid}/status':
    get:
      summary: 'Get status of a specific emitted document'
      operationId: getStatusOfASpecificEmittedDocument
      description: "Retrieves the current status of a specific emitted document (invoice, credit note, withholding, or settlement)\nby its unique ULID identifier. The system will automatically search across all emitted document types\nand return the status along with the document type.\n\n**Performance:** The search uses database indexes and stops as soon as the document is found,\nensuring optimal query performance even with large datasets.\n\n**How to obtain the document ULID:**\n\nYou can get the document ULID from these endpoints:\n- `GET /api/v1/taxpayers/{taxNumber}/emitted` - Returns sales invoices with their ULIDs\n- Any other endpoint that lists emitted documents\n\nThe ULID field is typically returned as `ulid` in the document listing responses.\n\n**Document Types:**\n- `invoice` - Sales invoice (from invoices table)\n- `credit_note` - Sales credit note (from sale_credit_notes table)\n- `withholding` - Withholding issued (from sale_withholdings table)\n- `settlement` - Purchase settlement (from sale_settlements table / liquidación de compra)\n\n**Status Values:**\n\nFor invoices, credit notes, withholdings and settlements:\n- `AUTORIZADO` - Authorized document\n- `NO AUTORIZADO` - Not authorized document\n- `ANULADO` - Voided/Cancelled document\n- Other status values depending on the electronic document system"
      parameters:
        -
          in: header
          name: x-api-key
          description: ''
          example: YOUR_API_KEY_HERE
          schema:
            type: string
        -
          in: header
          name: x-organization-id
          description: ''
          example: '{YOUR_ORGANIZATION_ID}'
          schema:
            type: string
      responses:
        200:
          description: ''
          content:
            application/json:
              schema:
                oneOf:
                  -
                    description: 'Success - Invoice'
                    type: object
                    example:
                      status: success
                      message: 'Document status retrieved successfully'
                      data:
                        document_id: 01HQXZ8P9G2K4MNBVCXWERTYU1
                        document_type: invoice
                        status: AUTORIZADO
                        metadata:
                          taxpayer:
                            id: 123
                            ulid: 01HQXZ8P9G2K4MNBVCXWERTYU2
                            tax_number: '1726051285001'
                          team:
                            id: 456
                            ulid: 01HQXZ8P9G2K4MNBVCXWERTYU3
                            name: 'Mi Empresa S.A.'
                    properties:
                      status:
                        type: string
                        example: success
                      message:
                        type: string
                        example: 'Document status retrieved successfully'
                      data:
                        type: object
                        properties:
                          document_id:
                            type: string
                            example: 01HQXZ8P9G2K4MNBVCXWERTYU1
                          document_type:
                            type: string
                            example: invoice
                          status:
                            type: string
                            example: AUTORIZADO
                          metadata:
                            type: object
                            properties:
                              taxpayer:
                                type: object
                                properties:
                                  id:
                                    type: integer
                                    example: 123
                                  ulid:
                                    type: string
                                    example: 01HQXZ8P9G2K4MNBVCXWERTYU2
                                  tax_number:
                                    type: string
                                    example: '1726051285001'
                              team:
                                type: object
                                properties:
                                  id:
                                    type: integer
                                    example: 456
                                  ulid:
                                    type: string
                                    example: 01HQXZ8P9G2K4MNBVCXWERTYU3
                                  name:
                                    type: string
                                    example: 'Mi Empresa S.A.'
                  -
                    description: 'Success - Credit Note'
                    type: object
                    example:
                      status: success
                      message: 'Document status retrieved successfully'
                      data:
                        document_id: 01HQXZ8P9G2K4MNBVCXWERTYU1
                        document_type: credit_note
                        status: AUTORIZADO
                        metadata:
                          taxpayer:
                            id: 123
                            ulid: 01HQXZ8P9G2K4MNBVCXWERTYU2
                            tax_number: '1726051285001'
                          team:
                            id: 456
                            ulid: 01HQXZ8P9G2K4MNBVCXWERTYU3
                            name: 'Mi Empresa S.A.'
                    properties:
                      status:
                        type: string
                        example: success
                      message:
                        type: string
                        example: 'Document status retrieved successfully'
                      data:
                        type: object
                        properties:
                          document_id:
                            type: string
                            example: 01HQXZ8P9G2K4MNBVCXWERTYU1
                          document_type:
                            type: string
                            example: credit_note
                          status:
                            type: string
                            example: AUTORIZADO
                          metadata:
                            type: object
                            properties:
                              taxpayer:
                                type: object
                                properties:
                                  id:
                                    type: integer
                                    example: 123
                                  ulid:
                                    type: string
                                    example: 01HQXZ8P9G2K4MNBVCXWERTYU2
                                  tax_number:
                                    type: string
                                    example: '1726051285001'
                              team:
                                type: object
                                properties:
                                  id:
                                    type: integer
                                    example: 456
                                  ulid:
                                    type: string
                                    example: 01HQXZ8P9G2K4MNBVCXWERTYU3
                                  name:
                                    type: string
                                    example: 'Mi Empresa S.A.'
                  -
                    description: 'Success - Withholding'
                    type: object
                    example:
                      status: success
                      message: 'Document status retrieved successfully'
                      data:
                        document_id: 01HQXZ8P9G2K4MNBVCXWERTYU1
                        document_type: withholding
                        status: AUTORIZADO
                        metadata:
                          taxpayer:
                            id: 123
                            ulid: 01HQXZ8P9G2K4MNBVCXWERTYU2
                            tax_number: '1726051285001'
                          team:
                            id: 456
                            ulid: 01HQXZ8P9G2K4MNBVCXWERTYU3
                            name: 'Mi Empresa S.A.'
                    properties:
                      status:
                        type: string
                        example: success
                      message:
                        type: string
                        example: 'Document status retrieved successfully'
                      data:
                        type: object
                        properties:
                          document_id:
                            type: string
                            example: 01HQXZ8P9G2K4MNBVCXWERTYU1
                          document_type:
                            type: string
                            example: withholding
                          status:
                            type: string
                            example: AUTORIZADO
                          metadata:
                            type: object
                            properties:
                              taxpayer:
                                type: object
                                properties:
                                  id:
                                    type: integer
                                    example: 123
                                  ulid:
                                    type: string
                                    example: 01HQXZ8P9G2K4MNBVCXWERTYU2
                                  tax_number:
                                    type: string
                                    example: '1726051285001'
                              team:
                                type: object
                                properties:
                                  id:
                                    type: integer
                                    example: 456
                                  ulid:
                                    type: string
                                    example: 01HQXZ8P9G2K4MNBVCXWERTYU3
                                  name:
                                    type: string
                                    example: 'Mi Empresa S.A.'
                  -
                    description: 'Success - Settlement'
                    type: object
                    example:
                      status: success
                      message: 'Document status retrieved successfully'
                      data:
                        document_id: 01HQXZ8P9G2K4MNBVCXWERTYU1
                        document_type: settlement
                        status: AUTORIZADO
                        metadata:
                          taxpayer:
                            id: 123
                            ulid: 01HQXZ8P9G2K4MNBVCXWERTYU2
                            tax_number: '1726051285001'
                          team:
                            id: 456
                            ulid: 01HQXZ8P9G2K4MNBVCXWERTYU3
                            name: 'Mi Empresa S.A.'
                    properties:
                      status:
                        type: string
                        example: success
                      message:
                        type: string
                        example: 'Document status retrieved successfully'
                      data:
                        type: object
                        properties:
                          document_id:
                            type: string
                            example: 01HQXZ8P9G2K4MNBVCXWERTYU1
                          document_type:
                            type: string
                            example: settlement
                          status:
                            type: string
                            example: AUTORIZADO
                          metadata:
                            type: object
                            properties:
                              taxpayer:
                                type: object
                                properties:
                                  id:
                                    type: integer
                                    example: 123
                                  ulid:
                                    type: string
                                    example: 01HQXZ8P9G2K4MNBVCXWERTYU2
                                  tax_number:
                                    type: string
                                    example: '1726051285001'
                              team:
                                type: object
                                properties:
                                  id:
                                    type: integer
                                    example: 456
                                  ulid:
                                    type: string
                                    example: 01HQXZ8P9G2K4MNBVCXWERTYU3
                                  name:
                                    type: string
                                    example: 'Mi Empresa S.A.'
        401:
          description: 'Unauthorized - Invalid API Key'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Invalid API key'
                  code: INVALID_API_KEY
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Invalid API key'
                  code:
                    type: string
                    example: INVALID_API_KEY
        403:
          description: 'Forbidden - Taxpayer not accessible'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'You do not have access to this taxpayer'
                  code: TAXPAYER_ACCESS_DENIED
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'You do not have access to this taxpayer'
                  code:
                    type: string
                    example: TAXPAYER_ACCESS_DENIED
        404:
          description: ''
          content:
            application/json:
              schema:
                oneOf:
                  -
                    description: 'Document Not Found'
                    type: object
                    example:
                      status: error
                      message: 'Document not found or does not belong to this taxpayer'
                    properties:
                      status:
                        type: string
                        example: error
                      message:
                        type: string
                        example: 'Document not found or does not belong to this taxpayer'
                  -
                    description: 'Taxpayer Not Found'
                    type: object
                    example:
                      status: error
                      message: 'Taxpayer not found'
                      code: TAXPAYER_NOT_FOUND
                    properties:
                      status:
                        type: string
                        example: error
                      message:
                        type: string
                        example: 'Taxpayer not found'
                      code:
                        type: string
                        example: TAXPAYER_NOT_FOUND
        500:
          description: 'Server Error'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'An error occurred while retrieving document status'
                  code: SERVER_ERROR
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'An error occurred while retrieving document status'
                  code:
                    type: string
                    example: SERVER_ERROR
      tags:
        - 'Emitted Documents'
    parameters:
      -
        in: path
        name: taxNumber
        description: "The taxpayer's RUC number (13 digits)."
        example: '1726051285001'
        required: true
        schema:
          type: string
      -
        in: path
        name: documentUlid
        description: 'The unique ULID identifier of the document. Can be from invoices, credit notes, withholdings, or settlements.'
        example: 01HQXZ8P9G2K4MNBVCXWERTYU1
        required: true
        schema:
          type: string
  '/api/v1/taxpayers/{taxNumber}/iva-reports':
    get:
      summary: 'List IVA reports for a taxpayer'
      operationId: listIVAReportsForATaxpayer
      description: "Retrieves a paginated list of IVA reports for a specific taxpayer.\n\n**IMPORTANT:** This is a GET request. All parameters must be sent as query string parameters in the URL.\nDo NOT send a request body.\n\n**Example URL:**\n```\nGET /api/v1/taxpayers/1726051285001/iva-reports?page=1&per_page=20&status=saved&sort=-period\n```\n\n**Available filters (all optional, sent as query params in URL):**\n- `page`: Page number for pagination (default: 1)\n- `per_page`: Items per page, 1-100 (default: 20)\n- `status`: Filter by report status\n- `periodicity`: Filter by periodicity (monthly, biannual)\n- `year`: Filter by year\n- `sort`: Sort field. Prefix with `-` for descending (e.g., `-period`, `status`)\n\n**Available statuses:**\n- `draft`: Initial state, being edited\n- `edited`: Has manual edits\n- `saved`: Ready for review\n- `sent`: Sent to taxpayer for approval\n- `approved`: Approved and ready for SRI submission\n- `rejected`: Rejected, needs corrections\n- `sri_sended`: Sent to SRI (in progress)\n- `sri_sended_completed`: SRI processing completed\n- `declared`: Marked as declared\n- `error`: Error during SRI submission"
      parameters:
        -
          in: query
          name: page
          description: 'Page number for pagination.'
          example: null
          required: false
          schema:
            type: integer
            description: 'Page number for pagination.'
            example: null
        -
          in: query
          name: per_page
          description: 'Items per page (1-100).'
          example: null
          required: false
          schema:
            type: integer
            description: 'Items per page (1-100).'
            example: null
        -
          in: query
          name: status
          description: 'Filter by report status.'
          example: null
          required: false
          schema:
            type: string
            description: 'Filter by report status.'
            example: null
        -
          in: query
          name: periodicity
          description: 'Filter by periodicity (monthly, biannual).'
          example: null
          required: false
          schema:
            type: string
            description: 'Filter by periodicity (monthly, biannual).'
            example: null
        -
          in: query
          name: year
          description: 'Filter by year.'
          example: null
          required: false
          schema:
            type: integer
            description: 'Filter by year.'
            example: null
        -
          in: query
          name: sort
          description: 'Sort field. Prefix with - for descending.'
          example: null
          required: false
          schema:
            type: string
            description: 'Sort field. Prefix with - for descending.'
            example: null
        -
          in: header
          name: x-api-key
          description: ''
          example: YOUR_API_KEY_HERE
          schema:
            type: string
        -
          in: header
          name: x-organization-id
          description: ''
          example: '{YOUR_ORGANIZATION_ID}'
          schema:
            type: string
      responses:
        200:
          description: Success
          content:
            application/json:
              schema:
                type: object
                example:
                  status: success
                  message: 'Reports retrieved successfully'
                  data:
                    reports:
                      -
                        id: 01HZXXX123ABC456
                        tax_payer_id: 123
                        period: '2024-03-15'
                        periodicity: monthly
                        status: saved
                        status_label: Guardado
                        total_sales_raw_value: 15000.0
                        total_taxes_to_pay_iva: 1200.5
                        created_at: '2024-03-01T09:00:00.000000Z'
                        updated_at: '2024-03-05T14:30:00.000000Z'
                      -
                        id: 01HZXXX123ABC789
                        tax_payer_id: 123
                        period: '2024-02-15'
                        periodicity: monthly
                        status: declared
                        status_label: Declarado
                        total_sales_raw_value: 12500.0
                        total_taxes_to_pay_iva: 980.0
                        created_at: '2024-02-01T10:15:00.000000Z'
                        updated_at: '2024-02-20T16:45:00.000000Z'
                  meta:
                    pagination:
                      current_page: 1
                      per_page: 20
                      total: 24
                      total_pages: 2
                      from: 1
                      to: 20
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: 'Reports retrieved successfully'
                  data:
                    type: object
                    properties:
                      reports:
                        type: array
                        example:
                          -
                            id: 01HZXXX123ABC456
                            tax_payer_id: 123
                            period: '2024-03-15'
                            periodicity: monthly
                            status: saved
                            status_label: Guardado
                            total_sales_raw_value: 15000
                            total_taxes_to_pay_iva: 1200.5
                            created_at: '2024-03-01T09:00:00.000000Z'
                            updated_at: '2024-03-05T14:30:00.000000Z'
                          -
                            id: 01HZXXX123ABC789
                            tax_payer_id: 123
                            period: '2024-02-15'
                            periodicity: monthly
                            status: declared
                            status_label: Declarado
                            total_sales_raw_value: 12500
                            total_taxes_to_pay_iva: 980
                            created_at: '2024-02-01T10:15:00.000000Z'
                            updated_at: '2024-02-20T16:45:00.000000Z'
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                              example: 01HZXXX123ABC456
                            tax_payer_id:
                              type: integer
                              example: 123
                            period:
                              type: string
                              example: '2024-03-15'
                            periodicity:
                              type: string
                              example: monthly
                            status:
                              type: string
                              example: saved
                            status_label:
                              type: string
                              example: Guardado
                            total_sales_raw_value:
                              type: number
                              example: 15000.0
                            total_taxes_to_pay_iva:
                              type: number
                              example: 1200.5
                            created_at:
                              type: string
                              example: '2024-03-01T09:00:00.000000Z'
                            updated_at:
                              type: string
                              example: '2024-03-05T14:30:00.000000Z'
                  meta:
                    type: object
                    properties:
                      pagination:
                        type: object
                        properties:
                          current_page:
                            type: integer
                            example: 1
                          per_page:
                            type: integer
                            example: 20
                          total:
                            type: integer
                            example: 24
                          total_pages:
                            type: integer
                            example: 2
                          from:
                            type: integer
                            example: 1
                          to:
                            type: integer
                            example: 20
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Invalid API key or organization ID'
                  code: UNAUTHORIZED
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Invalid API key or organization ID'
                  code:
                    type: string
                    example: UNAUTHORIZED
        404:
          description: 'Taxpayer not found'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Taxpayer not found'
                  code: NOT_FOUND
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Taxpayer not found'
                  code:
                    type: string
                    example: NOT_FOUND
        422:
          description: 'Invalid filter'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Validation failed'
                  code: VALIDATION_ERROR
                  errors:
                    status:
                      - 'Invalid status value'
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Validation failed'
                  code:
                    type: string
                    example: VALIDATION_ERROR
                  errors:
                    type: object
                    properties:
                      status:
                        type: array
                        example:
                          - 'Invalid status value'
                        items:
                          type: string
      tags:
        - 'IVA Reports'
    post:
      summary: 'Create a new IVA report'
      operationId: createANewIVAReport
      description: "Creates a new IVA report for the specified period if it doesn't already exist.\nThe report is created in DRAFT status with all values calculated automatically from:\n- Sales invoices and credit notes\n- Purchase bills and credit notes\n- Withholding documents\n\n**Important notes:**\n- If a report already exists for the period, it returns the existing one (idempotent)\n- The period is converted to a full date based on taxpayer's periodicity\n- Monthly taxpayers: YYYY-MM → YYYY-MM-15\n- Biannual taxpayers: Only YYYY-06 or YYYY-12 allowed\n- This process may take 3-5 seconds as it calculates from all documents\n\n**Workflow:**\n1. Validates period format\n2. Checks if report already exists\n3. Queries all documents for the period\n4. Calculates sales, purchases, and tax totals\n5. Creates report in DRAFT status\n6. Records initial status in history"
      parameters:
        -
          in: header
          name: x-api-key
          description: ''
          example: YOUR_API_KEY_HERE
          schema:
            type: string
        -
          in: header
          name: x-organization-id
          description: ''
          example: '{YOUR_ORGANIZATION_ID}'
          schema:
            type: string
      responses:
        200:
          description: 'Report already exists'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: success
                  message: 'Report already exists for this period'
                  data:
                    report:
                      id: 01HZXXX123ABC456
                      tax_payer_id: 123
                      period: '2024-03-15'
                      periodicity: monthly
                      status: saved
                      status_label: Guardado
                      total_taxes_to_pay_iva: 1200.0
                      created_at: '2024-03-01T09:00:00.000000Z'
                      updated_at: '2024-03-05T14:30:00.000000Z'
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: 'Report already exists for this period'
                  data:
                    type: object
                    properties:
                      report:
                        type: object
                        properties:
                          id:
                            type: string
                            example: 01HZXXX123ABC456
                          tax_payer_id:
                            type: integer
                            example: 123
                          period:
                            type: string
                            example: '2024-03-15'
                          periodicity:
                            type: string
                            example: monthly
                          status:
                            type: string
                            example: saved
                          status_label:
                            type: string
                            example: Guardado
                          total_taxes_to_pay_iva:
                            type: number
                            example: 1200.0
                          created_at:
                            type: string
                            example: '2024-03-01T09:00:00.000000Z'
                          updated_at:
                            type: string
                            example: '2024-03-05T14:30:00.000000Z'
        201:
          description: 'Report created successfully'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: success
                  message: 'Report created successfully'
                  data:
                    report:
                      id: 01HZXXX123ABC456
                      tax_payer_id: 123
                      period: '2024-03-15'
                      periodicity: monthly
                      status: draft
                      status_label: Borrador
                      local_sales_different_0_rate_raw_value: 10000.0
                      local_sales_different_0_rate_iva: 1200.0
                      total_sales_raw_value: 15000.0
                      total_sales_iva: 1800.0
                      purchases_different_0_rate_with_right_iva: 600.0
                      total_taxes_to_pay_iva: 1200.0
                      total_invoices_issued: 45
                      created_at: '2024-03-01T09:00:00.000000Z'
                      updated_at: '2024-03-01T09:00:00.000000Z'
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: 'Report created successfully'
                  data:
                    type: object
                    properties:
                      report:
                        type: object
                        properties:
                          id:
                            type: string
                            example: 01HZXXX123ABC456
                          tax_payer_id:
                            type: integer
                            example: 123
                          period:
                            type: string
                            example: '2024-03-15'
                          periodicity:
                            type: string
                            example: monthly
                          status:
                            type: string
                            example: draft
                          status_label:
                            type: string
                            example: Borrador
                          local_sales_different_0_rate_raw_value:
                            type: number
                            example: 10000.0
                          local_sales_different_0_rate_iva:
                            type: number
                            example: 1200.0
                          total_sales_raw_value:
                            type: number
                            example: 15000.0
                          total_sales_iva:
                            type: number
                            example: 1800.0
                          purchases_different_0_rate_with_right_iva:
                            type: number
                            example: 600.0
                          total_taxes_to_pay_iva:
                            type: number
                            example: 1200.0
                          total_invoices_issued:
                            type: integer
                            example: 45
                          created_at:
                            type: string
                            example: '2024-03-01T09:00:00.000000Z'
                          updated_at:
                            type: string
                            example: '2024-03-01T09:00:00.000000Z'
        404:
          description: 'Taxpayer not found'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Taxpayer not found'
                  code: NOT_FOUND
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Taxpayer not found'
                  code:
                    type: string
                    example: NOT_FOUND
        422:
          description: ''
          content:
            application/json:
              schema:
                oneOf:
                  -
                    description: 'Invalid period format'
                    type: object
                    example:
                      status: error
                      message: 'Validation failed'
                      code: VALIDATION_ERROR
                      errors:
                        period:
                          - 'Period must be in YYYY-MM format (e.g., 2024-03)'
                    properties:
                      status:
                        type: string
                        example: error
                      message:
                        type: string
                        example: 'Validation failed'
                      code:
                        type: string
                        example: VALIDATION_ERROR
                      errors:
                        type: object
                        properties:
                          period:
                            type: array
                            example:
                              - 'Period must be in YYYY-MM format (e.g., 2024-03)'
                            items:
                              type: string
                  -
                    description: 'Invalid period for biannual'
                    type: object
                    example:
                      status: error
                      message: 'Validation failed'
                      code: VALIDATION_ERROR
                      errors:
                        period:
                          - 'For biannual periodicity, period must be YYYY-06 or YYYY-12'
                    properties:
                      status:
                        type: string
                        example: error
                      message:
                        type: string
                        example: 'Validation failed'
                      code:
                        type: string
                        example: VALIDATION_ERROR
                      errors:
                        type: object
                        properties:
                          period:
                            type: array
                            example:
                              - 'For biannual periodicity, period must be YYYY-06 or YYYY-12'
                            items:
                              type: string
      tags:
        - 'IVA Reports'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                period:
                  type: string
                  description: 'Period in YYYY-MM format.'
                  example: 2024-03
              required:
                - period
    parameters:
      -
        in: path
        name: taxNumber
        description: "The taxpayer's RUC number (13 digits)."
        example: '1726051285001'
        required: true
        schema:
          type: string
  '/api/v1/taxpayers/{taxNumber}/iva-reports/{period}':
    get:
      summary: 'Get a specific IVA report'
      operationId: getASpecificIVAReport
      description: "Retrieves detailed information for a specific IVA report identified by period.\nReturns all calculated fields including sales, purchases, tax credits, and final tax amount.\n\n**IMPORTANT:** This is a GET request. Do NOT send a request body.\n\n**Example URL:**\n```\nGET /api/v1/taxpayers/1726051285001/iva-reports/2024-03\n```\n\n**Period Format:**\nThe period parameter uses YYYY-MM format and is automatically converted to the full date\nbased on the taxpayer's periodicity:\n- **Monthly**: `2024-03` becomes `2024-03-15`\n- **Biannual**: `2024-06` becomes `2024-06-15` (first semester) or `2024-12` becomes `2024-12-15` (second semester)"
      parameters:
        -
          in: header
          name: x-api-key
          description: ''
          example: YOUR_API_KEY_HERE
          schema:
            type: string
        -
          in: header
          name: x-organization-id
          description: ''
          example: '{YOUR_ORGANIZATION_ID}'
          schema:
            type: string
      responses:
        200:
          description: Success
          content:
            application/json:
              schema:
                type: object
                example:
                  status: success
                  message: 'Report retrieved successfully'
                  data:
                    report:
                      id: 01HZXXX123ABC456
                      tax_payer_id: 123
                      period: '2024-03-15'
                      periodicity: monthly
                      status: saved
                      status_label: Guardado
                      public_link: 'https://app.taxo.ec/public/reports/abc123'
                      comments: null
                      report_comments: 'Reporte revisado'
                      vat_declaration_pdf: null
                      vat_payment_receipt_pdf: null
                      local_sales_different_0_rate_raw_value: 10000.0
                      local_sales_different_0_rate_iva: 1200.0
                      total_sales_raw_value: 15000.0
                      total_sales_iva: 1800.0
                      purchases_different_0_rate_with_right_raw_value: 5000.0
                      purchases_different_0_rate_with_right_iva: 600.0
                      total_acquisitions_and_payments_raw_value: 6500.0
                      total_acquisitions_and_payments_iva: 780.0
                      purchases_tax_credit_applicable_period_iva: 780.0
                      tax_caused_iva: 1800.0
                      total_tax_credit_period_iva: 780.0
                      subtotal_to_pay_iva: 1020.0
                      total_taxes_to_pay_iva: 1020.0
                      total_invoices_issued: 45
                      total_invoices_canceled: 2
                      documents_generated_period: 128
                      created_at: '2024-03-01T09:00:00.000000Z'
                      updated_at: '2024-03-05T14:30:00.000000Z'
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: 'Report retrieved successfully'
                  data:
                    type: object
                    properties:
                      report:
                        type: object
                        properties:
                          id:
                            type: string
                            example: 01HZXXX123ABC456
                          tax_payer_id:
                            type: integer
                            example: 123
                          period:
                            type: string
                            example: '2024-03-15'
                          periodicity:
                            type: string
                            example: monthly
                          status:
                            type: string
                            example: saved
                          status_label:
                            type: string
                            example: Guardado
                          public_link:
                            type: string
                            example: 'https://app.taxo.ec/public/reports/abc123'
                          comments:
                            type: string
                            example: null
                          report_comments:
                            type: string
                            example: 'Reporte revisado'
                          vat_declaration_pdf:
                            type: string
                            example: null
                          vat_payment_receipt_pdf:
                            type: string
                            example: null
                          local_sales_different_0_rate_raw_value:
                            type: number
                            example: 10000.0
                          local_sales_different_0_rate_iva:
                            type: number
                            example: 1200.0
                          total_sales_raw_value:
                            type: number
                            example: 15000.0
                          total_sales_iva:
                            type: number
                            example: 1800.0
                          purchases_different_0_rate_with_right_raw_value:
                            type: number
                            example: 5000.0
                          purchases_different_0_rate_with_right_iva:
                            type: number
                            example: 600.0
                          total_acquisitions_and_payments_raw_value:
                            type: number
                            example: 6500.0
                          total_acquisitions_and_payments_iva:
                            type: number
                            example: 780.0
                          purchases_tax_credit_applicable_period_iva:
                            type: number
                            example: 780.0
                          tax_caused_iva:
                            type: number
                            example: 1800.0
                          total_tax_credit_period_iva:
                            type: number
                            example: 780.0
                          subtotal_to_pay_iva:
                            type: number
                            example: 1020.0
                          total_taxes_to_pay_iva:
                            type: number
                            example: 1020.0
                          total_invoices_issued:
                            type: integer
                            example: 45
                          total_invoices_canceled:
                            type: integer
                            example: 2
                          documents_generated_period:
                            type: integer
                            example: 128
                          created_at:
                            type: string
                            example: '2024-03-01T09:00:00.000000Z'
                          updated_at:
                            type: string
                            example: '2024-03-05T14:30:00.000000Z'
        404:
          description: ''
          content:
            application/json:
              schema:
                oneOf:
                  -
                    description: 'Report not found'
                    type: object
                    example:
                      status: error
                      message: 'Report not found for period 2024-03'
                      code: NOT_FOUND
                    properties:
                      status:
                        type: string
                        example: error
                      message:
                        type: string
                        example: 'Report not found for period 2024-03'
                      code:
                        type: string
                        example: NOT_FOUND
                  -
                    description: 'Taxpayer not found'
                    type: object
                    example:
                      status: error
                      message: 'Taxpayer not found'
                      code: NOT_FOUND
                    properties:
                      status:
                        type: string
                        example: error
                      message:
                        type: string
                        example: 'Taxpayer not found'
                      code:
                        type: string
                        example: NOT_FOUND
        422:
          description: 'Invalid period format'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Validation failed'
                  code: VALIDATION_ERROR
                  errors:
                    period:
                      - 'Invalid period format. Expected YYYY-MM (e.g., 2024-03)'
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Validation failed'
                  code:
                    type: string
                    example: VALIDATION_ERROR
                  errors:
                    type: object
                    properties:
                      period:
                        type: array
                        example:
                          - 'Invalid period format. Expected YYYY-MM (e.g., 2024-03)'
                        items:
                          type: string
      tags:
        - 'IVA Reports'
    parameters:
      -
        in: path
        name: taxNumber
        description: "The taxpayer's RUC number (13 digits)."
        example: '1726051285001'
        required: true
        schema:
          type: string
      -
        in: path
        name: period
        description: 'Period in YYYY-MM format.'
        example: 2024-03
        required: true
        schema:
          type: string
  '/api/v1/taxpayers/{taxNumber}/iva-reports/recalculate':
    post:
      summary: 'Recalculate IVA report (Update Report)'
      operationId: recalculateIVAReportUpdateReport
      description: "Resets the report to DRAFT status and recalculates all values from current documents.\nThis is the API equivalent of the \"Actualizar reporte\" button in the UI.\n\n**Use cases:**\n- New invoices/bills were added after creating the report\n- Documents were corrected or updated\n- Need to refresh calculations with latest data\n- Reset report from any state back to draft\n\n**What this endpoint does:**\n1. Validates the report exists for the period\n2. Clears uploaded PDF files (vat_declaration_pdf, vat_payment_receipt_pdf)\n3. Transitions report status to DRAFT (allowed from any state)\n4. Queries all documents for the period again\n5. Recalculates all sales, purchases, and tax totals\n6. Records the status change in history\n\n**Warning:** This action will overwrite any manual edits made to the report."
      parameters:
        -
          in: header
          name: x-api-key
          description: ''
          example: YOUR_API_KEY_HERE
          schema:
            type: string
        -
          in: header
          name: x-organization-id
          description: ''
          example: '{YOUR_ORGANIZATION_ID}'
          schema:
            type: string
      responses:
        200:
          description: 'Successfully recalculated'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: success
                  message: 'Report recalculated successfully'
                  data:
                    report:
                      id: 01HZXXX123ABC456
                      tax_payer_id: 123
                      period: '2024-03-15'
                      periodicity: monthly
                      status: draft
                      status_label: Borrador
                      vat_declaration_pdf: null
                      vat_payment_receipt_pdf: null
                      total_sales_raw_value: 16500.0
                      total_sales_iva: 1980.0
                      total_taxes_to_pay_iva: 1350.75
                      total_invoices_issued: 52
                      updated_at: '2024-03-10T15:45:00.000000Z'
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: 'Report recalculated successfully'
                  data:
                    type: object
                    properties:
                      report:
                        type: object
                        properties:
                          id:
                            type: string
                            example: 01HZXXX123ABC456
                          tax_payer_id:
                            type: integer
                            example: 123
                          period:
                            type: string
                            example: '2024-03-15'
                          periodicity:
                            type: string
                            example: monthly
                          status:
                            type: string
                            example: draft
                          status_label:
                            type: string
                            example: Borrador
                          vat_declaration_pdf:
                            type: string
                            example: null
                          vat_payment_receipt_pdf:
                            type: string
                            example: null
                          total_sales_raw_value:
                            type: number
                            example: 16500.0
                          total_sales_iva:
                            type: number
                            example: 1980.0
                          total_taxes_to_pay_iva:
                            type: number
                            example: 1350.75
                          total_invoices_issued:
                            type: integer
                            example: 52
                          updated_at:
                            type: string
                            example: '2024-03-10T15:45:00.000000Z'
        400:
          description: 'Invalid transition (should not happen)'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Cannot transition from sri_sended to draft'
                  code: INVALID_TRANSITION
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Cannot transition from sri_sended to draft'
                  code:
                    type: string
                    example: INVALID_TRANSITION
        404:
          description: 'Report not found'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Report not found for period 2024-03'
                  code: NOT_FOUND
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Report not found for period 2024-03'
                  code:
                    type: string
                    example: NOT_FOUND
        422:
          description: 'Invalid period format'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Validation failed'
                  code: VALIDATION_ERROR
                  errors:
                    period:
                      - 'Period must be in YYYY-MM format (e.g., 2024-03)'
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Validation failed'
                  code:
                    type: string
                    example: VALIDATION_ERROR
                  errors:
                    type: object
                    properties:
                      period:
                        type: array
                        example:
                          - 'Period must be in YYYY-MM format (e.g., 2024-03)'
                        items:
                          type: string
      tags:
        - 'IVA Reports'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                period:
                  type: string
                  description: 'Period in YYYY-MM format.'
                  example: 2024-03
              required:
                - period
    parameters:
      -
        in: path
        name: taxNumber
        description: "The taxpayer's RUC number (13 digits)."
        example: '1726051285001'
        required: true
        schema:
          type: string
  '/api/v1/taxpayers/{taxNumber}/iva-reports/save':
    patch:
      summary: 'Save IVA report'
      operationId: saveIVAReport
      description: "Saves the report by changing its status from DRAFT/EDITED to SAVED.\nA saved report is locked from further edits and ready for approval workflow.\nOptionally adds comments to document any observations or notes.\n\n**When to use:**\n- After reviewing calculated values in draft\n- Before sending to taxpayer for approval\n- When report data is final and correct\n\n**Valid transitions:**\n- DRAFT → SAVED\n- EDITED → SAVED\n\n**After saving, you can:**\n- Send report via email for approval (`/send`)\n- Directly approve as accountant (`/approve`)\n- Reject if issues found (`/reject`)"
      parameters:
        -
          in: header
          name: x-api-key
          description: ''
          example: YOUR_API_KEY_HERE
          schema:
            type: string
        -
          in: header
          name: x-organization-id
          description: ''
          example: '{YOUR_ORGANIZATION_ID}'
          schema:
            type: string
      responses:
        200:
          description: 'Successfully saved'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: success
                  message: 'Report saved successfully'
                  data:
                    report:
                      id: 01HZXXX123ABC456
                      tax_payer_id: 123
                      period: '2024-03-15'
                      periodicity: monthly
                      status: saved
                      status_label: Guardado
                      report_comments: 'Reporte revisado, valores correctos'
                      total_sales_raw_value: 15000.0
                      total_taxes_to_pay_iva: 1200.0
                      updated_at: '2024-03-05T14:30:00.000000Z'
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: 'Report saved successfully'
                  data:
                    type: object
                    properties:
                      report:
                        type: object
                        properties:
                          id:
                            type: string
                            example: 01HZXXX123ABC456
                          tax_payer_id:
                            type: integer
                            example: 123
                          period:
                            type: string
                            example: '2024-03-15'
                          periodicity:
                            type: string
                            example: monthly
                          status:
                            type: string
                            example: saved
                          status_label:
                            type: string
                            example: Guardado
                          report_comments:
                            type: string
                            example: 'Reporte revisado, valores correctos'
                          total_sales_raw_value:
                            type: number
                            example: 15000.0
                          total_taxes_to_pay_iva:
                            type: number
                            example: 1200.0
                          updated_at:
                            type: string
                            example: '2024-03-05T14:30:00.000000Z'
        400:
          description: 'Invalid status'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Cannot transition from approved to saved'
                  code: INVALID_TRANSITION
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Cannot transition from approved to saved'
                  code:
                    type: string
                    example: INVALID_TRANSITION
        404:
          description: 'Report not found'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Report not found for period 2024-03'
                  code: NOT_FOUND
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Report not found for period 2024-03'
                  code:
                    type: string
                    example: NOT_FOUND
        422:
          description: 'Validation error'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Validation failed'
                  code: VALIDATION_ERROR
                  errors:
                    comments:
                      - 'Comments cannot exceed 500 characters'
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Validation failed'
                  code:
                    type: string
                    example: VALIDATION_ERROR
                  errors:
                    type: object
                    properties:
                      comments:
                        type: array
                        example:
                          - 'Comments cannot exceed 500 characters'
                        items:
                          type: string
      tags:
        - 'IVA Reports'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                period:
                  type: string
                  description: 'Period in YYYY-MM format.'
                  example: 2024-03
                comments:
                  type: string
                  description: 'Optional comments about the report (max 500 chars).'
                  example: 'Reporte revisado, valores correctos'
              required:
                - period
    parameters:
      -
        in: path
        name: taxNumber
        description: "The taxpayer's RUC number (13 digits)."
        example: '1726051285001'
        required: true
        schema:
          type: string
  '/api/v1/taxpayers/{taxNumber}/iva-reports/approve':
    patch:
      summary: 'Approve IVA report'
      operationId: approveIVAReport
      description: "Approves the report, changing its status to APPROVED.\nThis indicates the report has been reviewed and validated by an accountant\nand is ready for submission to the SRI (Tax Authority).\n\n**Approval means:**\n- All values have been verified\n- Report is accurate and complete\n- Ready for tax authority submission\n- No further changes from taxpayer needed\n\n**Valid transitions:**\n- SAVED → APPROVED (direct approval without sending)\n- SENT → APPROVED (after taxpayer received via email)\n\n**After approval, you can:**\n- Send to SRI draft (`/send-sri-draft`)\n- Mark as manually declared (`/mark-declared`)\n- Reset if needed (`/recalculate`)"
      parameters:
        -
          in: header
          name: x-api-key
          description: ''
          example: YOUR_API_KEY_HERE
          schema:
            type: string
        -
          in: header
          name: x-organization-id
          description: ''
          example: '{YOUR_ORGANIZATION_ID}'
          schema:
            type: string
      responses:
        200:
          description: 'Successfully approved'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: success
                  message: 'Report approved successfully'
                  data:
                    report:
                      id: 01HZXXX123ABC456
                      tax_payer_id: 123
                      period: '2024-03-15'
                      periodicity: monthly
                      status: approved
                      status_label: Aprobado
                      comments:
                        -
                          status: approved
                          comment: 'Valores verificados, aprobado para envío al SRI'
                          timestamp: '2024-03-06T10:30:00Z'
                      total_taxes_to_pay_iva: 1200.0
                      updated_at: '2024-03-06T10:30:00.000000Z'
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: 'Report approved successfully'
                  data:
                    type: object
                    properties:
                      report:
                        type: object
                        properties:
                          id:
                            type: string
                            example: 01HZXXX123ABC456
                          tax_payer_id:
                            type: integer
                            example: 123
                          period:
                            type: string
                            example: '2024-03-15'
                          periodicity:
                            type: string
                            example: monthly
                          status:
                            type: string
                            example: approved
                          status_label:
                            type: string
                            example: Aprobado
                          comments:
                            type: array
                            example:
                              -
                                status: approved
                                comment: 'Valores verificados, aprobado para envío al SRI'
                                timestamp: '2024-03-06T10:30:00Z'
                            items:
                              type: object
                              properties:
                                status:
                                  type: string
                                  example: approved
                                comment:
                                  type: string
                                  example: 'Valores verificados, aprobado para envío al SRI'
                                timestamp:
                                  type: string
                                  example: '2024-03-06T10:30:00Z'
                          total_taxes_to_pay_iva:
                            type: number
                            example: 1200.0
                          updated_at:
                            type: string
                            example: '2024-03-06T10:30:00.000000Z'
        400:
          description: 'Invalid status transition'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: "Cannot transition from draft to approved. Report must be in 'saved' or 'sent' status"
                  code: INVALID_TRANSITION
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: "Cannot transition from draft to approved. Report must be in 'saved' or 'sent' status"
                  code:
                    type: string
                    example: INVALID_TRANSITION
        404:
          description: 'Report not found'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Report not found for period 2024-03'
                  code: NOT_FOUND
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Report not found for period 2024-03'
                  code:
                    type: string
                    example: NOT_FOUND
        422:
          description: 'Validation error'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Validation failed'
                  code: VALIDATION_ERROR
                  errors:
                    period:
                      - 'Period must be in YYYY-MM format (e.g., 2024-03)'
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Validation failed'
                  code:
                    type: string
                    example: VALIDATION_ERROR
                  errors:
                    type: object
                    properties:
                      period:
                        type: array
                        example:
                          - 'Period must be in YYYY-MM format (e.g., 2024-03)'
                        items:
                          type: string
      tags:
        - 'IVA Reports'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                period:
                  type: string
                  description: 'Period in YYYY-MM format.'
                  example: 2024-03
                comments:
                  type: string
                  description: 'Optional approval comments or notes (max 500 chars).'
                  example: 'Valores verificados, aprobado para envío al SRI'
              required:
                - period
    parameters:
      -
        in: path
        name: taxNumber
        description: "The taxpayer's RUC number (13 digits)."
        example: '1726051285001'
        required: true
        schema:
          type: string
  '/api/v1/taxpayers/{taxNumber}/iva-reports/reject':
    patch:
      summary: 'Reject IVA report'
      operationId: rejectIVAReport
      description: "Rejects the report, changing its status to REJECTED.\nThis action requires detailed comments explaining why the report was rejected.\nUsed when errors or inconsistencies are found during review.\n\n**Rejection means:**\n- Report has errors or inconsistencies\n- Corrections are needed before approval\n- Report must be recalculated or edited\n- Clear feedback must be provided\n\n**Valid transitions:**\n- SAVED → REJECTED\n- SENT → REJECTED (taxpayer or accountant found issues)\n\n**After rejection:**\n- Report must be recalculated (`/recalculate`)\n- Then saved, reviewed, and re-approved\n\n**Important:** Comments are REQUIRED (minimum 10 characters) to document the rejection reason."
      parameters:
        -
          in: header
          name: x-api-key
          description: ''
          example: YOUR_API_KEY_HERE
          schema:
            type: string
        -
          in: header
          name: x-organization-id
          description: ''
          example: '{YOUR_ORGANIZATION_ID}'
          schema:
            type: string
      responses:
        200:
          description: 'Successfully rejected'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: success
                  message: 'Report rejected successfully'
                  data:
                    report:
                      id: 01HZXXX123ABC456
                      tax_payer_id: 123
                      period: '2024-03-15'
                      periodicity: monthly
                      status: rejected
                      status_label: Rechazado
                      comments:
                        -
                          status: rejected
                          comment: 'Hay errores en las facturas de compras del día 15. Falta incluir factura #001-001-000123456'
                          timestamp: '2024-03-06T11:00:00Z'
                      total_taxes_to_pay_iva: 1200.0
                      updated_at: '2024-03-06T11:00:00.000000Z'
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: 'Report rejected successfully'
                  data:
                    type: object
                    properties:
                      report:
                        type: object
                        properties:
                          id:
                            type: string
                            example: 01HZXXX123ABC456
                          tax_payer_id:
                            type: integer
                            example: 123
                          period:
                            type: string
                            example: '2024-03-15'
                          periodicity:
                            type: string
                            example: monthly
                          status:
                            type: string
                            example: rejected
                          status_label:
                            type: string
                            example: Rechazado
                          comments:
                            type: array
                            example:
                              -
                                status: rejected
                                comment: 'Hay errores en las facturas de compras del día 15. Falta incluir factura #001-001-000123456'
                                timestamp: '2024-03-06T11:00:00Z'
                            items:
                              type: object
                              properties:
                                status:
                                  type: string
                                  example: rejected
                                comment:
                                  type: string
                                  example: 'Hay errores en las facturas de compras del día 15. Falta incluir factura #001-001-000123456'
                                timestamp:
                                  type: string
                                  example: '2024-03-06T11:00:00Z'
                          total_taxes_to_pay_iva:
                            type: number
                            example: 1200.0
                          updated_at:
                            type: string
                            example: '2024-03-06T11:00:00.000000Z'
        400:
          description: 'Invalid status transition'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: "Cannot transition from approved to rejected. Report must be in 'saved' or 'sent' status"
                  code: INVALID_TRANSITION
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: "Cannot transition from approved to rejected. Report must be in 'saved' or 'sent' status"
                  code:
                    type: string
                    example: INVALID_TRANSITION
        404:
          description: 'Report not found'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Report not found for period 2024-03'
                  code: NOT_FOUND
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Report not found for period 2024-03'
                  code:
                    type: string
                    example: NOT_FOUND
        422:
          description: ''
          content:
            application/json:
              schema:
                oneOf:
                  -
                    description: 'Missing comments'
                    type: object
                    example:
                      status: error
                      message: 'Validation failed'
                      code: VALIDATION_ERROR
                      errors:
                        comments:
                          - 'Comments are required when rejecting a report'
                    properties:
                      status:
                        type: string
                        example: error
                      message:
                        type: string
                        example: 'Validation failed'
                      code:
                        type: string
                        example: VALIDATION_ERROR
                      errors:
                        type: object
                        properties:
                          comments:
                            type: array
                            example:
                              - 'Comments are required when rejecting a report'
                            items:
                              type: string
                  -
                    description: 'Comments too short'
                    type: object
                    example:
                      status: error
                      message: 'Validation failed'
                      code: VALIDATION_ERROR
                      errors:
                        comments:
                          - 'Comments must be at least 10 characters'
                    properties:
                      status:
                        type: string
                        example: error
                      message:
                        type: string
                        example: 'Validation failed'
                      code:
                        type: string
                        example: VALIDATION_ERROR
                      errors:
                        type: object
                        properties:
                          comments:
                            type: array
                            example:
                              - 'Comments must be at least 10 characters'
                            items:
                              type: string
      tags:
        - 'IVA Reports'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                period:
                  type: string
                  description: 'Period in YYYY-MM format.'
                  example: 2024-03
                comments:
                  type: string
                  description: 'Detailed reason for rejection (10-500 chars).'
                  example: 'Hay errores en las facturas de compras del día 15. Falta incluir factura #001-001-000123456'
              required:
                - period
                - comments
    parameters:
      -
        in: path
        name: taxNumber
        description: "The taxpayer's RUC number (13 digits)."
        example: '1726051285001'
        required: true
        schema:
          type: string
  '/api/v1/taxpayers/{taxNumber}/iva-reports/mark-declared':
    patch:
      summary: 'Mark report as declared'
      operationId: markReportAsDeclared
      description: "Marks the report as DECLARED in your database.\nThis is a LOCAL action that does NOT interact with SRI services.\n\n**When to use this endpoint:**\n- You declared the report manually on the SRI website\n- You declared through another system or platform\n- You want to skip automatic SRI submission\n- You completed the declaration offline\n\n**What this does:**\n- Changes report status to DECLARED\n- Records the status change in history\n- Marks the period as completed for this taxpayer\n- Does NOT send anything to external services\n\n**Valid transitions:**\n- APPROVED → DECLARED (skip SRI auto-submission)\n- SRI_SENDED_COMPLETED → DECLARED (after SRI processing)\n\n**After marking as declared:**\n- Report can still be recalculated if needed\n- PDFs can be uploaded (`/upload-pdfs` - not yet implemented)\n- Status can transition to SRI_DECLARED_CONFIRMED"
      parameters:
        -
          in: header
          name: x-api-key
          description: ''
          example: YOUR_API_KEY_HERE
          schema:
            type: string
        -
          in: header
          name: x-organization-id
          description: ''
          example: '{YOUR_ORGANIZATION_ID}'
          schema:
            type: string
      responses:
        200:
          description: 'Successfully marked'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: success
                  message: 'Report marked as declared successfully'
                  data:
                    report:
                      id: 01HZXXX123ABC456
                      tax_payer_id: 123
                      period: '2024-03-15'
                      periodicity: monthly
                      status: declared
                      status_label: Declarado
                      total_taxes_to_pay_iva: 1200.0
                      updated_at: '2024-03-20T09:15:00.000000Z'
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: 'Report marked as declared successfully'
                  data:
                    type: object
                    properties:
                      report:
                        type: object
                        properties:
                          id:
                            type: string
                            example: 01HZXXX123ABC456
                          tax_payer_id:
                            type: integer
                            example: 123
                          period:
                            type: string
                            example: '2024-03-15'
                          periodicity:
                            type: string
                            example: monthly
                          status:
                            type: string
                            example: declared
                          status_label:
                            type: string
                            example: Declarado
                          total_taxes_to_pay_iva:
                            type: number
                            example: 1200.0
                          updated_at:
                            type: string
                            example: '2024-03-20T09:15:00.000000Z'
        400:
          description: 'Invalid status transition'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: "Cannot transition from draft to declared. Report must be in 'approved' or 'sri_sended_completed' status"
                  code: INVALID_TRANSITION
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: "Cannot transition from draft to declared. Report must be in 'approved' or 'sri_sended_completed' status"
                  code:
                    type: string
                    example: INVALID_TRANSITION
        404:
          description: 'Report not found'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Report not found for period 2024-03'
                  code: NOT_FOUND
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Report not found for period 2024-03'
                  code:
                    type: string
                    example: NOT_FOUND
        422:
          description: 'Validation error'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Validation failed'
                  code: VALIDATION_ERROR
                  errors:
                    period:
                      - 'Period must be in YYYY-MM format (e.g., 2024-03)'
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Validation failed'
                  code:
                    type: string
                    example: VALIDATION_ERROR
                  errors:
                    type: object
                    properties:
                      period:
                        type: array
                        example:
                          - 'Period must be in YYYY-MM format (e.g., 2024-03)'
                        items:
                          type: string
      tags:
        - 'IVA Reports'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                period:
                  type: string
                  description: 'Period in YYYY-MM format.'
                  example: 2024-03
              required:
                - period
    parameters:
      -
        in: path
        name: taxNumber
        description: "The taxpayer's RUC number (13 digits)."
        example: '1726051285001'
        required: true
        schema:
          type: string
  '/api/v1/taxpayers/{taxNumber}/iva-reports/send':
    post:
      summary: 'Send IVA report via email'
      operationId: sendIVAReportViaEmail
      description: "Sends the IVA report via email to the taxpayer or specified recipients for review and approval.\nThis is an EXTERNAL COMMUNICATION action that actually sends emails through SMTP.\n\n**What this endpoint does:**\n1. Validates the report is in SAVED or SENT status\n2. Generates a PDF of the report (if not cached)\n3. Sends email with PDF attachment to specified addresses\n4. Records each recipient in share logs for audit\n5. Changes report status to SENT (if not already)\n6. Registers status change in history\n\n**Email recipients:**\n- If `emails` parameter provided: sends to those addresses\n- If `emails` is empty: uses taxpayer's registered email\n- Maximum 10 email addresses per request\n\n**Valid transitions:**\n- SAVED → SENT (first send)\n- SENT → SENT (resend to same or different recipients)\n\n**Email content includes:**\n- PDF report attachment\n- Optional comments/message\n- Link to view report online\n- Instructions for approval/rejection\n\n**Note:** This operation may take 5-10 seconds depending on SMTP server response."
      parameters:
        -
          in: header
          name: x-api-key
          description: ''
          example: YOUR_API_KEY_HERE
          schema:
            type: string
        -
          in: header
          name: x-organization-id
          description: ''
          example: '{YOUR_ORGANIZATION_ID}'
          schema:
            type: string
      responses:
        200:
          description: 'Successfully sent'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: success
                  message: 'Report sent successfully'
                  data:
                    report:
                      id: 01HZXXX123ABC456
                      tax_payer_id: 123
                      period: '2024-03-15'
                      periodicity: monthly
                      status: sent
                      status_label: 'Enviado para revisión'
                      report_comments: 'Por favor revisar los totales de ventas y confirmar'
                      public_link: 'https://app.taxo.ec/public/reports/abc123def'
                      total_taxes_to_pay_iva: 1200.0
                      updated_at: '2024-03-06T12:00:00.000000Z'
                    recipients:
                      - cliente@example.com
                      - contabilidad@empresa.com
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: 'Report sent successfully'
                  data:
                    type: object
                    properties:
                      report:
                        type: object
                        properties:
                          id:
                            type: string
                            example: 01HZXXX123ABC456
                          tax_payer_id:
                            type: integer
                            example: 123
                          period:
                            type: string
                            example: '2024-03-15'
                          periodicity:
                            type: string
                            example: monthly
                          status:
                            type: string
                            example: sent
                          status_label:
                            type: string
                            example: 'Enviado para revisión'
                          report_comments:
                            type: string
                            example: 'Por favor revisar los totales de ventas y confirmar'
                          public_link:
                            type: string
                            example: 'https://app.taxo.ec/public/reports/abc123def'
                          total_taxes_to_pay_iva:
                            type: number
                            example: 1200.0
                          updated_at:
                            type: string
                            example: '2024-03-06T12:00:00.000000Z'
                      recipients:
                        type: array
                        example:
                          - cliente@example.com
                          - contabilidad@empresa.com
                        items:
                          type: string
        400:
          description: 'Invalid status'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: "Cannot send report from status draft. Report must be in 'saved' or 'sent' status"
                  code: INVALID_STATUS
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: "Cannot send report from status draft. Report must be in 'saved' or 'sent' status"
                  code:
                    type: string
                    example: INVALID_STATUS
        404:
          description: 'Report not found'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Report not found for period 2024-03'
                  code: NOT_FOUND
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Report not found for period 2024-03'
                  code:
                    type: string
                    example: NOT_FOUND
        422:
          description: ''
          content:
            application/json:
              schema:
                oneOf:
                  -
                    description: 'No recipients'
                    type: object
                    example:
                      status: error
                      message: 'Validation failed'
                      code: VALIDATION_ERROR
                      errors:
                        emails:
                          - 'No email addresses provided and taxpayer has no registered email'
                    properties:
                      status:
                        type: string
                        example: error
                      message:
                        type: string
                        example: 'Validation failed'
                      code:
                        type: string
                        example: VALIDATION_ERROR
                      errors:
                        type: object
                        properties:
                          emails:
                            type: array
                            example:
                              - 'No email addresses provided and taxpayer has no registered email'
                            items:
                              type: string
                  -
                    description: 'Too many emails'
                    type: object
                    example:
                      status: error
                      message: 'Validation failed'
                      code: VALIDATION_ERROR
                      errors:
                        emails:
                          - 'Cannot send to more than 10 email addresses'
                    properties:
                      status:
                        type: string
                        example: error
                      message:
                        type: string
                        example: 'Validation failed'
                      code:
                        type: string
                        example: VALIDATION_ERROR
                      errors:
                        type: object
                        properties:
                          emails:
                            type: array
                            example:
                              - 'Cannot send to more than 10 email addresses'
                            items:
                              type: string
        503:
          description: 'SMTP error'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Failed to send email: Connection to SMTP server failed'
                  code: EMAIL_SEND_FAILED
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Failed to send email: Connection to SMTP server failed'
                  code:
                    type: string
                    example: EMAIL_SEND_FAILED
      tags:
        - 'IVA Reports'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                period:
                  type: string
                  description: 'Period in YYYY-MM format.'
                  example: 2024-03
                emails:
                  type: array
                  description: 'Optional array of email addresses (max 10).'
                  example:
                    - cliente@example.com
                    - contabilidad@empresa.com
                  items:
                    type: string
                comments:
                  type: string
                  description: 'Optional message/comments to include in email (max 500 chars).'
                  example: 'Por favor revisar los totales de ventas y confirmar'
              required:
                - period
    parameters:
      -
        in: path
        name: taxNumber
        description: "The taxpayer's RUC number (13 digits)."
        example: '1726051285001'
        required: true
        schema:
          type: string
  '/api/v1/taxpayers/{taxNumber}/iva-reports/send-sri-draft':
    post:
      summary: 'Send report to SRI draft'
      operationId: sendReportToSRIDraft
      description: "Sends the report to the SRI (Ecuadorian Tax Authority) draft/borrador system.\nThis creates a DRAFT in the SRI system for validation, NOT a final declaration.\nThis is an EXTERNAL COMMUNICATION action that calls SRI web services.\n\n**Important notes:**\n- This creates a DRAFT (borrador) in SRI, not a final declaration\n- After draft creation, you must finalize it on SRI website\n- The process is asynchronous (uses webhooks or timeout)\n- May take several minutes to complete\n\n**The complete workflow:**\n1. Validates report is APPROVED or ERROR (for retry)\n2. Creates JSON representation of report (Form 104)\n3. Calls SRI API to create draft\n4. Changes status to SRI_SENDED (processing)\n5. Queues timeout job (15 minutes safety net)\n6. Awaits SRI webhook response:\n   - Success → SRI_SENDED_COMPLETED\n   - Failure → ERROR\n7. Timeout if no webhook received\n\n**Valid transitions:**\n- APPROVED → SRI_SENDED (first submission)\n- ERROR → SRI_SENDED (retry after error)\n\n**After successful SRI draft:**\n- Wait for webhook (usually 2-5 minutes)\n- Check report status via GET endpoint\n- When SRI_SENDED_COMPLETED, mark as declared\n\n**Requirements:**\n- Taxpayer must have valid digital signature configured\n- All report values must be valid\n- SRI services must be operational\n\n**Note:** This operation typically takes 5-10 seconds for the API call,\nplus 2-5 minutes for SRI processing (webhook notification)."
      parameters:
        -
          in: header
          name: x-api-key
          description: ''
          example: YOUR_API_KEY_HERE
          schema:
            type: string
        -
          in: header
          name: x-organization-id
          description: ''
          example: '{YOUR_ORGANIZATION_ID}'
          schema:
            type: string
      responses:
        200:
          description: 'Successfully sent to SRI'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: success
                  message: 'Report sent to SRI draft successfully'
                  data:
                    report:
                      id: 01HZXXX123ABC456
                      tax_payer_id: 123
                      period: '2024-03-15'
                      periodicity: monthly
                      status: sri_sended
                      status_label: 'Borrador SRI en progreso'
                      total_taxes_to_pay_iva: 1200.0
                      updated_at: '2024-03-07T10:00:00.000000Z'
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: 'Report sent to SRI draft successfully'
                  data:
                    type: object
                    properties:
                      report:
                        type: object
                        properties:
                          id:
                            type: string
                            example: 01HZXXX123ABC456
                          tax_payer_id:
                            type: integer
                            example: 123
                          period:
                            type: string
                            example: '2024-03-15'
                          periodicity:
                            type: string
                            example: monthly
                          status:
                            type: string
                            example: sri_sended
                          status_label:
                            type: string
                            example: 'Borrador SRI en progreso'
                          total_taxes_to_pay_iva:
                            type: number
                            example: 1200.0
                          updated_at:
                            type: string
                            example: '2024-03-07T10:00:00.000000Z'
        400:
          description: 'Invalid status'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: "Cannot send to SRI from status saved. Report must be in 'approved' or 'error' status"
                  code: INVALID_STATUS
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: "Cannot send to SRI from status saved. Report must be in 'approved' or 'error' status"
                  code:
                    type: string
                    example: INVALID_STATUS
        404:
          description: 'Report not found'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Report not found for period 2024-03'
                  code: NOT_FOUND
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Report not found for period 2024-03'
                  code:
                    type: string
                    example: NOT_FOUND
        500:
          description: 'JSON creation failed'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Failed to create report JSON: Missing required field'
                  code: JSON_CREATION_FAILED
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Failed to create report JSON: Missing required field'
                  code:
                    type: string
                    example: JSON_CREATION_FAILED
        503:
          description: ''
          content:
            application/json:
              schema:
                oneOf:
                  -
                    description: 'SRI unavailable'
                    type: object
                    example:
                      status: error
                      message: 'SRI service is unavailable or timeout'
                      code: SRI_UNAVAILABLE
                    properties:
                      status:
                        type: string
                        example: error
                      message:
                        type: string
                        example: 'SRI service is unavailable or timeout'
                      code:
                        type: string
                        example: SRI_UNAVAILABLE
                  -
                    description: 'SRI error response'
                    type: object
                    example:
                      status: error
                      message: 'SRI service returned an error'
                      code: SRI_ERROR
                      errors:
                        sri_response:
                          status: error
                          message: 'Invalid signature'
                    properties:
                      status:
                        type: string
                        example: error
                      message:
                        type: string
                        example: 'SRI service returned an error'
                      code:
                        type: string
                        example: SRI_ERROR
                      errors:
                        type: object
                        properties:
                          sri_response:
                            type: object
                            properties:
                              status:
                                type: string
                                example: error
                              message:
                                type: string
                                example: 'Invalid signature'
      tags:
        - 'IVA Reports'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                period:
                  type: string
                  description: 'Period in YYYY-MM format.'
                  example: 2024-03
              required:
                - period
    parameters:
      -
        in: path
        name: taxNumber
        description: "The taxpayer's RUC number (13 digits)."
        example: '1726051285001'
        required: true
        schema:
          type: string
  '/api/v1/taxpayers/{taxNumber}/received':
    get:
      summary: 'List received documents for a taxpayer'
      operationId: listReceivedDocumentsForATaxpayer
      description: "Retrieves a paginated list of received documents (purchase invoices) for a specific taxpayer.\nThis endpoint returns the same data as the UI received documents listing.\n\n**IMPORTANT:** This is a GET request. All parameters must be sent as query string parameters in the URL.\nDo NOT send a request body.\n\n**Example URLs:**\n\nBasic query with date range:\n```\nGET /api/v1/taxpayers/1726051285001/received?start_date=2024-01-01&end_date=2024-01-31&page=1&per_page=20\n```\n\nWith filters for commercial deductible expenses:\n```\nGET /api/v1/taxpayers/1726051285001/received?category_type=commercial_expenses&deductible_type=deductible&status=AUTORIZADO\n```\n\n**Important - HTTP Headers:**\n- **Required headers**: `x-api-key`, `x-organization-id`, `Accept: application/json`\n- **Do NOT send**: `Content-Type: application/json` (this is a GET request, parameters go in the URL)\n- Sending `Content-Type` header can cause parameter parsing issues in some environments\n\n**Filter Format:** All filters use top-level query parameters (consistent with TaxPayers and IVA Reports endpoints).\n\n**Filtering Examples:**\n\nFilter by category type (commercial expenses only):\n```\nGET /api/v1/taxpayers/1726051285001/received?category_type=commercial_expenses\n```\n\nFilter by deductibility (only deductible):\n```\nGET /api/v1/taxpayers/1726051285001/received?deductible_type=deductible\n```\n\nFilter by specific categories (multiple IDs allowed):\n```\nGET /api/v1/taxpayers/1726051285001/received?category_id[]=123&category_id[]=456\n```\n*Note: First retrieve available categories from GET /api/v1/taxpayers/{taxNumber}/categories*\n\nFilter by status (authorized documents only):\n```\nGET /api/v1/taxpayers/1726051285001/received?status=AUTORIZADO\n```\n\nSearch providers:\n```\nGET /api/v1/taxpayers/1726051285001/received?search=PROVEEDOR\n```\n\nFilter only uncategorized:\n```\nGET /api/v1/taxpayers/1726051285001/received?uncategorized=true\n```\n\nFilter by origin (electronic documents only):\n```\nGET /api/v1/taxpayers/1726051285001/received?origin=tws\n```\n\n**Sorting Examples:**\n\nSort by highest amount first:\n```\nGET /api/v1/taxpayers/1726051285001/received?sort=-sub_total\n```\n\nSort by supplier name alphabetically (A-Z):\n```\nGET /api/v1/taxpayers/1726051285001/received?sort=contact_name\n```\n\nSort by newest first (default), then by document number:\n```\nGET /api/v1/taxpayers/1726051285001/received?sort=-date_only,-bill_number\n```\n\nMultiple filters combined with sorting (real use case):\n```\nGET /api/v1/taxpayers/1726051285001/received?start_date=2024-01-01&end_date=2024-01-31&category_type=commercial_expenses&deductible_type=deductible&status=AUTORIZADO&sort=-sub_total\n```"
      parameters:
        -
          in: query
          name: start_date
          description: 'Start date for filtering (YYYY-MM-DD). Defaults to first day of current month.'
          example: null
          required: false
          schema:
            type: string
            description: 'Start date for filtering (YYYY-MM-DD). Defaults to first day of current month.'
            example: null
        -
          in: query
          name: end_date
          description: 'End date for filtering (YYYY-MM-DD). Defaults to last day of current month.'
          example: null
          required: false
          schema:
            type: string
            description: 'End date for filtering (YYYY-MM-DD). Defaults to last day of current month.'
            example: null
        -
          in: query
          name: page
          description: 'Page number for pagination. Default: 1.'
          example: null
          required: false
          schema:
            type: integer
            description: 'Page number for pagination. Default: 1.'
            example: null
        -
          in: query
          name: per_page
          description: 'Items per page (1-100). Default: 20.'
          example: null
          required: false
          schema:
            type: integer
            description: 'Items per page (1-100). Default: 20.'
            example: null
        -
          in: query
          name: sort
          description: 'Sort field. Allowed values: date_only (document date), contact_name (supplier name), sub_total (subtotal amount), bill_number (document number). Prefix with "-" for descending order. You can combine multiple sorts with commas. Examples: "-date_only" (newest first), "contact_name" (A-Z), "-sub_total,date_only" (highest amount first, then by date). Default: -date_only,-bill_number.'
          example: null
          required: false
          schema:
            type: string
            description: 'Sort field. Allowed values: date_only (document date), contact_name (supplier name), sub_total (subtotal amount), bill_number (document number). Prefix with "-" for descending order. You can combine multiple sorts with commas. Examples: "-date_only" (newest first), "contact_name" (A-Z), "-sub_total,date_only" (highest amount first, then by date). Default: -date_only,-bill_number.'
            example: null
        -
          in: query
          name: 'category_id[]'
          description: 'Filter by category ID(s). Can pass multiple values using array notation. To obtain available category IDs for the taxpayer, use GET /api/v1/taxpayers/{taxNumber}/categories.'
          example: null
          required: false
          schema:
            type: integer
            description: 'Filter by category ID(s). Can pass multiple values using array notation. To obtain available category IDs for the taxpayer, use GET /api/v1/taxpayers/{taxNumber}/categories.'
            example: null
        -
          in: query
          name: category_type
          description: 'Filter by expense type. Must be one of: commercial_expenses, personal_expenses, non_deductible_expenses.'
          example: null
          required: false
          schema:
            type: string
            description: 'Filter by expense type. Must be one of: commercial_expenses, personal_expenses, non_deductible_expenses.'
            example: null
        -
          in: query
          name: deductible_type
          description: 'Filter by tax deductibility. Must be one of: deductible, non_deductible.'
          example: null
          required: false
          schema:
            type: string
            description: 'Filter by tax deductibility. Must be one of: deductible, non_deductible.'
            example: null
        -
          in: query
          name: status
          description: 'Filter by document status. Must be one of: AUTORIZADO, ANULADO.'
          example: null
          required: false
          schema:
            type: string
            description: 'Filter by document status. Must be one of: AUTORIZADO, ANULADO.'
            example: null
        -
          in: query
          name: search
          description: 'Search in provider name, document number, access key, RUC, email, or phone.'
          example: null
          required: false
          schema:
            type: string
            description: 'Search in provider name, document number, access key, RUC, email, or phone.'
            example: null
        -
          in: query
          name: uncategorized
          description: 'Filter only uncategorized documents. Accepts: true/false, 1/0, yes/no, on/off.'
          example: null
          required: false
          schema:
            type: boolean
            description: 'Filter only uncategorized documents. Accepts: true/false, 1/0, yes/no, on/off.'
            example: null
        -
          in: query
          name: origin
          description: 'Filter by document origin/source system. Must be one of: tws, xml-import, physical-upload.'
          example: null
          required: false
          schema:
            type: string
            description: 'Filter by document origin/source system. Must be one of: tws, xml-import, physical-upload.'
            example: null
        -
          in: header
          name: x-api-key
          description: ''
          example: YOUR_API_KEY_HERE
          schema:
            type: string
        -
          in: header
          name: x-organization-id
          description: ''
          example: '{YOUR_ORGANIZATION_ID}'
          schema:
            type: string
      responses:
        200:
          description: ''
          content:
            application/json:
              schema:
                oneOf:
                  -
                    description: 'Success - with bills'
                    type: object
                    example:
                      status: success
                      message: 'Received documents retrieved successfully'
                      data:
                        bills:
                          -
                            id: 12345
                            ulid: 01HZXXX123ABC456
                            bill_number: 001-001-000001234
                            access_key: '0101202401172605128500110010010000012341234567813'
                            billed_at: '2024-01-15T14:30:00.000000Z'
                            date_only: '2024-01-15'
                            bill_status: AUTORIZADO
                            is_physical: false
                            is_sale_note: false
                            is_locked: false
                            lock_reason: null
                            origin: tws
                            document_type: electronic
                            issuer:
                              tax_number: '1234567890001'
                              business_name: 'PROVEEDOR DEMO S.A.'
                              trade_name: 'PROVEEDOR DEMO'
                              address: 'Av. Principal 123 y Secundaria'
                              email: proveedor@example.com
                            payment:
                              payment_method: '01'
                              payment_amount: 112.0
                            totals:
                              subtotal_vat_zero: 0.0
                              subtotal_vat_twelve: 100.0
                              subtotal_vat_fifteen: 0.0
                              sub_total: 100.0
                              sub_total_show: 100.0
                              discount: 0.0
                              total: 112.0
                            taxes:
                              vat_twelve: 12.0
                              vat_fifteen: 0.0
                              total_tax: 12.0
                            categories:
                              -
                                id: 45
                                category_id: 12
                                name: 'Servicios Profesionales'
                                color: bg-blue-500
                                icon: 'M12 6v6m0 0v6m0-6h6m-6 0H6'
                                count: 1
                            category_types:
                              -
                                category_type: commercial_expenses
                                count: 1
                            deductible_types:
                              -
                                deductible_type: deductible
                                count: 1
                            categorized_by:
                              - manual
                            has_credit_notes: false
                            has_withholdings: false
                            voided_at: null
                            voided_origin: null
                            created_at: '2024-01-15T14:35:00.000000Z'
                            updated_at: '2024-01-15T14:35:00.000000Z'
                      meta:
                        pagination:
                          current_page: 1
                          per_page: 20
                          total: 45
                          total_pages: 3
                          from: 1
                          to: 20
                        filters_applied:
                          start_date: '2024-01-01'
                          end_date: '2024-01-31'
                          category_type: commercial_expenses
                          deductible_type: deductible
                          status: AUTORIZADO
                          sort: '-date_only,-bill_number'
                    properties:
                      status:
                        type: string
                        example: success
                      message:
                        type: string
                        example: 'Received documents retrieved successfully'
                      data:
                        type: object
                        properties:
                          bills:
                            type: array
                            example:
                              -
                                id: 12345
                                ulid: 01HZXXX123ABC456
                                bill_number: 001-001-000001234
                                access_key: '0101202401172605128500110010010000012341234567813'
                                billed_at: '2024-01-15T14:30:00.000000Z'
                                date_only: '2024-01-15'
                                bill_status: AUTORIZADO
                                is_physical: false
                                is_sale_note: false
                                is_locked: false
                                lock_reason: null
                                origin: tws
                                document_type: electronic
                                issuer:
                                  tax_number: '1234567890001'
                                  business_name: 'PROVEEDOR DEMO S.A.'
                                  trade_name: 'PROVEEDOR DEMO'
                                  address: 'Av. Principal 123 y Secundaria'
                                  email: proveedor@example.com
                                payment:
                                  payment_method: '01'
                                  payment_amount: 112
                                totals:
                                  subtotal_vat_zero: 0
                                  subtotal_vat_twelve: 100
                                  subtotal_vat_fifteen: 0
                                  sub_total: 100
                                  sub_total_show: 100
                                  discount: 0
                                  total: 112
                                taxes:
                                  vat_twelve: 12
                                  vat_fifteen: 0
                                  total_tax: 12
                                categories:
                                  -
                                    id: 45
                                    category_id: 12
                                    name: 'Servicios Profesionales'
                                    color: bg-blue-500
                                    icon: 'M12 6v6m0 0v6m0-6h6m-6 0H6'
                                    count: 1
                                category_types:
                                  -
                                    category_type: commercial_expenses
                                    count: 1
                                deductible_types:
                                  -
                                    deductible_type: deductible
                                    count: 1
                                categorized_by:
                                  - manual
                                has_credit_notes: false
                                has_withholdings: false
                                voided_at: null
                                voided_origin: null
                                created_at: '2024-01-15T14:35:00.000000Z'
                                updated_at: '2024-01-15T14:35:00.000000Z'
                            items:
                              type: object
                              properties:
                                id:
                                  type: integer
                                  example: 12345
                                ulid:
                                  type: string
                                  example: 01HZXXX123ABC456
                                bill_number:
                                  type: string
                                  example: 001-001-000001234
                                access_key:
                                  type: string
                                  example: '0101202401172605128500110010010000012341234567813'
                                billed_at:
                                  type: string
                                  example: '2024-01-15T14:30:00.000000Z'
                                date_only:
                                  type: string
                                  example: '2024-01-15'
                                bill_status:
                                  type: string
                                  example: AUTORIZADO
                                is_physical:
                                  type: boolean
                                  example: false
                                is_sale_note:
                                  type: boolean
                                  example: false
                                is_locked:
                                  type: boolean
                                  example: false
                                lock_reason:
                                  type: string
                                  example: null
                                origin:
                                  type: string
                                  example: tws
                                document_type:
                                  type: string
                                  example: electronic
                                issuer:
                                  type: object
                                  properties:
                                    tax_number:
                                      type: string
                                      example: '1234567890001'
                                    business_name:
                                      type: string
                                      example: 'PROVEEDOR DEMO S.A.'
                                    trade_name:
                                      type: string
                                      example: 'PROVEEDOR DEMO'
                                    address:
                                      type: string
                                      example: 'Av. Principal 123 y Secundaria'
                                    email:
                                      type: string
                                      example: proveedor@example.com
                                payment:
                                  type: object
                                  properties:
                                    payment_method:
                                      type: string
                                      example: '01'
                                    payment_amount:
                                      type: number
                                      example: 112.0
                                totals:
                                  type: object
                                  properties:
                                    subtotal_vat_zero:
                                      type: number
                                      example: 0.0
                                    subtotal_vat_twelve:
                                      type: number
                                      example: 100.0
                                    subtotal_vat_fifteen:
                                      type: number
                                      example: 0.0
                                    sub_total:
                                      type: number
                                      example: 100.0
                                    sub_total_show:
                                      type: number
                                      example: 100.0
                                    discount:
                                      type: number
                                      example: 0.0
                                    total:
                                      type: number
                                      example: 112.0
                                taxes:
                                  type: object
                                  properties:
                                    vat_twelve:
                                      type: number
                                      example: 12.0
                                    vat_fifteen:
                                      type: number
                                      example: 0.0
                                    total_tax:
                                      type: number
                                      example: 12.0
                                categories:
                                  type: array
                                  example:
                                    -
                                      id: 45
                                      category_id: 12
                                      name: 'Servicios Profesionales'
                                      color: bg-blue-500
                                      icon: 'M12 6v6m0 0v6m0-6h6m-6 0H6'
                                      count: 1
                                  items:
                                    type: object
                                    properties:
                                      id: { type: integer, example: 45 }
                                      category_id: { type: integer, example: 12 }
                                      name: { type: string, example: 'Servicios Profesionales' }
                                      color: { type: string, example: bg-blue-500 }
                                      icon: { type: string, example: 'M12 6v6m0 0v6m0-6h6m-6 0H6' }
                                      count: { type: integer, example: 1 }
                                category_types:
                                  type: array
                                  example:
                                    -
                                      category_type: commercial_expenses
                                      count: 1
                                  items:
                                    type: object
                                    properties:
                                      category_type: { type: string, example: commercial_expenses }
                                      count: { type: integer, example: 1 }
                                deductible_types:
                                  type: array
                                  example:
                                    -
                                      deductible_type: deductible
                                      count: 1
                                  items:
                                    type: object
                                    properties:
                                      deductible_type: { type: string, example: deductible }
                                      count: { type: integer, example: 1 }
                                categorized_by:
                                  type: array
                                  example:
                                    - manual
                                  items:
                                    type: string
                                has_credit_notes:
                                  type: boolean
                                  example: false
                                has_withholdings:
                                  type: boolean
                                  example: false
                                voided_at:
                                  type: string
                                  example: null
                                voided_origin:
                                  type: string
                                  example: null
                                created_at:
                                  type: string
                                  example: '2024-01-15T14:35:00.000000Z'
                                updated_at:
                                  type: string
                                  example: '2024-01-15T14:35:00.000000Z'
                      meta:
                        type: object
                        properties:
                          pagination:
                            type: object
                            properties:
                              current_page:
                                type: integer
                                example: 1
                              per_page:
                                type: integer
                                example: 20
                              total:
                                type: integer
                                example: 45
                              total_pages:
                                type: integer
                                example: 3
                              from:
                                type: integer
                                example: 1
                              to:
                                type: integer
                                example: 20
                          filters_applied:
                            type: object
                            properties:
                              start_date:
                                type: string
                                example: '2024-01-01'
                              end_date:
                                type: string
                                example: '2024-01-31'
                              category_type:
                                type: string
                                example: commercial_expenses
                              deductible_type:
                                type: string
                                example: deductible
                              status:
                                type: string
                                example: AUTORIZADO
                              sort:
                                type: string
                                example: '-date_only,-bill_number'
                  -
                    description: 'Success - no bills found'
                    type: object
                    example:
                      status: success
                      message: 'Received documents retrieved successfully'
                      data:
                        bills: []
                      meta:
                        pagination:
                          current_page: 1
                          per_page: 20
                          total: 0
                          total_pages: 0
                          from: 0
                          to: 0
                        filters_applied:
                          start_date: '2024-12-01'
                          end_date: '2024-12-31'
                          sort: '-date_only,-bill_number'
                    properties:
                      status:
                        type: string
                        example: success
                      message:
                        type: string
                        example: 'Received documents retrieved successfully'
                      data:
                        type: object
                        properties:
                          bills:
                            type: array
                            example: []
                      meta:
                        type: object
                        properties:
                          pagination:
                            type: object
                            properties:
                              current_page:
                                type: integer
                                example: 1
                              per_page:
                                type: integer
                                example: 20
                              total:
                                type: integer
                                example: 0
                              total_pages:
                                type: integer
                                example: 0
                              from:
                                type: integer
                                example: 0
                              to:
                                type: integer
                                example: 0
                          filters_applied:
                            type: object
                            properties:
                              start_date:
                                type: string
                                example: '2024-12-01'
                              end_date:
                                type: string
                                example: '2024-12-31'
                              sort:
                                type: string
                                example: '-date_only,-bill_number'
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Invalid API key or organization ID'
                  code: UNAUTHORIZED
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Invalid API key or organization ID'
                  code:
                    type: string
                    example: UNAUTHORIZED
        404:
          description: 'Taxpayer not found'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Taxpayer not found'
                  code: NOT_FOUND
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Taxpayer not found'
                  code:
                    type: string
                    example: NOT_FOUND
        422:
          description: 'Invalid filter'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Validation failed'
                  code: VALIDATION_ERROR
                  errors:
                    start_date:
                      - 'The start date field must be a valid date in YYYY-MM-DD format'
                    per_page:
                      - 'The per page must not be greater than 100'
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Validation failed'
                  code:
                    type: string
                    example: VALIDATION_ERROR
                  errors:
                    type: object
                    properties:
                      start_date:
                        type: array
                        example:
                          - 'The start date field must be a valid date in YYYY-MM-DD format'
                        items:
                          type: string
                      per_page:
                        type: array
                        example:
                          - 'The per page must not be greater than 100'
                        items:
                          type: string
      tags:
        - 'Received Documents'
    parameters:
      -
        in: path
        name: taxNumber
        description: "The taxpayer's RUC number (13 digits)."
        example: '1726051285001'
        required: true
        schema:
          type: string
  '/api/v1/taxpayers/{taxNumber}/received/accumulated':
    get:
      summary: 'Get accumulated totals for received documents'
      operationId: getAccumulatedTotalsForReceivedDocuments
      description: "Retrieves aggregated totals and statistics for received documents based on the applied filters.\nThis endpoint complements the received documents listing endpoint by providing calculated totals.\n\n**IMPORTANT:** This is a GET request. All parameters must be sent as query string parameters in the URL.\nDo NOT send a request body.\n\n**What This Endpoint Returns:**\n\n- **Subtotals by VAT rate**: Detailed breakdown of subtotals for each VAT rate (15%, 14%, 13%, 12%, 5%, 0%, exempt, not subject)\n- **VAT amounts**: Total VAT collected at each rate\n- **Discounts**: Discounts applied at each VAT rate\n- **Header totals**: Simplified totals (subtotal, taxes, total)\n- **Document counts**: Total documents, categorized, uncategorized, voided\n- **Applied filters**: Summary of which filters were used\n\n**⚠️ Understanding `total_sum` vs `total_header`:**\n\nThe response includes TWO total values that may differ slightly:\n\n- **`total_sum`**: Direct sum of the `total` field from each document.\n  - This is the **OFFICIAL** total authorized by SRI for each document.\n  - **Use this for**: Official reports, tax declarations, accounting records.\n  - Example: If 3 bills have totals of 100.00, 200.00, and 300.00, then `total_sum` = 600.00\n\n- **`total_header`**: Calculated by summing adjusted subtotals + recalculated VAT per document.\n  - VAT is recalculated as: `round((subtotal - discount) * vat_rate, 2)` for each document.\n  - May differ from `total_sum` by a few cents due to rounding differences.\n  - **Use this for**: Internal consistency checks, discount distribution analysis.\n\n**Why the difference?**\nWhen documents are received, the SRI-authorized VAT may differ slightly from a strict mathematical recalculation\ndue to rounding rules applied by different systems (suppliers' systems, manual entry, XML imports, etc.).\nThe `total_sum` respects the original authorized values, while `total_header` applies uniform recalculation logic.\n\n**Recommendation:** For official purposes, always use `total_sum` as it represents the actual authorized totals.\n\n**Use Cases:**\n\n- Display statistics cards in dashboard (like UI)\n- Generate financial reports\n- Validate VAT calculations\n- Monitor categorization progress\n- Calculate tax deductions\n\n**Example URLs:**\n\nGet totals for current month:\n```\nGET /api/v1/taxpayers/1726051285001/received/accumulated\n```\n\nGet totals for specific date range:\n```\nGET /api/v1/taxpayers/1726051285001/received/accumulated?start_date=2024-01-01&end_date=2024-01-31\n```\n\nGet totals for commercial deductible expenses:\n```\nGET /api/v1/taxpayers/1726051285001/received/accumulated?category_type=commercial_expenses&deductible_type=deductible\n```\n\n**Filters:**\n\nThis endpoint accepts the **same filters** as the bills listing endpoint:\n- `start_date`, `end_date`: Date range (defaults to current month)\n- `category_id[]`: Specific category IDs (array)\n- `category_type`: Expense type (commercial_expenses, personal_expenses, non_deductible_expenses)\n- `deductible_type`: Tax deductibility (deductible, non_deductible)\n- `status`: Document status (AUTORIZADO, ANULADO)\n- `search`: Search in provider name, RUC, document number, etc.\n- `uncategorized`: Only uncategorized documents (true/false)\n- `origin`: Document origin (electronic, physical)\n\n**Note:** Pagination parameters (page, per_page) and sort are ignored as this endpoint returns a single aggregated result."
      parameters:
        -
          in: query
          name: start_date
          description: 'Start date for filtering (YYYY-MM-DD). Defaults to first day of current month.'
          example: null
          required: false
          schema:
            type: string
            description: 'Start date for filtering (YYYY-MM-DD). Defaults to first day of current month.'
            example: null
        -
          in: query
          name: end_date
          description: 'End date for filtering (YYYY-MM-DD). Defaults to last day of current month.'
          example: null
          required: false
          schema:
            type: string
            description: 'End date for filtering (YYYY-MM-DD). Defaults to last day of current month.'
            example: null
        -
          in: query
          name: 'category_id[]'
          description: 'Filter by category ID(s). Can pass multiple values using array notation. To obtain available category IDs for the taxpayer, use GET /api/v1/taxpayers/{taxNumber}/categories.'
          example: null
          required: false
          schema:
            type: integer
            description: 'Filter by category ID(s). Can pass multiple values using array notation. To obtain available category IDs for the taxpayer, use GET /api/v1/taxpayers/{taxNumber}/categories.'
            example: null
        -
          in: query
          name: category_type
          description: 'Filter by expense type. Must be one of: commercial_expenses, personal_expenses, non_deductible_expenses.'
          example: null
          required: false
          schema:
            type: string
            description: 'Filter by expense type. Must be one of: commercial_expenses, personal_expenses, non_deductible_expenses.'
            example: null
        -
          in: query
          name: deductible_type
          description: 'Filter by tax deductibility. Must be one of: deductible, non_deductible.'
          example: null
          required: false
          schema:
            type: string
            description: 'Filter by tax deductibility. Must be one of: deductible, non_deductible.'
            example: null
        -
          in: query
          name: status
          description: 'Filter by document status. Must be one of: AUTORIZADO, ANULADO.'
          example: null
          required: false
          schema:
            type: string
            description: 'Filter by document status. Must be one of: AUTORIZADO, ANULADO.'
            example: null
        -
          in: query
          name: search
          description: 'Search in provider name, document number, access key, RUC, email, or phone.'
          example: null
          required: false
          schema:
            type: string
            description: 'Search in provider name, document number, access key, RUC, email, or phone.'
            example: null
        -
          in: query
          name: uncategorized
          description: 'Filter only uncategorized documents. Accepts: true/false, 1/0, yes/no, on/off.'
          example: null
          required: false
          schema:
            type: boolean
            description: 'Filter only uncategorized documents. Accepts: true/false, 1/0, yes/no, on/off.'
            example: null
        -
          in: query
          name: origin
          description: 'Filter by document origin/source system. Must be one of: tws, xml-import, physical-upload.'
          example: null
          required: false
          schema:
            type: string
            description: 'Filter by document origin/source system. Must be one of: tws, xml-import, physical-upload.'
            example: null
        -
          in: header
          name: x-api-key
          description: ''
          example: YOUR_API_KEY_HERE
          schema:
            type: string
        -
          in: header
          name: x-organization-id
          description: ''
          example: '{YOUR_ORGANIZATION_ID}'
          schema:
            type: string
      responses:
        200:
          description: ''
          content:
            application/json:
              schema:
                oneOf:
                  -
                    description: 'Success - Current month totals'
                    type: object
                    example:
                      status: success
                      message: 'Received documents accumulated totals retrieved successfully'
                      data:
                        totals:
                          subtotal_vat_fifteen_sum: 75.29
                          discount_vat_fifteen_sum: 0
                          vat_fifteen_sum: 11.28
                          subtotal_vat_fourteen_sum: 0
                          discount_vat_fourteen_sum: 0
                          vat_fourteen_sum: 0
                          subtotal_vat_thirteen_sum: 0
                          discount_vat_thirteen_sum: 0
                          vat_thirteen_sum: 0
                          subtotal_vat_twelve_sum: 0
                          discount_vat_twelve_sum: 0
                          vat_twelve_sum: 0
                          subtotal_vat_five_sum: 0
                          discount_vat_five_sum: 0
                          vat_five_sum: 0
                          subtotal_vat_special_sum: 0
                          discount_vat_special_sum: 0
                          vat_special_sum: 0
                          subtotal_vat_zero_sum: 0
                          discount_vat_zero_sum: 0
                          subtotal_vat_exempt_sum: 0
                          discount_vat_exempt_sum: 0
                          subtotal_vat_not_subject_sum: 0
                          discount_vat_not_subject_sum: 0
                          sub_total_sum: 75.29
                          tip_sum: 0
                          subsidy_sum: 0
                          discount_sum: 0
                          total_sum: 86.57
                          subtotal_header: 75.29
                          taxes_header: 11.28
                          subtotal_taxes_header: 86.57
                          total_header: 86.57
                          document_count: 3
                          categorized_document_count: 3
                          uncategorized_document_count: 0
                          voided_document_count: 0
                      meta:
                        filters_applied:
                          date_range:
                            start_date: '2024-12-01'
                            end_date: '2024-12-31'
                    properties:
                      status:
                        type: string
                        example: success
                      message:
                        type: string
                        example: 'Received documents accumulated totals retrieved successfully'
                      data:
                        type: object
                        properties:
                          totals:
                            type: object
                            properties:
                              subtotal_vat_fifteen_sum:
                                type: number
                                example: 75.29
                              discount_vat_fifteen_sum:
                                type: integer
                                example: 0
                              vat_fifteen_sum:
                                type: number
                                example: 11.28
                              subtotal_vat_fourteen_sum:
                                type: integer
                                example: 0
                              discount_vat_fourteen_sum:
                                type: integer
                                example: 0
                              vat_fourteen_sum:
                                type: integer
                                example: 0
                              subtotal_vat_thirteen_sum:
                                type: integer
                                example: 0
                              discount_vat_thirteen_sum:
                                type: integer
                                example: 0
                              vat_thirteen_sum:
                                type: integer
                                example: 0
                              subtotal_vat_twelve_sum:
                                type: integer
                                example: 0
                              discount_vat_twelve_sum:
                                type: integer
                                example: 0
                              vat_twelve_sum:
                                type: integer
                                example: 0
                              subtotal_vat_five_sum:
                                type: integer
                                example: 0
                              discount_vat_five_sum:
                                type: integer
                                example: 0
                              vat_five_sum:
                                type: integer
                                example: 0
                              subtotal_vat_special_sum:
                                type: integer
                                example: 0
                              discount_vat_special_sum:
                                type: integer
                                example: 0
                              vat_special_sum:
                                type: integer
                                example: 0
                              subtotal_vat_zero_sum:
                                type: integer
                                example: 0
                              discount_vat_zero_sum:
                                type: integer
                                example: 0
                              subtotal_vat_exempt_sum:
                                type: integer
                                example: 0
                              discount_vat_exempt_sum:
                                type: integer
                                example: 0
                              subtotal_vat_not_subject_sum:
                                type: integer
                                example: 0
                              discount_vat_not_subject_sum:
                                type: integer
                                example: 0
                              sub_total_sum:
                                type: number
                                example: 75.29
                              tip_sum:
                                type: integer
                                example: 0
                              subsidy_sum:
                                type: integer
                                example: 0
                              discount_sum:
                                type: integer
                                example: 0
                              total_sum:
                                type: number
                                example: 86.57
                              subtotal_header:
                                type: number
                                example: 75.29
                              taxes_header:
                                type: number
                                example: 11.28
                              subtotal_taxes_header:
                                type: number
                                example: 86.57
                              total_header:
                                type: number
                                example: 86.57
                              document_count:
                                type: integer
                                example: 3
                              categorized_document_count:
                                type: integer
                                example: 3
                              uncategorized_document_count:
                                type: integer
                                example: 0
                              voided_document_count:
                                type: integer
                                example: 0
                      meta:
                        type: object
                        properties:
                          filters_applied:
                            type: object
                            properties:
                              date_range:
                                type: object
                                properties:
                                  start_date:
                                    type: string
                                    example: '2024-12-01'
                                  end_date:
                                    type: string
                                    example: '2024-12-31'
                  -
                    description: 'Success - Filtered by category type'
                    type: object
                    example:
                      status: success
                      message: 'Received documents accumulated totals retrieved successfully'
                      data:
                        totals:
                          subtotal_vat_fifteen_sum: 50.0
                          vat_fifteen_sum: 7.5
                          subtotal_vat_zero_sum: 25.0
                          sub_total_sum: 75.0
                          total_sum: 82.5
                          subtotal_header: 75.0
                          taxes_header: 7.5
                          total_header: 82.5
                          document_count: 5
                          categorized_document_count: 5
                          uncategorized_document_count: 0
                          voided_document_count: 0
                      meta:
                        filters_applied:
                          date_range:
                            start_date: '2024-01-01'
                            end_date: '2024-01-31'
                          category_type: commercial_expenses
                          deductible_type: deductible
                    properties:
                      status:
                        type: string
                        example: success
                      message:
                        type: string
                        example: 'Received documents accumulated totals retrieved successfully'
                      data:
                        type: object
                        properties:
                          totals:
                            type: object
                            properties:
                              subtotal_vat_fifteen_sum:
                                type: number
                                example: 50.0
                              vat_fifteen_sum:
                                type: number
                                example: 7.5
                              subtotal_vat_zero_sum:
                                type: number
                                example: 25.0
                              sub_total_sum:
                                type: number
                                example: 75.0
                              total_sum:
                                type: number
                                example: 82.5
                              subtotal_header:
                                type: number
                                example: 75.0
                              taxes_header:
                                type: number
                                example: 7.5
                              total_header:
                                type: number
                                example: 82.5
                              document_count:
                                type: integer
                                example: 5
                              categorized_document_count:
                                type: integer
                                example: 5
                              uncategorized_document_count:
                                type: integer
                                example: 0
                              voided_document_count:
                                type: integer
                                example: 0
                      meta:
                        type: object
                        properties:
                          filters_applied:
                            type: object
                            properties:
                              date_range:
                                type: object
                                properties:
                                  start_date:
                                    type: string
                                    example: '2024-01-01'
                                  end_date:
                                    type: string
                                    example: '2024-01-31'
                              category_type:
                                type: string
                                example: commercial_expenses
                              deductible_type:
                                type: string
                                example: deductible
        401:
          description: 'Unauthorized - Invalid API Key'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Invalid API key'
                  code: INVALID_API_KEY
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Invalid API key'
                  code:
                    type: string
                    example: INVALID_API_KEY
        403:
          description: 'Forbidden - Taxpayer not accessible'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'You do not have access to this taxpayer'
                  code: TAXPAYER_ACCESS_DENIED
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'You do not have access to this taxpayer'
                  code:
                    type: string
                    example: TAXPAYER_ACCESS_DENIED
        404:
          description: 'Not Found - Taxpayer does not exist'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Taxpayer not found'
                  code: TAXPAYER_NOT_FOUND
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Taxpayer not found'
                  code:
                    type: string
                    example: TAXPAYER_NOT_FOUND
        422:
          description: 'Validation Error'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Validation failed'
                  code: VALIDATION_ERROR
                  errors:
                    start_date:
                      - 'The start date field must be a valid date in YYYY-MM-DD format.'
                    category_type:
                      - 'Invalid category type. Must be one of: commercial_expenses, personal_expenses, non_deductible_expenses.'
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Validation failed'
                  code:
                    type: string
                    example: VALIDATION_ERROR
                  errors:
                    type: object
                    properties:
                      start_date:
                        type: array
                        example:
                          - 'The start date field must be a valid date in YYYY-MM-DD format.'
                        items:
                          type: string
                      category_type:
                        type: array
                        example:
                          - 'Invalid category type. Must be one of: commercial_expenses, personal_expenses, non_deductible_expenses.'
                        items:
                          type: string
        500:
          description: 'Server Error'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'An error occurred while retrieving accumulated totals'
                  code: SERVER_ERROR
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'An error occurred while retrieving accumulated totals'
                  code:
                    type: string
                    example: SERVER_ERROR
      tags:
        - 'Received Documents'
    parameters:
      -
        in: path
        name: taxNumber
        description: "The taxpayer's RUC number (13 digits)."
        example: '1726051285001'
        required: true
        schema:
          type: string
  '/api/v1/taxpayers/{taxNumber}/received/count':
    get:
      summary: 'Get count of all received documents types'
      operationId: getCountOfAllReceivedDocumentsTypes
      description: "Retrieves document counts across all received document types (purchases, credit notes, withholdings)\nfor a specific taxpayer and time period.\n\nThis endpoint aggregates data from three tables:\n- **bills**: Purchase invoices (Facturas de Compra)\n- **purchase_credit_notes**: Credit notes applied to purchases (Notas de Crédito)\n- **purchase_withholdings**: Withholding documents (Retenciones)\n\n**IMPORTANT:** This is a GET request. All parameters must be sent as query string parameters in the URL.\nDo NOT send a request body.\n\n**Default Behavior:**\n- If no date range is specified, returns counts for the current month\n- Only counts documents that belong to the authenticated taxpayer and team\n\n**Use Cases:**\n- Dashboard statistics showing total documents received\n- Monthly/period document volume analysis\n- Document type distribution reports\n- Compliance verification (ensuring all document types are being processed)\n\n**Example URLs:**\n\nGet counts for current month:\n```\nGET /api/v1/taxpayers/1726051285001/received/count\n```\n\nGet counts for specific period:\n```\nGET /api/v1/taxpayers/1726051285001/received/count?start_date=2024-01-01&end_date=2024-01-31\n```\n\nGet counts for entire year:\n```\nGET /api/v1/taxpayers/1726051285001/received/count?start_date=2024-01-01&end_date=2024-12-31\n```"
      parameters:
        -
          in: query
          name: start_date
          description: 'Start date for counting (YYYY-MM-DD). Defaults to first day of current month.'
          example: null
          required: false
          schema:
            type: string
            description: 'Start date for counting (YYYY-MM-DD). Defaults to first day of current month.'
            example: null
        -
          in: query
          name: end_date
          description: 'End date for counting (YYYY-MM-DD). Defaults to last day of current month.'
          example: null
          required: false
          schema:
            type: string
            description: 'End date for counting (YYYY-MM-DD). Defaults to last day of current month.'
            example: null
        -
          in: header
          name: x-api-key
          description: ''
          example: YOUR_API_KEY_HERE
          schema:
            type: string
        -
          in: header
          name: x-organization-id
          description: ''
          example: '{YOUR_ORGANIZATION_ID}'
          schema:
            type: string
      responses:
        200:
          description: ''
          content:
            application/json:
              schema:
                oneOf:
                  -
                    description: 'Success - Current month'
                    type: object
                    example:
                      status: success
                      message: 'Received documents count retrieved successfully'
                      data:
                        counts:
                          invoices: 45
                          credit_notes: 3
                          withholdings: 12
                          total: 60
                        period:
                          start_date: '2024-12-01'
                          end_date: '2024-12-31'
                    properties:
                      status:
                        type: string
                        example: success
                      message:
                        type: string
                        example: 'Received documents count retrieved successfully'
                      data:
                        type: object
                        properties:
                          counts:
                            type: object
                            properties:
                              invoices:
                                type: integer
                                example: 45
                              credit_notes:
                                type: integer
                                example: 3
                              withholdings:
                                type: integer
                                example: 12
                              total:
                                type: integer
                                example: 60
                          period:
                            type: object
                            properties:
                              start_date:
                                type: string
                                example: '2024-12-01'
                              end_date:
                                type: string
                                example: '2024-12-31'
                  -
                    description: 'Success - Custom period'
                    type: object
                    example:
                      status: success
                      message: 'Received documents count retrieved successfully'
                      data:
                        counts:
                          invoices: 150
                          credit_notes: 8
                          withholdings: 45
                          total: 203
                        period:
                          start_date: '2024-01-01'
                          end_date: '2024-03-31'
                    properties:
                      status:
                        type: string
                        example: success
                      message:
                        type: string
                        example: 'Received documents count retrieved successfully'
                      data:
                        type: object
                        properties:
                          counts:
                            type: object
                            properties:
                              invoices:
                                type: integer
                                example: 150
                              credit_notes:
                                type: integer
                                example: 8
                              withholdings:
                                type: integer
                                example: 45
                              total:
                                type: integer
                                example: 203
                          period:
                            type: object
                            properties:
                              start_date:
                                type: string
                                example: '2024-01-01'
                              end_date:
                                type: string
                                example: '2024-03-31'
                  -
                    description: 'Success - No documents'
                    type: object
                    example:
                      status: success
                      message: 'Received documents count retrieved successfully'
                      data:
                        counts:
                          invoices: 0
                          credit_notes: 0
                          withholdings: 0
                          total: 0
                        period:
                          start_date: '2024-12-01'
                          end_date: '2024-12-31'
                    properties:
                      status:
                        type: string
                        example: success
                      message:
                        type: string
                        example: 'Received documents count retrieved successfully'
                      data:
                        type: object
                        properties:
                          counts:
                            type: object
                            properties:
                              invoices:
                                type: integer
                                example: 0
                              credit_notes:
                                type: integer
                                example: 0
                              withholdings:
                                type: integer
                                example: 0
                              total:
                                type: integer
                                example: 0
                          period:
                            type: object
                            properties:
                              start_date:
                                type: string
                                example: '2024-12-01'
                              end_date:
                                type: string
                                example: '2024-12-31'
        401:
          description: 'Unauthorized - Invalid API Key'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Invalid API key'
                  code: INVALID_API_KEY
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Invalid API key'
                  code:
                    type: string
                    example: INVALID_API_KEY
        403:
          description: 'Forbidden - Taxpayer not accessible'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'You do not have access to this taxpayer'
                  code: TAXPAYER_ACCESS_DENIED
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'You do not have access to this taxpayer'
                  code:
                    type: string
                    example: TAXPAYER_ACCESS_DENIED
        404:
          description: 'Not Found - Taxpayer does not exist'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Taxpayer not found'
                  code: TAXPAYER_NOT_FOUND
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Taxpayer not found'
                  code:
                    type: string
                    example: TAXPAYER_NOT_FOUND
        422:
          description: 'Validation Error'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Validation failed'
                  code: VALIDATION_ERROR
                  errors:
                    start_date:
                      - 'The start date field must be a valid date in YYYY-MM-DD format.'
                    end_date:
                      - 'The end date must be equal to or after the start date.'
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Validation failed'
                  code:
                    type: string
                    example: VALIDATION_ERROR
                  errors:
                    type: object
                    properties:
                      start_date:
                        type: array
                        example:
                          - 'The start date field must be a valid date in YYYY-MM-DD format.'
                        items:
                          type: string
                      end_date:
                        type: array
                        example:
                          - 'The end date must be equal to or after the start date.'
                        items:
                          type: string
        500:
          description: 'Server Error'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'An error occurred while retrieving document counts'
                  code: SERVER_ERROR
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'An error occurred while retrieving document counts'
                  code:
                    type: string
                    example: SERVER_ERROR
      tags:
        - 'Received Documents'
    parameters:
      -
        in: path
        name: taxNumber
        description: "The taxpayer's RUC number (13 digits)."
        example: '1726051285001'
        required: true
        schema:
          type: string
  '/api/v1/taxpayers/{taxNumber}/received/retentions/accumulated':
    get:
      summary: 'Get accumulated retention totals'
      operationId: getAccumulatedRetentionTotals
      description: "Retrieves aggregated totals of withholding retentions for a specific taxpayer and team\nwithin a date range. Returns amounts withheld for VAT, Income Tax (Rent), and Special Taxes (IGT/ISD),\nalong with their tax bases and document counts.\n\nThis endpoint is optimized for displaying retention statistics and dashboards.\nIt uses direct database aggregation for efficient calculation of totals even with large datasets.\n\n**Default Period:** If no dates are specified, the current month is used.\n\n**Important Notes:**\n- Only active (non-voided) retentions are included in the monetary totals\n- Voided retentions are counted separately but not included in amounts\n- All amounts are in USD"
      parameters:
        -
          in: query
          name: start_date
          description: 'optional Start date for filtering retentions (YYYY-MM-DD format). Defaults to first day of current month.'
          example: '2024-01-01'
          required: false
          schema:
            type: string
            description: 'optional Start date for filtering retentions (YYYY-MM-DD format). Defaults to first day of current month.'
            example: '2024-01-01'
        -
          in: query
          name: end_date
          description: 'optional End date for filtering retentions (YYYY-MM-DD format). Defaults to last day of current month.'
          example: '2024-01-31'
          required: false
          schema:
            type: string
            description: 'optional End date for filtering retentions (YYYY-MM-DD format). Defaults to last day of current month.'
            example: '2024-01-31'
        -
          in: header
          name: x-api-key
          description: ''
          example: YOUR_API_KEY_HERE
          schema:
            type: string
        -
          in: header
          name: x-organization-id
          description: ''
          example: '{YOUR_ORGANIZATION_ID}'
          schema:
            type: string
      responses:
        200:
          description: ''
          content:
            application/json:
              schema:
                type: object
                example:
                  status: success
                  message: 'Retention totals retrieved successfully'
                  data:
                    totals:
                      vat_withheld: 450.75
                      rent_withheld: 1250.0
                      igt_withheld: 0.0
                      total_withheld: 1700.75
                      tax_bases:
                        vat: 15025.0
                        rent: 12500.0
                        igt: 0.0
                        total: 27525.0
                    counts:
                      total_retentions: 45
                      active_retentions: 43
                      voided_retentions: 2
                    period:
                      start_date: '2024-01-01'
                      end_date: '2024-01-31'
                  meta:
                    timestamp: '2024-01-15T14:30:00Z'
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: 'Retention totals retrieved successfully'
                  data:
                    type: object
                    properties:
                      totals:
                        type: object
                        properties:
                          vat_withheld:
                            type: number
                            example: 450.75
                          rent_withheld:
                            type: number
                            example: 1250.0
                          igt_withheld:
                            type: number
                            example: 0.0
                          total_withheld:
                            type: number
                            example: 1700.75
                          tax_bases:
                            type: object
                            properties:
                              vat:
                                type: number
                                example: 15025.0
                              rent:
                                type: number
                                example: 12500.0
                              igt:
                                type: number
                                example: 0.0
                              total:
                                type: number
                                example: 27525.0
                      counts:
                        type: object
                        properties:
                          total_retentions:
                            type: integer
                            example: 45
                          active_retentions:
                            type: integer
                            example: 43
                          voided_retentions:
                            type: integer
                            example: 2
                      period:
                        type: object
                        properties:
                          start_date:
                            type: string
                            example: '2024-01-01'
                          end_date:
                            type: string
                            example: '2024-01-31'
                  meta:
                    type: object
                    properties:
                      timestamp:
                        type: string
                        example: '2024-01-15T14:30:00Z'
        401:
          description: ''
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: Unauthorized
                  data: null
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: Unauthorized
                  data:
                    type: string
                    example: null
        404:
          description: ''
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Taxpayer not found'
                  data: null
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Taxpayer not found'
                  data:
                    type: string
                    example: null
        500:
          description: ''
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'An error occurred while retrieving retention totals'
                  data: null
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'An error occurred while retrieving retention totals'
                  data:
                    type: string
                    example: null
      tags:
        - 'Received Documents'
    parameters:
      -
        in: path
        name: taxNumber
        description: "The taxpayer's tax identification number (RUC - 13 digits)."
        example: '1726051285001'
        required: true
        schema:
          type: string
  '/api/v1/taxpayers/{taxNumber}/received/suppliers/{contactTaxNumber}/totals':
    get:
      summary: 'Get accumulated totals for a specific supplier (Provider)'
      operationId: getAccumulatedTotalsForASpecificSupplierProvider
      description: "Retrieves aggregated totals and statistics for received documents from a specific supplier (provider).\nThis endpoint filters all documents by the supplier's tax number and applies additional filters.\n\n**IMPORTANT:** This is a GET request. All parameters must be sent as query string parameters in the URL.\nDo NOT send a request body.\n\n**What This Endpoint Returns:**\n\n- **Subtotals by VAT rate**: Detailed breakdown of subtotals for each VAT rate\n- **VAT amounts**: Total VAT collected at each rate\n- **Discounts**: Discounts applied at each VAT rate\n- **Header totals**: Simplified totals (subtotal, taxes, total)\n- **Document counts**: Total documents, categorized, uncategorized, voided\n- **Applied filters**: Summary of which filters were used (including supplier filter)\n\n**Use Cases:**\n\n- Analyze spending with a specific supplier\n- Supplier performance reports\n- Validate supplier invoices and totals\n- Tax deduction analysis per supplier\n- Supplier comparison reports\n\n**Example URLs:**\n\nGet totals for specific supplier (current month):\n```\nGET /api/v1/taxpayers/1726051285001/received/suppliers/1790000000001/totals\n```\n\nGet totals for specific supplier and date range:\n```\nGET /api/v1/taxpayers/1726051285001/received/suppliers/1790000000001/totals?start_date=2024-01-01&end_date=2024-12-31\n```\n\nGet commercial expenses totals from specific supplier:\n```\nGET /api/v1/taxpayers/1726051285001/received/suppliers/1790000000001/totals?category_type=commercial_expenses&deductible_type=deductible\n```\n\n**Filters:**\n\nThis endpoint accepts the **same filters** as `/received/accumulated`:\n- `start_date`, `end_date`: Date range (defaults to current month)\n- `category_id[]`: Specific category IDs (array)\n- `category_type`: Expense type (commercial_expenses, personal_expenses, non_deductible_expenses)\n- `deductible_type`: Tax deductibility (deductible, non_deductible)\n- `status`: Document status (AUTORIZADO, ANULADO)\n- `search`: Search in document details\n- `uncategorized`: Only uncategorized documents (true/false)\n- `origin`: Document origin (electronic, physical)\n\n**Plus:** Automatically filters by `contact_tax_number` from URL parameter"
      parameters:
        -
          in: query
          name: start_date
          description: 'Start date for filtering (YYYY-MM-DD). Defaults to first day of current month.'
          example: null
          required: false
          schema:
            type: string
            description: 'Start date for filtering (YYYY-MM-DD). Defaults to first day of current month.'
            example: null
        -
          in: query
          name: end_date
          description: 'End date for filtering (YYYY-MM-DD). Defaults to last day of current month.'
          example: null
          required: false
          schema:
            type: string
            description: 'End date for filtering (YYYY-MM-DD). Defaults to last day of current month.'
            example: null
        -
          in: query
          name: 'category_id[]'
          description: 'Filter by category ID(s). Can pass multiple values. To obtain available category IDs, use GET /api/v1/taxpayers/{taxNumber}/categories.'
          example: null
          required: false
          schema:
            type: integer
            description: 'Filter by category ID(s). Can pass multiple values. To obtain available category IDs, use GET /api/v1/taxpayers/{taxNumber}/categories.'
            example: null
        -
          in: query
          name: category_type
          description: 'Filter by expense type. Must be one of: commercial_expenses, personal_expenses, non_deductible_expenses.'
          example: null
          required: false
          schema:
            type: string
            description: 'Filter by expense type. Must be one of: commercial_expenses, personal_expenses, non_deductible_expenses.'
            example: null
        -
          in: query
          name: deductible_type
          description: 'Filter by tax deductibility. Must be one of: deductible, non_deductible.'
          example: null
          required: false
          schema:
            type: string
            description: 'Filter by tax deductibility. Must be one of: deductible, non_deductible.'
            example: null
        -
          in: query
          name: status
          description: 'Filter by document status. Must be one of: AUTORIZADO, ANULADO.'
          example: null
          required: false
          schema:
            type: string
            description: 'Filter by document status. Must be one of: AUTORIZADO, ANULADO.'
            example: null
        -
          in: query
          name: search
          description: 'Search in provider name, document number, access key, etc.'
          example: null
          required: false
          schema:
            type: string
            description: 'Search in provider name, document number, access key, etc.'
            example: null
        -
          in: query
          name: uncategorized
          description: 'Filter only uncategorized documents. Accepts: true/false, 1/0, yes/no, on/off.'
          example: null
          required: false
          schema:
            type: boolean
            description: 'Filter only uncategorized documents. Accepts: true/false, 1/0, yes/no, on/off.'
            example: null
        -
          in: query
          name: origin
          description: 'Filter by document origin/source system. Must be one of: tws, xml-import, physical-upload.'
          example: null
          required: false
          schema:
            type: string
            description: 'Filter by document origin/source system. Must be one of: tws, xml-import, physical-upload.'
            example: null
        -
          in: header
          name: x-api-key
          description: ''
          example: YOUR_API_KEY_HERE
          schema:
            type: string
        -
          in: header
          name: x-organization-id
          description: ''
          example: '{YOUR_ORGANIZATION_ID}'
          schema:
            type: string
      responses:
        200:
          description: ''
          content:
            application/json:
              schema:
                oneOf:
                  -
                    description: 'Success - Supplier totals'
                    type: object
                    example:
                      status: success
                      message: 'Supplier totals retrieved successfully'
                      data:
                        totals:
                          subtotal_vat_fifteen_sum: 1250.5
                          vat_fifteen_sum: 187.58
                          sub_total_sum: 1250.5
                          total_sum: 1438.08
                          subtotal_header: 1250.5
                          taxes_header: 187.58
                          total_header: 1438.08
                          document_count: 12
                          categorized_document_count: 12
                          uncategorized_document_count: 0
                          voided_document_count: 0
                      meta:
                        filters_applied:
                          date_range:
                            start_date: '2024-12-01'
                            end_date: '2024-12-31'
                          supplier:
                            contact_tax_number: '1790000000001'
                    properties:
                      status:
                        type: string
                        example: success
                      message:
                        type: string
                        example: 'Supplier totals retrieved successfully'
                      data:
                        type: object
                        properties:
                          totals:
                            type: object
                            properties:
                              subtotal_vat_fifteen_sum:
                                type: number
                                example: 1250.5
                              vat_fifteen_sum:
                                type: number
                                example: 187.58
                              sub_total_sum:
                                type: number
                                example: 1250.5
                              total_sum:
                                type: number
                                example: 1438.08
                              subtotal_header:
                                type: number
                                example: 1250.5
                              taxes_header:
                                type: number
                                example: 187.58
                              total_header:
                                type: number
                                example: 1438.08
                              document_count:
                                type: integer
                                example: 12
                              categorized_document_count:
                                type: integer
                                example: 12
                              uncategorized_document_count:
                                type: integer
                                example: 0
                              voided_document_count:
                                type: integer
                                example: 0
                      meta:
                        type: object
                        properties:
                          filters_applied:
                            type: object
                            properties:
                              date_range:
                                type: object
                                properties:
                                  start_date:
                                    type: string
                                    example: '2024-12-01'
                                  end_date:
                                    type: string
                                    example: '2024-12-31'
                              supplier:
                                type: object
                                properties:
                                  contact_tax_number:
                                    type: string
                                    example: '1790000000001'
                  -
                    description: 'Success - No documents from supplier'
                    type: object
                    example:
                      status: success
                      message: 'Supplier totals retrieved successfully'
                      data:
                        totals:
                          subtotal_header: 0.0
                          taxes_header: 0.0
                          total_header: 0.0
                          document_count: 0
                          categorized_document_count: 0
                          uncategorized_document_count: 0
                          voided_document_count: 0
                      meta:
                        filters_applied:
                          date_range:
                            start_date: '2024-12-01'
                            end_date: '2024-12-31'
                          supplier:
                            contact_tax_number: '1790000000001'
                    properties:
                      status:
                        type: string
                        example: success
                      message:
                        type: string
                        example: 'Supplier totals retrieved successfully'
                      data:
                        type: object
                        properties:
                          totals:
                            type: object
                            properties:
                              subtotal_header:
                                type: number
                                example: 0.0
                              taxes_header:
                                type: number
                                example: 0.0
                              total_header:
                                type: number
                                example: 0.0
                              document_count:
                                type: integer
                                example: 0
                              categorized_document_count:
                                type: integer
                                example: 0
                              uncategorized_document_count:
                                type: integer
                                example: 0
                              voided_document_count:
                                type: integer
                                example: 0
                      meta:
                        type: object
                        properties:
                          filters_applied:
                            type: object
                            properties:
                              date_range:
                                type: object
                                properties:
                                  start_date:
                                    type: string
                                    example: '2024-12-01'
                                  end_date:
                                    type: string
                                    example: '2024-12-31'
                              supplier:
                                type: object
                                properties:
                                  contact_tax_number:
                                    type: string
                                    example: '1790000000001'
        401:
          description: 'Unauthorized - Invalid API Key'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Invalid API key'
                  code: INVALID_API_KEY
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Invalid API key'
                  code:
                    type: string
                    example: INVALID_API_KEY
        403:
          description: 'Forbidden - Taxpayer not accessible'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'You do not have access to this taxpayer'
                  code: TAXPAYER_ACCESS_DENIED
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'You do not have access to this taxpayer'
                  code:
                    type: string
                    example: TAXPAYER_ACCESS_DENIED
        404:
          description: 'Not Found - Taxpayer does not exist'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Taxpayer not found'
                  code: TAXPAYER_NOT_FOUND
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Taxpayer not found'
                  code:
                    type: string
                    example: TAXPAYER_NOT_FOUND
        422:
          description: 'Validation Error'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Validation failed'
                  code: VALIDATION_ERROR
                  errors:
                    start_date:
                      - 'The start date field must be a valid date in YYYY-MM-DD format.'
                    category_type:
                      - 'Invalid category type.'
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Validation failed'
                  code:
                    type: string
                    example: VALIDATION_ERROR
                  errors:
                    type: object
                    properties:
                      start_date:
                        type: array
                        example:
                          - 'The start date field must be a valid date in YYYY-MM-DD format.'
                        items:
                          type: string
                      category_type:
                        type: array
                        example:
                          - 'Invalid category type.'
                        items:
                          type: string
        500:
          description: 'Server Error'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'An error occurred while retrieving supplier totals'
                  code: SERVER_ERROR
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'An error occurred while retrieving supplier totals'
                  code:
                    type: string
                    example: SERVER_ERROR
      tags:
        - 'Received Documents'
    parameters:
      -
        in: path
        name: taxNumber
        description: "The taxpayer's RUC number (13 digits)."
        example: '1726051285001'
        required: true
        schema:
          type: string
      -
        in: path
        name: contactTaxNumber
        description: "The supplier's tax number (RUC/CI)."
        example: '1790000000001'
        required: true
        schema:
          type: string
  '/api/v1/taxpayers/{taxNumber}/received/export/excel':
    post:
      summary: 'Step 1: Start xls Export (Asynchronous)'
      operationId: step1StartXlsExportAsynchronous
      description: "**IMPORTANT: This is an asynchronous endpoint.** It starts a background export process and returns immediately.\nYou must use the returned `export_id` to poll the status endpoint until the file is ready.\n\n### Complete Workflow (3 Steps):\n\n**STEP 1: Start the export (this endpoint)**\n```bash\nPOST /api/v1/taxpayers/{taxNumber}/received/export/excel\n```\nYou will receive a response like:\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"export_id\": \"exp_67abc123_1734567890\",  ← SAVE THIS ID!\n    \"status\": \"pending\",\n    \"polling_url\": \"/api/v1/taxpayers/1726051285001/received/export/status/exp_67abc123_1734567890\"\n  }\n}\n```\n\n**STEP 2: Poll the status (repeatedly)**\nUse the `export_id` from Step 1 to check progress:\n```bash\nGET /api/v1/taxpayers/{taxNumber}/received/export/status/{export_id}\n```\nPoll every 10-30 seconds until `status` is `completed` or `failed`.\n\n**STEP 3: Download the file**\nWhen status is `completed`, the response will include a `download_url`:\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"export_id\": \"exp_67abc123_1734567890\",\n    \"status\": \"completed\",\n    \"progress\": 100,\n    \"download_url\": \"https://s3.amazonaws.com/...\"  ← USE THIS TO DOWNLOAD\n  }\n}\n```\nThe `download_url` is a temporary signed URL that expires in 1 hour.\n\n### Key Points:\n- ✅ This endpoint returns immediately (HTTP 202) - the export runs in background\n- ✅ Extract `data.export_id` from the response - you'll need it for polling\n- ✅ Use the provided `polling_url` or construct it manually with the `export_id`\n- ✅ Poll at any frequency (suggested: every 10 seconds for small exports, 30-60 seconds for large ones)\n- ✅ The download URL requires no additional authentication (it's signed)\n- ✅ If dates are not provided, defaults to current month"
      parameters:
        -
          in: header
          name: x-api-key
          description: ''
          example: 'required API key for authentication. Example: prod_YOUR_API_KEY_HERE'
          schema:
            type: string
        -
          in: header
          name: x-organization-id
          description: ''
          example: '{YOUR_ORGANIZATION_ID}'
          schema:
            type: string
      responses:
        202:
          description: 'Export started successfully - SAVE THE export_id!'
          content:
            application/json:
              schema:
                type: object
                example:
                  success: true
                  message: 'Export started. Use the export_id to check progress.'
                  data:
                    export_id: exp_67abc123_1734567890
                    status: pending
                    document_type: purchase
                    estimated_records: 1234
                    batch_size: 1000
                    estimated_time_seconds: 60
                    polling_url: /api/v1/taxpayers/1726051285001/received/export/status/exp_67abc123_1734567890
                    suggested_polling_interval_seconds: 10
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: 'Export started. Use the export_id to check progress.'
                  data:
                    type: object
                    properties:
                      export_id:
                        type: string
                        example: exp_67abc123_1734567890
                      status:
                        type: string
                        example: pending
                      document_type:
                        type: string
                        example: purchase
                      estimated_records:
                        type: integer
                        example: 1234
                      batch_size:
                        type: integer
                        example: 1000
                      estimated_time_seconds:
                        type: integer
                        example: 60
                      polling_url:
                        type: string
                        example: /api/v1/taxpayers/1726051285001/received/export/status/exp_67abc123_1734567890
                      suggested_polling_interval_seconds:
                        type: integer
                        example: 10
        400:
          description: 'Invalid data'
          content:
            application/json:
              schema:
                type: object
                example:
                  success: false
                  message: 'El tipo de documento es requerido.'
                  errors:
                    document_type:
                      - 'El tipo de documento es requerido.'
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: 'El tipo de documento es requerido.'
                  errors:
                    type: object
                    properties:
                      document_type:
                        type: array
                        example:
                          - 'El tipo de documento es requerido.'
                        items:
                          type: string
        404:
          description: 'Taxpayer not found'
          content:
            application/json:
              schema:
                type: object
                example:
                  success: false
                  message: 'Taxpayer not found or does not belong to your team.'
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: 'Taxpayer not found or does not belong to your team.'
        500:
          description: 'Server error'
          content:
            application/json:
              schema:
                type: object
                example:
                  success: false
                  message: 'Error al iniciar la exportación de documentos recibidos.'
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: 'Error al iniciar la exportación de documentos recibidos.'
      tags:
        - 'Received Documents'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                document_type:
                  type: string
                  description: 'Document type to export. Values: `purchase`, `credit_note`, `retention`.'
                  example: purchase
                start_date:
                  type: date
                  description: 'optional Start date (YYYY-MM-DD). Defaults to first day of current month if not specified.'
                  example: '2025-01-01'
                end_date:
                  type: date
                  description: 'optional End date (YYYY-MM-DD). Defaults to last day of current month if not specified.'
                  example: '2025-01-31'
                origin:
                  type: string
                  description: 'optional Filter by document origin. Values: `tws`, `xml-import`, `physical-upload`.'
                  example: tws
                supplier_tax_number:
                  type: string
                  description: "optional Filter by supplier's tax ID (RUC)."
                  example: '1790000000001'
                uncategorized:
                  type: boolean
                  description: 'optional Filter only uncategorized documents.'
                  example: false
              required:
                - document_type
    parameters:
      -
        in: path
        name: taxNumber
        description: 'Tax identification number (RUC/Cédula).'
        example: '1726051285001'
        required: true
        schema:
          type: string
  '/api/v1/taxpayers/{taxNumber}/received/export/status/{exportId}':
    get:
      summary: 'Step 2: Check xls Export Status (Polling)'
      operationId: step2CheckXlsExportStatusPolling
      description: "**Use this endpoint to check if your export is ready.** Poll this endpoint repeatedly\nusing the `export_id` you received from the start export endpoint until the status is `completed`.\n\n### How to Use This Endpoint:\n\n**1. Get the export_id**\nAfter calling `POST /api/v1/taxpayers/{taxNumber}/received/export/excel`, you'll receive:\n```json\n{\n  \"data\": {\n    \"export_id\": \"exp_67abc123_1734567890\",  ← USE THIS ID HERE\n    \"polling_url\": \"/api/v1/taxpayers/1726051285001/received/export/status/exp_67abc123_1734567890\"\n  }\n}\n```\n\n**2. Poll this endpoint**\n```bash\nGET /api/v1/taxpayers/{taxNumber}/received/export/status/exp_67abc123_1734567890\n                                                         └─ YOUR export_id goes here\n```\n\n**3. Check the status field**\n- `pending` → Keep polling (export is queued)\n- `processing` → Keep polling (export is being generated)\n- `completed` → **STOP POLLING** and extract `download_url` from response\n- `failed` → Stop polling (check `error_message`)\n\n**4. When completed, download the file**\n```json\n{\n  \"data\": {\n    \"status\": \"completed\",\n    \"download_url\": \"https://s3.amazonaws.com/...\"  ← DOWNLOAD FROM HERE\n  }\n}\n```\nSimply make a GET request to the `download_url` - no authentication needed (it's signed).\n\n### Polling Strategy:\n- **Small exports (< 1000 records)**: Poll every 10 seconds\n- **Medium exports (1000-10000 records)**: Poll every 20-30 seconds\n- **Large exports (> 10000 records)**: Poll every 30-60 seconds\n- You can poll at any frequency you want - the suggestion is just to avoid unnecessary requests\n- The export will be processed regardless of polling frequency\n\n### About the Download URL:\n- ✅ It's a temporary AWS S3 signed URL\n- ✅ Valid for 1 hour after export completion\n- ✅ No additional authentication required (signature is in the URL)\n- ✅ Direct download - just make a GET request to it\n- ⚠️ Download the file within 1 hour or it will expire\n\n### Progress Tracking:\nWhile the export is `processing`, you'll receive:\n- `progress`: Percentage completed (0-100)\n- `processed_records` / `total_records`: Exact counts\n- `estimated_time_remaining_seconds`: Rough estimate"
      parameters:
        -
          in: header
          name: x-api-key
          description: ''
          example: 'required API key for authentication. Example: prod_YOUR_API_KEY_HERE'
          schema:
            type: string
        -
          in: header
          name: x-organization-id
          description: ''
          example: '{YOUR_ORGANIZATION_ID}'
          schema:
            type: string
      responses:
        200:
          description: ''
          content:
            application/json:
              schema:
                oneOf:
                  -
                    description: 'Status: pending (keep polling)'
                    type: object
                    example:
                      success: true
                      data:
                        export_id: exp_67abc123_1734567890
                        status: pending
                        progress: 0
                        total_records: 1234
                        processed_records: 0
                        file_name: 'Compras - Periodo 2025-01-01_2025-01-31.xlsx'
                        download_url: null
                    properties:
                      success:
                        type: boolean
                        example: true
                      data:
                        type: object
                        properties:
                          export_id:
                            type: string
                            example: exp_67abc123_1734567890
                          status:
                            type: string
                            example: pending
                          progress:
                            type: integer
                            example: 0
                          total_records:
                            type: integer
                            example: 1234
                          processed_records:
                            type: integer
                            example: 0
                          file_name:
                            type: string
                            example: 'Compras - Periodo 2025-01-01_2025-01-31.xlsx'
                          download_url:
                            type: string
                            example: null
                  -
                    description: 'Status: processing (keep polling)'
                    type: object
                    example:
                      success: true
                      data:
                        export_id: exp_67abc123_1734567890
                        status: processing
                        progress: 45.5
                        total_records: 1234
                        processed_records: 562
                        current_batch: 3
                        file_name: 'Compras - Periodo 2025-01-01_2025-01-31.xlsx'
                        estimated_time_remaining_seconds: 30
                        download_url: null
                    properties:
                      success:
                        type: boolean
                        example: true
                      data:
                        type: object
                        properties:
                          export_id:
                            type: string
                            example: exp_67abc123_1734567890
                          status:
                            type: string
                            example: processing
                          progress:
                            type: number
                            example: 45.5
                          total_records:
                            type: integer
                            example: 1234
                          processed_records:
                            type: integer
                            example: 562
                          current_batch:
                            type: integer
                            example: 3
                          file_name:
                            type: string
                            example: 'Compras - Periodo 2025-01-01_2025-01-31.xlsx'
                          estimated_time_remaining_seconds:
                            type: integer
                            example: 30
                          download_url:
                            type: string
                            example: null
                  -
                    description: 'Status: completed (STOP POLLING - Download file from download_url)'
                    type: object
                    example:
                      success: true
                      data:
                        export_id: exp_67abc123_1734567890
                        status: completed
                        progress: 100
                        total_records: 1234
                        processed_records: 1234
                        file_name: 'Compras - Periodo 2025-01-01_2025-01-31.xlsx'
                        download_url: 'https://s3.amazonaws.com/taxo-exports/exp_67abc123_1734567890.xlsx?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=...'
                        download_expires_at: '2025-01-10T15:30:00Z'
                    properties:
                      success:
                        type: boolean
                        example: true
                      data:
                        type: object
                        properties:
                          export_id:
                            type: string
                            example: exp_67abc123_1734567890
                          status:
                            type: string
                            example: completed
                          progress:
                            type: integer
                            example: 100
                          total_records:
                            type: integer
                            example: 1234
                          processed_records:
                            type: integer
                            example: 1234
                          file_name:
                            type: string
                            example: 'Compras - Periodo 2025-01-01_2025-01-31.xlsx'
                          download_url:
                            type: string
                            example: 'https://s3.amazonaws.com/taxo-exports/exp_67abc123_1734567890.xlsx?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=...'
                          download_expires_at:
                            type: string
                            example: '2025-01-10T15:30:00Z'
                  -
                    description: 'Status: failed (stop polling)'
                    type: object
                    example:
                      success: true
                      data:
                        export_id: exp_67abc123_1734567890
                        status: failed
                        progress: 0
                        error_message: 'No se pudieron procesar los documentos.'
                        total_records: 0
                        processed_records: 0
                        download_url: null
                    properties:
                      success:
                        type: boolean
                        example: true
                      data:
                        type: object
                        properties:
                          export_id:
                            type: string
                            example: exp_67abc123_1734567890
                          status:
                            type: string
                            example: failed
                          progress:
                            type: integer
                            example: 0
                          error_message:
                            type: string
                            example: 'No se pudieron procesar los documentos.'
                          total_records:
                            type: integer
                            example: 0
                          processed_records:
                            type: integer
                            example: 0
                          download_url:
                            type: string
                            example: null
        404:
          description: 'Export not found (wrong export_id or expired)'
          content:
            application/json:
              schema:
                type: object
                example:
                  success: false
                  message: 'Export not found'
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: 'Export not found'
        500:
          description: 'Server error'
          content:
            application/json:
              schema:
                type: object
                example:
                  success: false
                  message: 'Error al obtener el estado de la exportación.'
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: 'Error al obtener el estado de la exportación.'
      tags:
        - 'Received Documents'
    parameters:
      -
        in: path
        name: taxNumber
        description: 'Tax identification number (RUC/Cédula).'
        example: '1726051285001'
        required: true
        schema:
          type: string
      -
        in: path
        name: exportId
        description: 'Export ID obtained from the start export endpoint (data.export_id).'
        example: exp_67abc123_1734567890
        required: true
        schema:
          type: string
  '/api/v1/taxpayers/{taxNumber}/received/{documentUlid}/details':
    get:
      summary: 'Get details of a specific received document'
      operationId: getDetailsOfASpecificReceivedDocument
      description: "Retrieves full details of a specific received document (purchase invoice, credit note, or withholding retention)\nby its unique ULID identifier. This endpoint returns comprehensive data including all related information\nsuch as items, issuer data, payment information, taxes, totals, and associated files.\n\n**This endpoint provides:**\n- Complete document header information (number, dates, status, access key)\n- All document line items with detailed categorization and tax information\n- Complete issuer/supplier data (name, tax number, email, phone, address)\n- Payment information (methods, amounts, terms)\n- Detailed tax breakdowns by type (IVA 0%, 12%, 15%, etc.)\n- Document totals and calculations\n- Associated files (PDF, XML) with signed URLs\n- For purchase bills: related credit notes\n- Document status and locking information\n- Categorization data and deductibility types\n- Metadata with taxpayer and team context\n\n**How to obtain the document ULID:**\n\nThe ULID can be obtained from:\n- `GET /api/v1/taxpayers/{taxNumber}/received` - Field `id` or `ulid` in each document\n- Any other endpoint that lists received documents\n\n**Document Types:**\n- `purchase` - Purchase invoice/bill (includes items, payments, taxes, totals, credit notes)\n- `credit_note` - Credit note for purchases (includes items, linked to supporting document)\n- `retention` - Withholding retention (includes withholding items and tax calculations)\n\n**Note:** This endpoint uses optimized API Resources that return only essential data,\nunlike UI endpoints which include full taxpayer and team objects."
      parameters:
        -
          in: header
          name: x-api-key
          description: ''
          example: YOUR_API_KEY_HERE
          schema:
            type: string
        -
          in: header
          name: x-organization-id
          description: ''
          example: '{YOUR_ORGANIZATION_ID}'
          schema:
            type: string
      responses:
        200:
          description: ''
          content:
            application/json:
              schema:
                oneOf:
                  -
                    description: 'Success - Purchase Invoice'
                    type: object
                    example:
                      status: success
                      message: 'Document details retrieved successfully'
                      data:
                        document_type: purchase
                        document:
                          id: 01HQXZ8P9G2K4MNBVCXWERTYU1
                          type: purchase
                          document_number: 001-001-000000123
                          status: AUTORIZADO
                          access_key: '1234567890123456789012345678901234567890123456789'
                          issue_date: '2024-01-15'
                          authorization_date: '2024-01-15 14:30:00'
                          categories:
                            - 'Servicios Básicos'
                          category_types:
                            - commercial_expenses
                          deductible_types:
                            - deductible
                          issuer:
                            name: 'PROVEEDOR DEMO S.A.'
                            email: proveedor@example.com
                            tax_number: '1790000000001'
                            phone: '0999999999'
                            address: 'Av. Principal 123'
                            forced_to_accounting: true
                          buyer:
                            id: '1726051285001'
                            id_type: ruc
                          payments:
                            -
                              method: '01'
                              amount: 112.0
                              term: '0'
                          items:
                            -
                              id: 1
                              description: 'Servicio de Internet'
                              sku: SRVINT001
                              quantity: 1
                              price: 100.0
                              discount: 0
                              sub_total: 100.0
                              tax: 12.0
                              tax_type: 'IVA 12%'
                              total: 112.0
                              category:
                                id: 5
                                name: 'Servicios Básicos'
                              deductible_type: deductible
                              category_message: null
                              categorized_by: user
                          taxes:
                            subtotal_vat_twelve: 100.0
                            vat_twelve: 12.0
                          totals:
                            subtotal: 100.0
                            total: 112.0
                          files:
                            pdf: 'https://s3.amazonaws.com/.../document.pdf'
                            xml: 'https://s3.amazonaws.com/.../document.xml'
                          credit_notes: []
                          notes: Observaciones
                          origin: tws
                          is_physical: false
                          is_checked: true
                          is_locked: false
                          created_at: '2024-01-15T14:30:00+00:00'
                        metadata:
                          taxpayer:
                            id: 123
                            ulid: 01HQXZ8P9G2K4MNBVCXWERTYU2
                            tax_number: '1726051285001'
                          team:
                            id: 456
                            ulid: 01HQXZ8P9G2K4MNBVCXWERTYU3
                            name: 'Mi Empresa S.A.'
                    properties:
                      status:
                        type: string
                        example: success
                      message:
                        type: string
                        example: 'Document details retrieved successfully'
                      data:
                        type: object
                        properties:
                          document_type:
                            type: string
                            example: purchase
                          document:
                            type: object
                            properties:
                              id:
                                type: string
                                example: 01HQXZ8P9G2K4MNBVCXWERTYU1
                              type:
                                type: string
                                example: purchase
                              document_number:
                                type: string
                                example: 001-001-000000123
                              status:
                                type: string
                                example: AUTORIZADO
                              access_key:
                                type: string
                                example: '1234567890123456789012345678901234567890123456789'
                              issue_date:
                                type: string
                                example: '2024-01-15'
                              authorization_date:
                                type: string
                                example: '2024-01-15 14:30:00'
                              categories:
                                type: array
                                example:
                                  - 'Servicios Básicos'
                                items:
                                  type: string
                              category_types:
                                type: array
                                example:
                                  - commercial_expenses
                                items:
                                  type: string
                              deductible_types:
                                type: array
                                example:
                                  - deductible
                                items:
                                  type: string
                              issuer:
                                type: object
                                properties:
                                  name:
                                    type: string
                                    example: 'PROVEEDOR DEMO S.A.'
                                  email:
                                    type: string
                                    example: proveedor@example.com
                                  tax_number:
                                    type: string
                                    example: '1790000000001'
                                  phone:
                                    type: string
                                    example: '0999999999'
                                  address:
                                    type: string
                                    example: 'Av. Principal 123'
                                  forced_to_accounting:
                                    type: boolean
                                    example: true
                              buyer:
                                type: object
                                properties:
                                  id:
                                    type: string
                                    example: '1726051285001'
                                  id_type:
                                    type: string
                                    example: ruc
                              payments:
                                type: array
                                example:
                                  -
                                    method: '01'
                                    amount: 112
                                    term: '0'
                                items:
                                  type: object
                                  properties:
                                    method:
                                      type: string
                                      example: '01'
                                    amount:
                                      type: number
                                      example: 112.0
                                    term:
                                      type: string
                                      example: '0'
                              items:
                                type: array
                                example:
                                  -
                                    id: 1
                                    description: 'Servicio de Internet'
                                    sku: SRVINT001
                                    quantity: 1
                                    price: 100
                                    discount: 0
                                    sub_total: 100
                                    tax: 12
                                    tax_type: 'IVA 12%'
                                    total: 112
                                    category:
                                      id: 5
                                      name: 'Servicios Básicos'
                                    deductible_type: deductible
                                    category_message: null
                                    categorized_by: user
                                items:
                                  type: object
                                  properties:
                                    id:
                                      type: integer
                                      example: 1
                                    description:
                                      type: string
                                      example: 'Servicio de Internet'
                                    sku:
                                      type: string
                                      example: SRVINT001
                                    quantity:
                                      type: integer
                                      example: 1
                                    price:
                                      type: number
                                      example: 100.0
                                    discount:
                                      type: integer
                                      example: 0
                                    sub_total:
                                      type: number
                                      example: 100.0
                                    tax:
                                      type: number
                                      example: 12.0
                                    tax_type:
                                      type: string
                                      example: 'IVA 12%'
                                    total:
                                      type: number
                                      example: 112.0
                                    category:
                                      type: object
                                      properties: { id: { type: integer, example: 5 }, name: { type: string, example: 'Servicios Básicos' } }
                                    deductible_type:
                                      type: string
                                      example: deductible
                                    category_message:
                                      type: string
                                      example: null
                                    categorized_by:
                                      type: string
                                      example: user
                              taxes:
                                type: object
                                properties:
                                  subtotal_vat_twelve:
                                    type: number
                                    example: 100.0
                                  vat_twelve:
                                    type: number
                                    example: 12.0
                              totals:
                                type: object
                                properties:
                                  subtotal:
                                    type: number
                                    example: 100.0
                                  total:
                                    type: number
                                    example: 112.0
                              files:
                                type: object
                                properties:
                                  pdf:
                                    type: string
                                    example: 'https://s3.amazonaws.com/.../document.pdf'
                                  xml:
                                    type: string
                                    example: 'https://s3.amazonaws.com/.../document.xml'
                              credit_notes:
                                type: array
                                example: []
                              notes:
                                type: string
                                example: Observaciones
                              origin:
                                type: string
                                example: tws
                              is_physical:
                                type: boolean
                                example: false
                              is_checked:
                                type: boolean
                                example: true
                              is_locked:
                                type: boolean
                                example: false
                              created_at:
                                type: string
                                example: '2024-01-15T14:30:00+00:00'
                          metadata:
                            type: object
                            properties:
                              taxpayer:
                                type: object
                                properties:
                                  id:
                                    type: integer
                                    example: 123
                                  ulid:
                                    type: string
                                    example: 01HQXZ8P9G2K4MNBVCXWERTYU2
                                  tax_number:
                                    type: string
                                    example: '1726051285001'
                              team:
                                type: object
                                properties:
                                  id:
                                    type: integer
                                    example: 456
                                  ulid:
                                    type: string
                                    example: 01HQXZ8P9G2K4MNBVCXWERTYU3
                                  name:
                                    type: string
                                    example: 'Mi Empresa S.A.'
                  -
                    description: 'Success - Credit Note'
                    type: object
                    example:
                      status: success
                      message: 'Document details retrieved successfully'
                      data:
                        document_type: credit_note
                        document:
                          id: 01HQXZ8P9G2K4MNBVCXWERTYU5
                          type: credit_note
                          document_number: 001-001-000000124
                          status: AUTORIZADO
                          issue_date: '2024-01-15'
                          supporting_document:
                            bill_number: 001-001-000000123
                            emission_date: '2024-01-15'
                          cause: 'Devolución de mercadería'
                          issuer:
                            name: 'PROVEEDOR DEMO S.A.'
                            tax_number: '1790000000001'
                          items:
                            -
                              id: 1
                              description: 'Producto devuelto'
                              quantity: 1
                              price: 50.0
                              tax: 6.0
                              total: 56.0
                              category:
                                id: 5
                                name: Inventario
                          totals:
                            subtotal: 50.0
                            total: 56.0
                        metadata:
                          taxpayer:
                            id: 123
                            ulid: 01HQXZ8P9G2K4MNBVCXWERTYU2
                            tax_number: '1726051285001'
                          team:
                            id: 456
                            ulid: 01HQXZ8P9G2K4MNBVCXWERTYU3
                            name: 'Mi Empresa S.A.'
                    properties:
                      status:
                        type: string
                        example: success
                      message:
                        type: string
                        example: 'Document details retrieved successfully'
                      data:
                        type: object
                        properties:
                          document_type:
                            type: string
                            example: credit_note
                          document:
                            type: object
                            properties:
                              id:
                                type: string
                                example: 01HQXZ8P9G2K4MNBVCXWERTYU5
                              type:
                                type: string
                                example: credit_note
                              document_number:
                                type: string
                                example: 001-001-000000124
                              status:
                                type: string
                                example: AUTORIZADO
                              issue_date:
                                type: string
                                example: '2024-01-15'
                              supporting_document:
                                type: object
                                properties:
                                  bill_number:
                                    type: string
                                    example: 001-001-000000123
                                  emission_date:
                                    type: string
                                    example: '2024-01-15'
                              cause:
                                type: string
                                example: 'Devolución de mercadería'
                              issuer:
                                type: object
                                properties:
                                  name:
                                    type: string
                                    example: 'PROVEEDOR DEMO S.A.'
                                  tax_number:
                                    type: string
                                    example: '1790000000001'
                              items:
                                type: array
                                example:
                                  -
                                    id: 1
                                    description: 'Producto devuelto'
                                    quantity: 1
                                    price: 50
                                    tax: 6
                                    total: 56
                                    category:
                                      id: 5
                                      name: Inventario
                                items:
                                  type: object
                                  properties:
                                    id:
                                      type: integer
                                      example: 1
                                    description:
                                      type: string
                                      example: 'Producto devuelto'
                                    quantity:
                                      type: integer
                                      example: 1
                                    price:
                                      type: number
                                      example: 50.0
                                    tax:
                                      type: number
                                      example: 6.0
                                    total:
                                      type: number
                                      example: 56.0
                                    category:
                                      type: object
                                      properties: { id: { type: integer, example: 5 }, name: { type: string, example: Inventario } }
                              totals:
                                type: object
                                properties:
                                  subtotal:
                                    type: number
                                    example: 50.0
                                  total:
                                    type: number
                                    example: 56.0
                          metadata:
                            type: object
                            properties:
                              taxpayer:
                                type: object
                                properties:
                                  id:
                                    type: integer
                                    example: 123
                                  ulid:
                                    type: string
                                    example: 01HQXZ8P9G2K4MNBVCXWERTYU2
                                  tax_number:
                                    type: string
                                    example: '1726051285001'
                              team:
                                type: object
                                properties:
                                  id:
                                    type: integer
                                    example: 456
                                  ulid:
                                    type: string
                                    example: 01HQXZ8P9G2K4MNBVCXWERTYU3
                                  name:
                                    type: string
                                    example: 'Mi Empresa S.A.'
                  -
                    description: 'Success - Withholding Retention'
                    type: object
                    example:
                      status: success
                      message: 'Document details retrieved successfully'
                      data:
                        document_type: retention
                        document:
                          id: 01HQXZ8P9G2K4MNBVCXWERTYU6
                          type: retention
                          document_number: 001-001-000000125
                          status: AUTORIZADO
                          fiscal_period: 01/2024
                          supporting_documents:
                            numbers: 001-001-000000123
                            dates: 15/01/2024
                          issuer:
                            name: 'PROVEEDOR DEMO S.A.'
                            tax_number: '1790000000001'
                          items:
                            -
                              id: 1
                              invoice_number: 001-001-000000123
                              tax_type: IVA
                              tax_base: 100.0
                              percentage: 30
                              amount: 30.0
                          taxes:
                            vat:
                              tax_base: 100.0
                              amount: 30.0
                              percentage: 30
                            rent:
                              tax_base: 0
                              amount: 0
                              percentage: 0
                            igt:
                              tax_base: 0
                              amount: 0
                              percentage: 0
                          files:
                            pdf: 'https://s3.amazonaws.com/.../retention.pdf'
                            xml: 'https://s3.amazonaws.com/.../retention.xml'
                        metadata:
                          taxpayer:
                            id: 123
                            ulid: 01HQXZ8P9G2K4MNBVCXWERTYU2
                            tax_number: '1726051285001'
                          team:
                            id: 456
                            ulid: 01HQXZ8P9G2K4MNBVCXWERTYU3
                            name: 'Mi Empresa S.A.'
                    properties:
                      status:
                        type: string
                        example: success
                      message:
                        type: string
                        example: 'Document details retrieved successfully'
                      data:
                        type: object
                        properties:
                          document_type:
                            type: string
                            example: retention
                          document:
                            type: object
                            properties:
                              id:
                                type: string
                                example: 01HQXZ8P9G2K4MNBVCXWERTYU6
                              type:
                                type: string
                                example: retention
                              document_number:
                                type: string
                                example: 001-001-000000125
                              status:
                                type: string
                                example: AUTORIZADO
                              fiscal_period:
                                type: string
                                example: 01/2024
                              supporting_documents:
                                type: object
                                properties:
                                  numbers:
                                    type: string
                                    example: 001-001-000000123
                                  dates:
                                    type: string
                                    example: 15/01/2024
                              issuer:
                                type: object
                                properties:
                                  name:
                                    type: string
                                    example: 'PROVEEDOR DEMO S.A.'
                                  tax_number:
                                    type: string
                                    example: '1790000000001'
                              items:
                                type: array
                                example:
                                  -
                                    id: 1
                                    invoice_number: 001-001-000000123
                                    tax_type: IVA
                                    tax_base: 100
                                    percentage: 30
                                    amount: 30
                                items:
                                  type: object
                                  properties:
                                    id:
                                      type: integer
                                      example: 1
                                    invoice_number:
                                      type: string
                                      example: 001-001-000000123
                                    tax_type:
                                      type: string
                                      example: IVA
                                    tax_base:
                                      type: number
                                      example: 100.0
                                    percentage:
                                      type: integer
                                      example: 30
                                    amount:
                                      type: number
                                      example: 30.0
                              taxes:
                                type: object
                                properties:
                                  vat:
                                    type: object
                                    properties:
                                      tax_base: { type: number, example: 100.0 }
                                      amount: { type: number, example: 30.0 }
                                      percentage: { type: integer, example: 30 }
                                  rent:
                                    type: object
                                    properties:
                                      tax_base: { type: integer, example: 0 }
                                      amount: { type: integer, example: 0 }
                                      percentage: { type: integer, example: 0 }
                                  igt:
                                    type: object
                                    properties:
                                      tax_base: { type: integer, example: 0 }
                                      amount: { type: integer, example: 0 }
                                      percentage: { type: integer, example: 0 }
                              files:
                                type: object
                                properties:
                                  pdf:
                                    type: string
                                    example: 'https://s3.amazonaws.com/.../retention.pdf'
                                  xml:
                                    type: string
                                    example: 'https://s3.amazonaws.com/.../retention.xml'
                          metadata:
                            type: object
                            properties:
                              taxpayer:
                                type: object
                                properties:
                                  id:
                                    type: integer
                                    example: 123
                                  ulid:
                                    type: string
                                    example: 01HQXZ8P9G2K4MNBVCXWERTYU2
                                  tax_number:
                                    type: string
                                    example: '1726051285001'
                              team:
                                type: object
                                properties:
                                  id:
                                    type: integer
                                    example: 456
                                  ulid:
                                    type: string
                                    example: 01HQXZ8P9G2K4MNBVCXWERTYU3
                                  name:
                                    type: string
                                    example: 'Mi Empresa S.A.'
        401:
          description: 'Unauthorized - Invalid API Key'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Invalid API key or organization ID'
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Invalid API key or organization ID'
        404:
          description: ''
          content:
            application/json:
              schema:
                oneOf:
                  -
                    description: 'Document Not Found'
                    type: object
                    example:
                      status: error
                      message: 'Document not found or does not belong to this taxpayer'
                    properties:
                      status:
                        type: string
                        example: error
                      message:
                        type: string
                        example: 'Document not found or does not belong to this taxpayer'
                  -
                    description: 'Taxpayer Not Found'
                    type: object
                    example:
                      status: error
                      message: 'Taxpayer not found'
                    properties:
                      status:
                        type: string
                        example: error
                      message:
                        type: string
                        example: 'Taxpayer not found'
        500:
          description: 'Server Error'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'An error occurred while retrieving document details'
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'An error occurred while retrieving document details'
      tags:
        - 'Received Documents'
    parameters:
      -
        in: path
        name: taxNumber
        description: "The taxpayer's RUC number (13 digits)."
        example: '1726051285001'
        required: true
        schema:
          type: string
      -
        in: path
        name: documentUlid
        description: 'The unique ULID identifier of the document.'
        example: 01HQXZ8P9G2K4MNBVCXWERTYU1
        required: true
        schema:
          type: string
  '/api/v1/taxpayers/{taxNumber}/received/{documentUlid}/status':
    get:
      summary: 'Get status of a specific received document'
      operationId: getStatusOfASpecificReceivedDocument
      description: "Retrieves the current status of a specific received document (purchase, credit note, or withholding retention)\nby its unique ULID identifier. The system will automatically search across all received document types\nand return the status along with the document type.\n\n**How to obtain the document ULID:**\n\nYou can get the document ULID from these endpoints:\n- `GET /api/v1/taxpayers/{taxNumber}/received` - Returns purchase invoices with their ULIDs\n- Any other endpoint that lists received documents\n\nThe ULID field is typically returned as `ulid` in the document listing responses.\n\n**Document Types:**\n- `purchase` - Purchase invoice (from bills table)\n- `credit_note` - Purchase credit note (from purchase_credit_notes table)\n- `retention` - Withholding retention (from purchase_withholdings table)\n\n**Status Values:**\n\nFor purchases, credit notes and retentions:\n- `AUTORIZADO` - Authorized document\n- `ANULADO` - Voided/Cancelled document\n- Other status values depending on the electronic document system"
      parameters:
        -
          in: header
          name: x-api-key
          description: ''
          example: YOUR_API_KEY_HERE
          schema:
            type: string
        -
          in: header
          name: x-organization-id
          description: ''
          example: '{YOUR_ORGANIZATION_ID}'
          schema:
            type: string
      responses:
        200:
          description: ''
          content:
            application/json:
              schema:
                oneOf:
                  -
                    description: 'Success - Purchase Document'
                    type: object
                    example:
                      status: success
                      message: 'Document status retrieved successfully'
                      data:
                        document_id: 01HQXZ8P9G2K4MNBVCXWERTYU1
                        document_type: purchase
                        status: AUTORIZADO
                        metadata:
                          taxpayer:
                            id: 123
                            ulid: 01HQXZ8P9G2K4MNBVCXWERTYU2
                            tax_number: '1726051285001'
                          team:
                            id: 456
                            ulid: 01HQXZ8P9G2K4MNBVCXWERTYU3
                            name: 'Mi Empresa S.A.'
                    properties:
                      status:
                        type: string
                        example: success
                      message:
                        type: string
                        example: 'Document status retrieved successfully'
                      data:
                        type: object
                        properties:
                          document_id:
                            type: string
                            example: 01HQXZ8P9G2K4MNBVCXWERTYU1
                          document_type:
                            type: string
                            example: purchase
                          status:
                            type: string
                            example: AUTORIZADO
                          metadata:
                            type: object
                            properties:
                              taxpayer:
                                type: object
                                properties:
                                  id:
                                    type: integer
                                    example: 123
                                  ulid:
                                    type: string
                                    example: 01HQXZ8P9G2K4MNBVCXWERTYU2
                                  tax_number:
                                    type: string
                                    example: '1726051285001'
                              team:
                                type: object
                                properties:
                                  id:
                                    type: integer
                                    example: 456
                                  ulid:
                                    type: string
                                    example: 01HQXZ8P9G2K4MNBVCXWERTYU3
                                  name:
                                    type: string
                                    example: 'Mi Empresa S.A.'
                  -
                    description: 'Success - Credit Note'
                    type: object
                    example:
                      status: success
                      message: 'Document status retrieved successfully'
                      data:
                        document_id: 01HQXZ8P9G2K4MNBVCXWERTYU1
                        document_type: credit_note
                        status: AUTORIZADO
                        metadata:
                          taxpayer:
                            id: 123
                            ulid: 01HQXZ8P9G2K4MNBVCXWERTYU2
                            tax_number: '1726051285001'
                          team:
                            id: 456
                            ulid: 01HQXZ8P9G2K4MNBVCXWERTYU3
                            name: 'Mi Empresa S.A.'
                    properties:
                      status:
                        type: string
                        example: success
                      message:
                        type: string
                        example: 'Document status retrieved successfully'
                      data:
                        type: object
                        properties:
                          document_id:
                            type: string
                            example: 01HQXZ8P9G2K4MNBVCXWERTYU1
                          document_type:
                            type: string
                            example: credit_note
                          status:
                            type: string
                            example: AUTORIZADO
                          metadata:
                            type: object
                            properties:
                              taxpayer:
                                type: object
                                properties:
                                  id:
                                    type: integer
                                    example: 123
                                  ulid:
                                    type: string
                                    example: 01HQXZ8P9G2K4MNBVCXWERTYU2
                                  tax_number:
                                    type: string
                                    example: '1726051285001'
                              team:
                                type: object
                                properties:
                                  id:
                                    type: integer
                                    example: 456
                                  ulid:
                                    type: string
                                    example: 01HQXZ8P9G2K4MNBVCXWERTYU3
                                  name:
                                    type: string
                                    example: 'Mi Empresa S.A.'
                  -
                    description: 'Success - Withholding Retention'
                    type: object
                    example:
                      status: success
                      message: 'Document status retrieved successfully'
                      data:
                        document_id: 01HQXZ8P9G2K4MNBVCXWERTYU1
                        document_type: retention
                        status: AUTORIZADO
                        metadata:
                          taxpayer:
                            id: 123
                            ulid: 01HQXZ8P9G2K4MNBVCXWERTYU2
                            tax_number: '1726051285001'
                          team:
                            id: 456
                            ulid: 01HQXZ8P9G2K4MNBVCXWERTYU3
                            name: 'Mi Empresa S.A.'
                    properties:
                      status:
                        type: string
                        example: success
                      message:
                        type: string
                        example: 'Document status retrieved successfully'
                      data:
                        type: object
                        properties:
                          document_id:
                            type: string
                            example: 01HQXZ8P9G2K4MNBVCXWERTYU1
                          document_type:
                            type: string
                            example: retention
                          status:
                            type: string
                            example: AUTORIZADO
                          metadata:
                            type: object
                            properties:
                              taxpayer:
                                type: object
                                properties:
                                  id:
                                    type: integer
                                    example: 123
                                  ulid:
                                    type: string
                                    example: 01HQXZ8P9G2K4MNBVCXWERTYU2
                                  tax_number:
                                    type: string
                                    example: '1726051285001'
                              team:
                                type: object
                                properties:
                                  id:
                                    type: integer
                                    example: 456
                                  ulid:
                                    type: string
                                    example: 01HQXZ8P9G2K4MNBVCXWERTYU3
                                  name:
                                    type: string
                                    example: 'Mi Empresa S.A.'
        401:
          description: 'Unauthorized - Invalid API Key'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'Invalid API key or organization ID'
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'Invalid API key or organization ID'
        404:
          description: ''
          content:
            application/json:
              schema:
                oneOf:
                  -
                    description: 'Document Not Found'
                    type: object
                    example:
                      status: error
                      message: 'Document not found or does not belong to this taxpayer'
                    properties:
                      status:
                        type: string
                        example: error
                      message:
                        type: string
                        example: 'Document not found or does not belong to this taxpayer'
                  -
                    description: 'Taxpayer Not Found'
                    type: object
                    example:
                      status: error
                      message: 'Taxpayer not found'
                    properties:
                      status:
                        type: string
                        example: error
                      message:
                        type: string
                        example: 'Taxpayer not found'
        500:
          description: 'Server Error'
          content:
            application/json:
              schema:
                type: object
                example:
                  status: error
                  message: 'An error occurred while retrieving document status'
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: 'An error occurred while retrieving document status'
      tags:
        - 'Received Documents'
    parameters:
      -
        in: path
        name: taxNumber
        description: "The taxpayer's RUC number (13 digits)."
        example: '1726051285001'
        required: true
        schema:
          type: string
      -
        in: path
        name: documentUlid
        description: 'The unique ULID identifier of the document. Can be from purchases, credit notes, or retentions.'
        example: 01HQXZ8P9G2K4MNBVCXWERTYU1
        required: true
        schema:
          type: string
